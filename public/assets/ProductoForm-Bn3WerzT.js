import{aE as D,r as u,D as Z,f as y,e as l,at as c,o as m,b as o,s,t as k,a1 as h,c as C,l as oo,F as N,h as $,a2 as V,Y as E}from"./index-FGSunMJY.js";import{V as eo}from"./VContainer-BDKJKvBo.js";import{V as P,a as d}from"./VRow-Crh3qFb1.js";import{V as ro,b as lo,d as j}from"./VCard-Bbl-KwCa.js";import{V as to}from"./VCardText-D7e5QzJH.js";import{V as ao}from"./VForm-BKfsdIVN.js";import{V as g}from"./VTextField-RPy84ABs.js";import{V as x}from"./VSelect-B5ao1Opi.js";import{V as io}from"./VDivider-5WSCDI51.js";import{V as so}from"./VDataTable-th0k0Jza.js";import{V as no}from"./VChip-BBgoliR1.js";import{V as uo}from"./VSnackbar-DUfZCb50.js";/* empty css              */import"./VAvatar-BlD84t2b.js";import"./VImg-BidAYaxB.js";import"./index-6-DCdOXz.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-DUOSWP1W.js";import"./VOverlay-DYSkQdJ8.js";import"./VMenu-C4fADKBr.js";import"./VCheckboxBtn-DF8jgzm3.js";const co={key:0},mo={key:1,class:"text-disabled"},No={__name:"ProductoForm",setup(po){const a=D({nombre:"",unidad_id:"",largo_total:"",peso_por_metro:"",codigo_proveedor:""}),L=r=>{const e=r.map(t=>{var n;return(n=t.proveedor)==null?void 0:n.nombre}).filter(Boolean);return[...new Set(e)]},S=u([]),T=u([]),z=u([]),A=u([]),p=u([]),v=u(!1),B=u(null),U=u(""),F=u([]);u("");const _=D({visible:!1,text:"",color:"success"}),M=[{title:"Nombre",key:"nombre"},{title:"Tipo",key:"tipo_producto.nombre"},{title:"Unidad",key:"unidad.nombre"},{title:"Proveedor",value:"proveedor"},{title:"Acciones",key:"acciones",sortable:!1}],f=(r,e="success")=>{_.text=r,_.color=e,_.visible=!0},O=()=>{p.value.push({proveedor_id:"",color_id:"",codigo_proveedor:"",costo:""})},R=r=>{p.value.splice(r,1)},w=()=>{Object.assign(a,{nombre:"",tipo_producto_id:"",unidad_id:"",largo_total:"",peso_por_metro:"",codigo_proveedor:""}),B.value=null,v.value=!1,p.value=[]},I=async()=>{v.value?await q():await Y()},Y=async()=>{try{await c.post("api/productos",{...a,producto_color_proveedor:p.value}),f("Producto agregado con Ã©xito"),b(),w()}catch(r){console.error(r),f("Error al crear producto","error")}},q=async()=>{try{await c.put(`api/productos/${a.id}`,{...a,producto_color_proveedor:p.value}),f("Producto actualizado"),b(),w()}catch(r){console.error(r),f("Error al actualizar producto","error")}},G=async r=>{try{await c.delete(`api/productos/${r}`),b(),f("Producto eliminado")}catch(e){console.error(e),f("Error al eliminar producto","error")}},H=r=>{B.value=r,v.value=!0,Object.assign(a,{id:r.id,nombre:r.nombre,tipo_producto_id:r.tipo_producto_id,unidad_id:r.unidad_id,largo_total:r.largo_total,peso_por_metro:r.peso_por_metro,codigo_proveedor:r.codigo_proveedor}),p.value=r.colores_por_proveedor.map(e=>({proveedor_id:e.proveedor_id,color_id:e.color_id,costo:e.costo,codigo_proveedor:e.codigo_proveedor??""}))},J=()=>w(),b=async()=>{try{const{data:r}=await c.get("api/productos");console.log("ðŸ§ª Productos cargados:",r),S.value=r}catch(r){console.error("Error cargando productos:",r)}},K=async()=>{const r=await c.get("api/colores");z.value=r.data},Q=async()=>{const r=await c.get("api/proveedores");T.value=r.data},W=async()=>{const r=await c.get("api/unidades");A.value=r.data},X=async()=>{try{const{data:r}=await c.get("api/tipos_producto");F.value=r}catch(r){console.error("Error al cargar tipos de producto:",r)}};return Z(()=>{K(),Q(),b(),W(),X()}),(r,e)=>(m(),y(eo,{fluid:""},{default:l(()=>[o(P,{justify:"center"},{default:l(()=>[o(d,{cols:"12",sm:"11",md:"10",lg:"8"},{default:l(()=>[o(ro,{elevation:"2",class:"pa-6"},{default:l(()=>[o(lo,{class:"text-h5 text-center mb-2"},{default:l(()=>[s(k(v.value?"Editar Producto":"Agregar Producto"),1)]),_:1}),o(to,null,{default:l(()=>[o(j,{class:"text-subtitle-1 font-weight-medium mb-2"},{default:l(()=>e[7]||(e[7]=[s(" Datos del producto ")])),_:1}),o(ao,{onSubmit:h(I,["prevent"]),ref:"formRef"},{default:l(()=>[o(P,{class:"gap-y-6 gap-x-4"},{default:l(()=>[o(d,{cols:"12",sm:"6"},{default:l(()=>[o(g,{modelValue:a.nombre,"onUpdate:modelValue":e[0]||(e[0]=t=>a.nombre=t),label:"Nombre del producto","prepend-inner-icon":"mdi-label-outline",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[o(x,{modelValue:a.tipo_producto_id,"onUpdate:modelValue":e[1]||(e[1]=t=>a.tipo_producto_id=t),items:F.value,"item-title":"nombre","item-value":"id",label:"Tipo de producto"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[o(x,{modelValue:a.unidad_id,"onUpdate:modelValue":e[2]||(e[2]=t=>a.unidad_id=t),items:A.value,"item-title":"nombre","item-value":"id",label:"Unidad de medida",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[o(g,{modelValue:a.largo_total,"onUpdate:modelValue":e[3]||(e[3]=t=>a.largo_total=t),label:"Largo total (m)",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[o(g,{modelValue:a.peso_por_metro,"onUpdate:modelValue":e[4]||(e[4]=t=>a.peso_por_metro=t),label:"Peso por metro (kg)",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1}),o(io,{class:"my-6"}),o(j,{class:"text-subtitle-1 font-weight-medium mb-2"},{default:l(()=>e[8]||(e[8]=[s(" Combinaciones proveedor + color + costo ")])),_:1}),(m(!0),C(N,null,$(p.value,(t,n)=>(m(),y(P,{key:n},{default:l(()=>[o(d,{cols:"12",sm:"4"},{default:l(()=>[o(x,{modelValue:t.proveedor_id,"onUpdate:modelValue":i=>t.proveedor_id=i,items:T.value,"item-title":"nombre","item-value":"id",label:"Proveedor",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(d,{cols:"12",sm:"4"},{default:l(()=>[o(x,{modelValue:t.color_id,"onUpdate:modelValue":i=>t.color_id=i,items:z.value,"item-title":"nombre","item-value":"id",label:"Color",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(d,{cols:"12",sm:"4"},{default:l(()=>[o(g,{modelValue:t.codigo_proveedor,"onUpdate:modelValue":i=>t.codigo_proveedor=i,label:"CÃ³digo proveedor"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"10",sm:"3"},{default:l(()=>[o(g,{modelValue:t.costo,"onUpdate:modelValue":i=>t.costo=i,label:"Costo",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",sm:"1",class:"h-100 d-flex align-center justify-center"},{default:l(()=>[o(V,{icon:"",onClick:i=>R(n),color:"error",size:"small"},{default:l(()=>[o(E,null,{default:l(()=>e[9]||(e[9]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(V,{variant:"text",color:"primary",onClick:O,class:"mb-6"},{default:l(()=>e[10]||(e[10]=[s(" + Agregar combinaciÃ³n ")])),_:1}),o(V,{block:"",color:"primary",type:"submit",class:"mb-2"},{default:l(()=>[s(k(v.value?"Actualizar Producto":"Agregar Producto"),1)]),_:1}),v.value?(m(),y(V,{key:0,block:"",color:"secondary",onClick:J},{default:l(()=>e[11]||(e[11]=[s(" Cancelar ")])),_:1})):oo("",!0)]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),o(P,null,{default:l(()=>[o(d,{cols:"12",md:"10",lg:"8",class:"mx-auto mt-6"},{default:l(()=>[o(so,{items:S.value,headers:M,search:U.value,class:"elevation-1"},{top:l(()=>[o(g,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=t=>U.value=t),label:"Buscar producto",class:"mx-4","prepend-inner-icon":"mdi-magnify",clearable:"",dense:""},null,8,["modelValue"])]),"item.proveedor":l(({item:t})=>{var n;return[(n=t.colores_por_proveedor)!=null&&n.length?(m(),C("div",co,[(m(!0),C(N,null,$(L(t.colores_por_proveedor),i=>(m(),y(no,{key:i,class:"ma-1",size:"small",color:"secondary",variant:"tonal"},{default:l(()=>[s(k(i),1)]),_:2},1024))),128))])):(m(),C("span",mo,"Sin proveedor"))]}),"item.acciones":l(({item:t})=>[o(V,{icon:"",color:"warning",onClick:n=>H(t)},{default:l(()=>[o(E,null,{default:l(()=>e[12]||(e[12]=[s("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),o(V,{icon:"",color:"error",onClick:n=>G(t.id)},{default:l(()=>[o(E,null,{default:l(()=>e[13]||(e[13]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1},8,["items","search"])]),_:1})]),_:1}),o(uo,{modelValue:_.visible,"onUpdate:modelValue":e[6]||(e[6]=t=>_.visible=t),color:_.color,timeout:3e3,top:"",right:""},{default:l(()=>[s(k(_.text),1)]),_:1},8,["modelValue","color"])]),_:1}))}};export{No as default};
