import{aP as N,r as u,E as Y,f as y,e as t,au as c,o as m,b as o,t as s,v as k,a2 as h,c as C,m as oo,F as $,i as j,a3 as V,Z as E}from"./index-YRUI0cDI.js";import{V as eo}from"./VContainer-BKUR9y_5.js";import{V as P,a as d}from"./VRow-DGg8I5jE.js";import{V as ro,b as to,d as D}from"./VCard-BiaBokuO.js";import{V as lo}from"./VCardText-DCixybGO.js";import{V as ao}from"./VForm-CatyeCP1.js";import{V as g}from"./VTextField-CSimerPO.js";import{V as x}from"./VSelect-BTZNNMqU.js";import{V as io}from"./VDivider-mn26tTIE.js";import{V as so}from"./VDataTable-302Fq-Y5.js";import{V as no}from"./VChip-BrCI7Bwy.js";import{V as uo}from"./VSnackbar-g_rfkn6Y.js";/* empty css              */import"./VAvatar-Bz3eMdZA.js";import"./VImg--QaSJKIB.js";import"./transition-CnrNqA6R.js";import"./VInput-DmZD4gn1.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-CWjUbvfH.js";import"./VOverlay-C08ePG-2.js";import"./VMenu-B9W_ITpO.js";import"./VCheckboxBtn-DQEReXl_.js";import"./VSelectionControl-v6_tSBbA.js";const co={key:0},mo={key:1,class:"text-disabled"},Do={__name:"ProductoForm",setup(po){const a=N({nombre:"",unidad_id:"",largo_total:"",peso_por_metro:"",codigo_proveedor:""}),L=r=>{const e=r.map(l=>{var n;return(n=l.proveedor)==null?void 0:n.nombre}).filter(Boolean);return[...new Set(e)]},S=u([]),T=u([]),z=u([]),A=u([]),p=u([]),v=u(!1),B=u(null),U=u(""),F=u([]);u("");const _=N({visible:!1,text:"",color:"success"}),M=[{title:"Nombre",key:"nombre"},{title:"Tipo",key:"tipo_producto.nombre"},{title:"Unidad",key:"unidad.nombre"},{title:"Proveedor",value:"proveedor"},{title:"Acciones",key:"acciones",sortable:!1}],f=(r,e="success")=>{_.text=r,_.color=e,_.visible=!0},O=()=>{p.value.push({proveedor_id:"",color_id:"",codigo_proveedor:"",costo:""})},R=r=>{p.value.splice(r,1)},w=()=>{Object.assign(a,{nombre:"",tipo_producto_id:"",unidad_id:"",largo_total:"",peso_por_metro:"",codigo_proveedor:""}),B.value=null,v.value=!1,p.value=[]},I=async()=>{v.value?await q():await Z()},Z=async()=>{try{await c.post("api/productos",{...a,producto_color_proveedor:p.value}),f("Producto agregado con Ã©xito"),b(),w()}catch(r){console.error(r),f("Error al crear producto","error")}},q=async()=>{try{await c.put(`api/productos/${a.id}`,{...a,producto_color_proveedor:p.value}),f("Producto actualizado"),b(),w()}catch(r){console.error(r),f("Error al actualizar producto","error")}},G=async r=>{try{await c.delete(`api/productos/${r}`),b(),f("Producto eliminado")}catch(e){console.error(e),f("Error al eliminar producto","error")}},H=r=>{B.value=r,v.value=!0,Object.assign(a,{id:r.id,nombre:r.nombre,tipo_producto_id:r.tipo_producto_id,unidad_id:r.unidad_id,largo_total:r.largo_total,peso_por_metro:r.peso_por_metro,codigo_proveedor:r.codigo_proveedor}),p.value=r.colores_por_proveedor.map(e=>({proveedor_id:e.proveedor_id,color_id:e.color_id,costo:e.costo,codigo_proveedor:e.codigo_proveedor??""}))},J=()=>w(),b=async()=>{try{const{data:r}=await c.get("api/productos");console.log("ðŸ§ª Productos cargados:",r),S.value=r}catch(r){console.error("Error cargando productos:",r)}},K=async()=>{const r=await c.get("api/colores");z.value=r.data},Q=async()=>{const r=await c.get("api/proveedores");T.value=r.data},W=async()=>{const r=await c.get("api/unidades");A.value=r.data},X=async()=>{try{const{data:r}=await c.get("api/tipos_producto");F.value=r}catch(r){console.error("Error al cargar tipos de producto:",r)}};return Y(()=>{K(),Q(),b(),W(),X()}),(r,e)=>(m(),y(eo,{fluid:""},{default:t(()=>[o(P,{justify:"center"},{default:t(()=>[o(d,{cols:"12",sm:"11",md:"10",lg:"8"},{default:t(()=>[o(ro,{elevation:"2",class:"pa-6"},{default:t(()=>[o(to,{class:"text-h5 text-center mb-2"},{default:t(()=>[s(k(v.value?"Editar Producto":"Agregar Producto"),1)]),_:1}),o(lo,null,{default:t(()=>[o(D,{class:"text-subtitle-1 font-weight-medium mb-2"},{default:t(()=>e[7]||(e[7]=[s(" Datos del producto ")])),_:1}),o(ao,{onSubmit:h(I,["prevent"]),ref:"formRef"},{default:t(()=>[o(P,{class:"gap-y-6 gap-x-4"},{default:t(()=>[o(d,{cols:"12",sm:"6"},{default:t(()=>[o(g,{modelValue:a.nombre,"onUpdate:modelValue":e[0]||(e[0]=l=>a.nombre=l),label:"Nombre del producto","prepend-inner-icon":"mdi-label-outline",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:t(()=>[o(x,{modelValue:a.tipo_producto_id,"onUpdate:modelValue":e[1]||(e[1]=l=>a.tipo_producto_id=l),items:F.value,"item-title":"nombre","item-value":"id",label:"Tipo de producto"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:t(()=>[o(x,{modelValue:a.unidad_id,"onUpdate:modelValue":e[2]||(e[2]=l=>a.unidad_id=l),items:A.value,"item-title":"nombre","item-value":"id",label:"Unidad de medida",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:t(()=>[o(g,{modelValue:a.largo_total,"onUpdate:modelValue":e[3]||(e[3]=l=>a.largo_total=l),label:"Largo total (m)",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:t(()=>[o(g,{modelValue:a.peso_por_metro,"onUpdate:modelValue":e[4]||(e[4]=l=>a.peso_por_metro=l),label:"Peso por metro (kg)",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1}),o(io,{class:"my-6"}),o(D,{class:"text-subtitle-1 font-weight-medium mb-2"},{default:t(()=>e[8]||(e[8]=[s(" Combinaciones proveedor + color + costo ")])),_:1}),(m(!0),C($,null,j(p.value,(l,n)=>(m(),y(P,{key:n},{default:t(()=>[o(d,{cols:"12",sm:"4"},{default:t(()=>[o(x,{modelValue:l.proveedor_id,"onUpdate:modelValue":i=>l.proveedor_id=i,items:T.value,"item-title":"nombre","item-value":"id",label:"Proveedor",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(d,{cols:"12",sm:"4"},{default:t(()=>[o(x,{modelValue:l.color_id,"onUpdate:modelValue":i=>l.color_id=i,items:z.value,"item-title":"nombre","item-value":"id",label:"Color",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(d,{cols:"12",sm:"4"},{default:t(()=>[o(g,{modelValue:l.codigo_proveedor,"onUpdate:modelValue":i=>l.codigo_proveedor=i,label:"CÃ³digo proveedor"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"10",sm:"3"},{default:t(()=>[o(g,{modelValue:l.costo,"onUpdate:modelValue":i=>l.costo=i,label:"Costo",type:"number",step:"0.01",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",sm:"1",class:"h-100 d-flex align-center justify-center"},{default:t(()=>[o(V,{icon:"",onClick:i=>R(n),color:"error",size:"small"},{default:t(()=>[o(E,null,{default:t(()=>e[9]||(e[9]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(V,{variant:"text",color:"primary",onClick:O,class:"mb-6"},{default:t(()=>e[10]||(e[10]=[s(" + Agregar combinaciÃ³n ")])),_:1}),o(V,{block:"",color:"primary",type:"submit",class:"mb-2"},{default:t(()=>[s(k(v.value?"Actualizar Producto":"Agregar Producto"),1)]),_:1}),v.value?(m(),y(V,{key:0,block:"",color:"secondary",onClick:J},{default:t(()=>e[11]||(e[11]=[s(" Cancelar ")])),_:1})):oo("",!0)]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),o(P,null,{default:t(()=>[o(d,{cols:"12",md:"10",lg:"8",class:"mx-auto mt-6"},{default:t(()=>[o(so,{items:S.value,headers:M,search:U.value,class:"elevation-1"},{top:t(()=>[o(g,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=l=>U.value=l),label:"Buscar producto",class:"mx-4","prepend-inner-icon":"mdi-magnify",clearable:"",dense:""},null,8,["modelValue"])]),"item.proveedor":t(({item:l})=>{var n;return[(n=l.colores_por_proveedor)!=null&&n.length?(m(),C("div",co,[(m(!0),C($,null,j(L(l.colores_por_proveedor),i=>(m(),y(no,{key:i,class:"ma-1",size:"small",color:"secondary",variant:"tonal"},{default:t(()=>[s(k(i),1)]),_:2},1024))),128))])):(m(),C("span",mo,"Sin proveedor"))]}),"item.acciones":t(({item:l})=>[o(V,{icon:"",color:"warning",onClick:n=>H(l)},{default:t(()=>[o(E,null,{default:t(()=>e[12]||(e[12]=[s("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),o(V,{icon:"",color:"error",onClick:n=>G(l.id)},{default:t(()=>[o(E,null,{default:t(()=>e[13]||(e[13]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1},8,["items","search"])]),_:1})]),_:1}),o(uo,{modelValue:_.visible,"onUpdate:modelValue":e[6]||(e[6]=l=>_.visible=l),color:_.color,timeout:3e3,top:"",right:""},{default:t(()=>[s(k(_.text),1)]),_:1},8,["modelValue","color"])]),_:1}))}};export{Do as default};
