import{a5 as Re,a6 as Le,ak as Be,r as C,au as oe,a7 as we,W as h,al as Oe,av as Ke,w as R,ax as Pe,a9 as Ge,b as o,p as Q,aa as He,aD as We,ay as qe,F as Z,Y as X,az as Qe,aA as Ye,aB as Je,s as y,aC as Xe,aE as Ze,D as el,at as j,f as Y,e as i,j as ll,o as z,c as be,a2 as H,h as ol,l as te,d as _e,t as J,a1 as tl}from"./index-DMhCiFeK.js";import{d as al}from"./debounce-mFUTGwKc.js";import il from"./Visor3D-DZKKELBT.js";import{_ as ul}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as rl}from"./VContainer-CZ6aYaku.js";import{V as ye,b as Ue,d as ge,c as nl}from"./VCard-HJ1cR6hI.js";import{V as re}from"./VDivider-B_ksp4Jj.js";import{V as M,a as p}from"./VRow-D390mSBe.js";import{u as dl,m as sl,a as cl,V as A}from"./VSelect-CZVOE1Jl.js";import{u as ml,V as k,m as vl}from"./VTextField-Ce9BXow7.js";import{u as pl,m as fl,V as Vl}from"./VDataTable-CfD2suKe.js";import{f as bl}from"./forwardRefs-DWGaNmQL.js";import{u as _l,t as ae,V as yl,a as Se}from"./VList-DgwPryDY.js";import{m as gl}from"./index-Dhrc00_g.js";import{V as Cl}from"./VMenu-CJhHMRkx.js";import{V as kl}from"./VCheckboxBtn-c2OChUTR.js";import{V as xl}from"./VAvatar-By6YVCfo.js";import{V as hl}from"./VChip-DofFInlq.js";import{V as wl}from"./VTextarea-lhp1LT31.js";import{V as Ce}from"./VAlert-B2Ox5SeF.js";import{V as Pl}from"./VDialog-DucHcboO.js";import{V as Ul}from"./VCardText-DiAvFenq.js";import{V as Sl}from"./VForm-Bp9h6Lj8.js";import{V as Dl}from"./VSpacer-EOAJ36hs.js";import"./_commonjsHelpers-Cpj98o6Y.js";/* empty css              */import"./VImg-CHWQNL1G.js";import"./VOverlay-Cbj0hSDk.js";function Fl(t,F,v){if(F==null)return t;if(Array.isArray(F))throw new Error("Multiple matches is not implemented");return typeof F=="number"&&~F?o(Z,null,[o("span",{class:"v-combobox__unmask"},[t.substr(0,F)]),o("span",{class:"v-combobox__mask"},[t.substr(F,v)]),o("span",{class:"v-combobox__unmask"},[t.substr(F+v)])]):t}const Il=Le({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...fl({filterKeys:["title"]}),...sl({hideNoData:!0,returnObject:!0}),...He(vl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...gl({transition:!1})},"VCombobox"),Al=Re()({name:"VCombobox",props:Il(),emits:{"update:focused":t=>!0,"update:modelValue":t=>!0,"update:search":t=>!0,"update:menu":t=>!0},setup(t,F){var ke;let{emit:v,slots:m}=F;const{t:N}=Be(),w=C(),P=oe(!1),S=oe(!0),$=oe(!1),ee=C(),L=C(),B=we(t,"menu"),V=h({get:()=>B.value,set:a=>{var d;B.value&&!a&&((d=ee.value)!=null&&d.ΨopenChildren.size)||(B.value=a)}}),_=oe(-1);let b=!1;const ne=h(()=>{var a;return(a=w.value)==null?void 0:a.color}),W=h(()=>V.value?t.closeText:t.openText),{items:de,transformIn:se,transformOut:ce}=_l(t),{textColorClasses:me,textColorStyles:ve}=Oe(ne),c=we(t,"modelValue",[],a=>se(Ke(a)),a=>{const d=ce(a);return t.multiple?d:d[0]??null}),q=ml(t),O=h(()=>!!(t.chips||m.chip)),I=h(()=>O.value||!!m.selection),u=oe(!t.multiple&&!I.value?((ke=c.value[0])==null?void 0:ke.title)??"":""),e=h({get:()=>u.value,set:a=>{var d;if(u.value=a??"",!t.multiple&&!I.value&&(c.value=[ae(t,a)]),a&&t.multiple&&((d=t.delimiters)!=null&&d.length)){const g=a.split(new RegExp(`(?:${t.delimiters.join("|")})+`));g.length>1&&(g.forEach(s=>{s=s.trim(),s&&E(ae(t,s))}),u.value="")}a||(_.value=-1),S.value=!a}}),l=h(()=>typeof t.counterValue=="function"?t.counterValue(c.value):typeof t.counterValue=="number"?t.counterValue:t.multiple?c.value.length:e.value.length);R(u,a=>{b?Pe(()=>b=!1):P.value&&!V.value&&(V.value=!0),v("update:search",a)}),R(c,a=>{var d;!t.multiple&&!I.value&&(u.value=((d=a[0])==null?void 0:d.title)??"")});const{filteredItems:n,getMatches:r}=pl(t,de,()=>S.value?"":e.value),T=h(()=>t.hideSelected?n.value.filter(a=>!c.value.some(d=>d.value===a.value)):n.value),le=h(()=>c.value.map(a=>a.value)),pe=h(()=>{var d;return(t.autoSelectFirst===!0||t.autoSelectFirst==="exact"&&e.value===((d=T.value[0])==null?void 0:d.title))&&T.value.length>0&&!S.value&&!$.value}),fe=h(()=>t.hideNoData&&!T.value.length||q.isReadonly.value||q.isDisabled.value),Ve=C(),De=dl(Ve,w);function Fe(a){b=!0,t.openOnClear&&(V.value=!0)}function Ie(){fe.value||(V.value=!0)}function Ae(a){fe.value||(P.value&&(a.preventDefault(),a.stopPropagation()),V.value=!V.value)}function Te(a){var d;Xe(a)&&((d=w.value)==null||d.focus())}function Ee(a){var s;if(We(a)||q.isReadonly.value)return;const d=w.value.selectionStart,g=c.value.length;if((_.value>-1||["Enter","ArrowDown","ArrowUp"].includes(a.key))&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(V.value=!0),["Escape"].includes(a.key)&&(V.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(pe.value&&["Enter","Tab"].includes(a.key)&&!c.value.some(f=>{let{value:D}=f;return D===T.value[0].value})&&E(n.value[0]),S.value=!0),a.key==="ArrowDown"&&pe.value&&((s=Ve.value)==null||s.focus("next")),a.key==="Enter"&&e.value&&(E(ae(t,e.value)),I.value&&(u.value="")),["Backspace","Delete"].includes(a.key)){if(!t.multiple&&I.value&&c.value.length>0&&!e.value)return E(c.value[0],!1);if(~_.value){const f=_.value;E(c.value[_.value],!1),_.value=f>=g-1?g-2:f}else a.key==="Backspace"&&!e.value&&(_.value=g-1)}if(t.multiple){if(a.key==="ArrowLeft"){if(_.value<0&&d>0)return;const f=_.value>-1?_.value-1:g-1;c.value[f]?_.value=f:(_.value=-1,w.value.setSelectionRange(e.value.length,e.value.length))}if(a.key==="ArrowRight"){if(_.value<0)return;const f=_.value+1;c.value[f]?_.value=f:(_.value=-1,w.value.setSelectionRange(0,0))}}}function Me(){var a;t.eager&&((a=L.value)==null||a.calculateVisibleItems())}function Ne(){var a;P.value&&(S.value=!0,(a=w.value)==null||a.focus())}function E(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(t.multiple){const g=c.value.findIndex(f=>t.valueComparator(f.value,a.value)),s=d??!~g;if(~g){const f=s?[...c.value,a]:[...c.value];f.splice(g,1),c.value=f}else s&&(c.value=[...c.value,a]);t.clearOnSelect&&(e.value="")}else{const g=d!==!1;c.value=g?[a]:[],u.value=g&&!I.value?a.title:"",Pe(()=>{V.value=!1,S.value=!0})}}function $e(a){P.value=!0,setTimeout(()=>{$.value=!0})}function je(a){$.value=!1}function ze(a){(a==null||a===""&&!t.multiple&&!I.value)&&(c.value=[])}return R(P,(a,d)=>{if(!(a||a===d)&&(_.value=-1,V.value=!1,e.value)){if(t.multiple){E(ae(t,e.value));return}if(!I.value)return;c.value.some(g=>{let{title:s}=g;return s===e.value})?u.value="":E(ae(t,e.value))}}),R(V,()=>{if(!t.hideSelected&&V.value&&c.value.length){const a=T.value.findIndex(d=>c.value.some(g=>t.valueComparator(g.value,d.value)));qe&&window.requestAnimationFrame(()=>{var d;a>=0&&((d=L.value)==null||d.scrollToIndex(a))})}}),R(()=>t.items,(a,d)=>{V.value||P.value&&!d.length&&a.length&&(V.value=!0)}),Ge(()=>{const a=!!(!t.hideNoData||T.value.length||m["prepend-item"]||m["append-item"]||m["no-data"]),d=c.value.length>0,g=k.filterProps(t);return o(k,Q({ref:w},g,{modelValue:e.value,"onUpdate:modelValue":[s=>e.value=s,ze],focused:P.value,"onUpdate:focused":s=>P.value=s,validationValue:c.externalValue,counterValue:l.value,dirty:d,class:["v-combobox",{"v-combobox--active-menu":V.value,"v-combobox--chips":!!t.chips,"v-combobox--selection-slot":!!I.value,"v-combobox--selecting-index":_.value>-1,[`v-combobox--${t.multiple?"multiple":"single"}`]:!0},t.class],style:t.style,readonly:q.isReadonly.value,placeholder:d?void 0:t.placeholder,"onClick:clear":Fe,"onMousedown:control":Ie,onKeydown:Ee}),{...m,default:()=>o(Z,null,[o(Cl,Q({ref:ee,modelValue:V.value,"onUpdate:modelValue":s=>V.value=s,activator:"parent",contentClass:"v-combobox__content",disabled:fe.value,eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:t.transition,onAfterEnter:Me,onAfterLeave:Ne},t.menuProps),{default:()=>[a&&o(yl,Q({ref:Ve,selected:le.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:Te,onFocusin:$e,onFocusout:je,tabindex:"-1","aria-live":"polite",color:t.itemColor??t.color},De,t.listProps),{default:()=>{var s,f,D;return[(s=m["prepend-item"])==null?void 0:s.call(m),!T.value.length&&!t.hideNoData&&(((f=m["no-data"])==null?void 0:f.call(m))??o(Se,{title:N(t.noDataText)},null)),o(cl,{ref:L,renderless:!0,items:T.value},{default:K=>{var he;let{item:x,index:G,itemRef:U}=K;const xe=Q(x.props,{ref:U,key:G,active:pe.value&&G===0?!0:void 0,onClick:()=>E(x,null)});return((he=m.item)==null?void 0:he.call(m,{item:x,index:G,props:xe}))??o(Se,Q(xe,{role:"option"}),{prepend:ie=>{let{isSelected:ue}=ie;return o(Z,null,[t.multiple&&!t.hideSelected?o(kl,{key:x.value,modelValue:ue,ripple:!1,tabindex:"-1"},null):void 0,x.props.prependAvatar&&o(xl,{image:x.props.prependAvatar},null),x.props.prependIcon&&o(X,{icon:x.props.prependIcon},null)])},title:()=>{var ie,ue;return S.value?x.title:Fl(x.title,(ie=r(x))==null?void 0:ie.title,((ue=e.value)==null?void 0:ue.length)??0)}})}}),(D=m["append-item"])==null?void 0:D.call(m)]}})]}),c.value.map((s,f)=>{function D(U){U.stopPropagation(),U.preventDefault(),E(s,!1)}const K={"onClick:close":D,onKeydown(U){U.key!=="Enter"&&U.key!==" "||(U.preventDefault(),U.stopPropagation(),D(U))},onMousedown(U){U.preventDefault(),U.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},x=O.value?!!m.chip:!!m.selection,G=x?Ye(O.value?m.chip({item:s,index:f,props:K}):m.selection({item:s,index:f})):void 0;if(!(x&&!G))return o("div",{key:s.value,class:["v-combobox__selection",f===_.value&&["v-combobox__selection--selected",me.value]],style:f===_.value?ve.value:{}},[O.value?m.chip?o(Je,{key:"chip-defaults",defaults:{VChip:{closable:t.closableChips,size:"small",text:s.title}}},{default:()=>[G]}):o(hl,Q({key:"chip",closable:t.closableChips,size:"small",text:s.title,disabled:s.props.disabled},K),null):G??o("span",{class:"v-combobox__selection-text"},[s.title,t.multiple&&f<c.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[y(",")])])])})]),"append-inner":function(){var K;for(var s=arguments.length,f=new Array(s),D=0;D<s;D++)f[D]=arguments[D];return o(Z,null,[(K=m["append-inner"])==null?void 0:K.call(m,...f),(!t.hideNoData||t.items.length)&&t.menuIcon?o(X,{class:"v-combobox__menu-icon",icon:t.menuIcon,onMousedown:Ae,onClick:Qe,"aria-label":N(W.value),title:N(W.value),tabindex:"-1"},null):void 0])}})}),bl({isFocused:P,isPristine:S,menu:V,search:e,selectionIndex:_,filteredItems:n,select:E},w)}}),Tl=.45,El={__name:"index",setup(t){const F=ll(),v=C({cliente_id:null,observaciones:"",material:"",color:"",tipoVidrio:"",productoVidrioProveedor:"",ventanas:[]}),m=C({}),N=Ze({cliente:null}),w=C([]),P=C([]),S=C([]),$=C([]),ee=C([]),L=C([]),B=C(""),V=C(!1),_=C(0),b=C({firstName:"",lastName:"",company:"",code:"",email:"",phone:"",city:"",municipality:"",address:"",activity:""});h(()=>$.value.flatMap(u=>u.colores_por_proveedor.map(e=>{var l;return{id:`${u.id}-${e.proveedor_id}`,producto_id:u.id,proveedor_id:e.proveedor_id,nombre:`${u.nombre} (${((l=e.proveedor)==null?void 0:l.nombre)||"Proveedor desconocido"})`}})));const ne=h(()=>{const u=v.value.tipoVidrio;return $.value.filter(e=>e.tipo_producto_id===u).flatMap(e=>e.colores_por_proveedor.map(l=>{var n;return{id:l.id,producto_id:e.id,proveedor_id:l.proveedor_id,nombre:`${e.nombre} (${((n=l.proveedor)==null?void 0:n.nombre)||"Proveedor desconocido"})`}}))});el(async()=>{const[u,e,l,n,r,T]=await Promise.all([j.get("/api/tipos_material"),j.get("/api/colores"),j.get("/api/tipos_producto"),j.get("/api/productos"),j.get("/api/tipos_ventana"),j.get("/api/clientes")]);w.value=u.data,P.value=e.data,S.value=l.data.filter(le=>[1,2].includes(le.id)),$.value=n.data.filter(le=>[1,2].includes(le.tipo_producto_id)),ee.value=r.data,L.value=T.data});const W=u=>(u=parseInt(u),$.value.flatMap(e=>e.colores_por_proveedor.map(l=>({id:l.id,producto_id:e.id,proveedor_id:l.proveedor_id}))).find(e=>e.id===u)),de=u=>{const e=u.tipoVidrio??v.value.tipoVidrio;return $.value.filter(l=>l.tipo_producto_id===e).flatMap(l=>l.colores_por_proveedor.map(n=>{var r;return{id:n.id,producto_id:l.id,proveedor_id:n.proveedor_id,nombre:`${l.nombre} (${((r=n.proveedor)==null?void 0:r.nombre)||"Proveedor desconocido"})`}}))},se=h(()=>{const u=B.value.toLowerCase(),e=new Set;return L.value.filter(l=>{var n;return(n=l.razon_social)==null?void 0:n.toLowerCase().includes(u)}).filter(l=>e.has(l.id)?!1:(e.add(l.id),!0)).map((l,n)=>{var r;return{uid:`${l.id}-${n}`,id:l.id,razon_social:(r=l.razon_social)==null?void 0:r.trim(),raw:l}})}),ce=(u=null)=>{const l={...{tipo:null,ancho:null,alto:null,cantidad:1,material:v.value.material,color:v.value.color,tipoVidrio:v.value.tipoVidrio,productoVidrioProveedor:v.value.productoVidrioProveedor??null,hojas_totales:2,hojas_moviles:2,materiales:[],costo_total:0,costo_total_unitario:0,costo:0,precio_unitario:0,precio:0},...u||{}};v.value.ventanas.push(l);const n=W(l.productoVidrioProveedor);if(l.tipo&&l.ancho&&l.alto&&n){const r={...l,productoVidrio:n.producto_id,proveedorVidrio:n.proveedor_id,hojas_moviles:l.tipo===3||l.tipo===46?l.hojas_moviles:void 0};c(r,l)}},me=u=>{v.value.ventanas.splice(u,1)},ve=u=>{const e=u.material??v.value.material;return ee.value.filter(l=>l.material_id===e)},c=al(async(u,e)=>{if(!u.productoVidrio||!u.proveedorVidrio){console.warn("⚠️ Faltan datos en el payload para calcular materiales:",u);return}try{const l=await j.post("/api/cotizador/calcular-materiales",u);e.costo_total_unitario=l.data.costo_unitario;const n=e.cantidad>0?e.cantidad:1;e.costo_total=l.data.costo_unitario*e.cantidad,e.precio=Math.ceil(e.costo_total/(1-Tl)),e.materiales=l.data.materiales}catch(l){console.error("❌ Error al calcular materiales",l),e.costo_total=0,e.materiales=[]}},1e3);R(()=>v.value.ventanas,u=>{u.forEach(e=>{R(()=>[e.tipo,e.ancho,e.alto,e.cantidad,e.material,e.color,e.tipoVidrio,e.productoVidrioProveedor,e.hojas_totales,e.hojas_moviles],()=>{const l=[];e.tipo||l.push("tipo_ventana_id faltante"),e.ancho||l.push("ancho faltante"),e.alto||l.push("alto faltante"),(!e.cantidad||e.cantidad<=0)&&l.push("cantidad inválida"),e.productoVidrioProveedor||l.push("productoVidrioProveedor faltante");const n=W(e.productoVidrioProveedor);if(n||l.push(`relación producto-proveedor no encontrada (ID: ${e.productoVidrioProveedor})`),l.length>0){console.warn(`❌ No se puede recalcular la ventana (tipo ${e.tipo}):`,l.join(", "));return}const r={...e,productoVidrio:n.producto_id,proveedorVidrio:n.proveedor_id,hojas_moviles:e.tipo===3||e.tipo===46?e.hojas_moviles:void 0};console.log("✅ Recalculando ventana:",r),c(r,e)},{deep:!0,immediate:!1})})},{deep:!0}),R(()=>N.cliente,u=>{u!=null&&u.raw&&console.log("✅ Cliente seleccionado:",u.raw)});const q=()=>{V.value=!0},O=async()=>{try{const u=await j.post("/api/bsale-clientes",b.value);L.value.push(u.data.cliente),N.cliente=u.data.cliente,V.value=!1}catch(u){alert("❌ Error al crear cliente"),console.error(u)}},I=async()=>{var u;try{const e=(u=N.cliente)==null?void 0:u.raw;if(!e||v.value.ventanas.length===0){alert("Debes seleccionar un cliente y agregar al menos una ventana");return}const l={cliente_id:e.id,vendedor_id:1,fecha:new Date().toISOString().split("T")[0],estado_cotizacion_id:v.value.estado_cotizacion_id??1,observaciones:v.value.observaciones,ventanas:v.value.ventanas.map(n=>{const r=W(n.productoVidrioProveedor);return{tipo_ventana_id:n.tipo,ancho:n.ancho,alto:n.alto,cantidad:n.cantidad,color_id:n.color,producto_vidrio_proveedor_id:n.productoVidrioProveedor,producto_id:r==null?void 0:r.producto_id,proveedor_id:r==null?void 0:r.proveedor_id,costo:n.costo_total||n.costo||0,costo_unitario:n.costo_unitario||0,precio:n.precio||0,precio_unitario:n.precio_unitario||0}})};await j.post("api/cotizaciones",l),alert("Cotización guardada correctamente"),F.push({name:"cotizaciones"})}catch(e){console.error("Error al guardar cotización:",e),alert("Error al guardar la cotización")}};return(u,e)=>(z(),Y(rl,{fluid:""},{default:i(()=>[o(ye,{class:"pa-6",elevation:"2"},{default:i(()=>[o(Ue,{class:"text-h5 mb-4"},{default:i(()=>e[19]||(e[19]=[y("Nueva Cotización")])),_:1}),o(ge,{class:"text-h6"},{default:i(()=>e[20]||(e[20]=[y("Datos generales")])),_:1}),o(re,{class:"mb-4"}),o(M,{dense:""},{default:i(()=>[o(p,{cols:"6"},{default:i(()=>[o(M,{"no-gutters":"",align:"center"},{default:i(()=>[o(p,null,{default:i(()=>[(z(),Y(Al,{modelValue:N.cliente,"onUpdate:modelValue":e[0]||(e[0]=l=>N.cliente=l),rules:[l=>!!l||"Selecciona un cliente"],search:B.value,"onUpdate:search":e[1]||(e[1]=l=>B.value=l),items:se.value,"item-title":"razon_social","item-value":"uid",label:"Cliente","return-object":"",clearable:"","menu-props":{virtualScroll:!1},key:_.value,outlined:"",color:"primary"},null,8,["modelValue","rules","search","items"]))]),_:1}),o(p,{cols:"auto"},{default:i(()=>[o(H,{icon:"",color:"primary",onClick:q,class:"ml-2"},{default:i(()=>[o(X,null,{default:i(()=>e[21]||(e[21]=[y("mdi-plus")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(M,{dense:""},{default:i(()=>[o(p,{cols:"6"},{default:i(()=>[o(wl,{modelValue:v.value.observaciones,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.observaciones=l),label:"Observaciones",outlined:"",color:"primary","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1}),o(M,{dense:"",class:"mb-4"},{default:i(()=>[o(p,{cols:"12",md:"6"},{default:i(()=>[o(A,{modelValue:v.value.material,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.material=l),items:w.value,"item-title":"nombre","item-value":"id",label:"Material",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),o(p,{cols:"12",md:"6"},{default:i(()=>[o(A,{modelValue:v.value.color,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value.color=l),items:P.value,"item-title":"nombre","item-value":"id",label:"Color",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(ge,{class:"text-h6"},{default:i(()=>e[22]||(e[22]=[y("Vidrio por defecto")])),_:1}),o(re,{class:"mb-4"}),o(M,{dense:"",class:"mb-4"},{default:i(()=>[o(p,{cols:"12",sm:"6"},{default:i(()=>[o(A,{modelValue:v.value.tipoVidrio,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value.tipoVidrio=l),items:S.value,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),o(p,{cols:"12",sm:"6"},{default:i(()=>[o(A,{modelValue:v.value.productoVidrioProveedor,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value.productoVidrioProveedor=l),items:ne.value,"item-title":"nombre","item-value":"id",label:"Producto de vidrio",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(ge,{class:"text-h6"},{default:i(()=>e[23]||(e[23]=[y("Ventanas")])),_:1}),o(re,{class:"mb-4"}),(z(!0),be(Z,null,ol(v.value.ventanas,(l,n)=>(z(),be("div",{key:n,class:"mb-4"},[o(ye,{class:"pa-4",outlined:""},{default:i(()=>[o(M,{dense:""},{default:i(()=>[o(p,{cols:"12",sm:"6"},{default:i(()=>[o(A,{modelValue:l.tipo,"onUpdate:modelValue":r=>l.tipo=r,items:ve(l),"item-title":"nombre","item-value":"id",label:"Tipo de ventana",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l.tipo===3||l.tipo===46?(z(),be(Z,{key:0},[o(p,{cols:"6",sm:"3"},{default:i(()=>[o(A,{modelValue:l.hojas_totales,"onUpdate:modelValue":r=>l.hojas_totales=r,items:[2,3,4,6],label:"Hojas totales",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"6",sm:"3"},{default:i(()=>[o(A,{modelValue:l.hojas_moviles,"onUpdate:modelValue":r=>l.hojas_moviles=r,items:[1,2,3,4],label:"Hojas móviles",disabled:!l.hojas_totales,rules:[r=>!r||r<=l.hojas_totales||"No puede exceder total"],outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","disabled","rules"])]),_:2},1024)],64)):te("",!0),o(p,{cols:"6",sm:"3"},{default:i(()=>[o(k,{modelValue:l.ancho,"onUpdate:modelValue":r=>l.ancho=r,label:"Ancho (mm)",type:"number",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"6",sm:"3"},{default:i(()=>[o(k,{modelValue:l.alto,"onUpdate:modelValue":r=>l.alto=r,label:"Alto (mm)",type:"number",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"12"},{default:i(()=>[o(il,{ancho:l.ancho,alto:l.alto,modelo:"/modelos/ventana.glb"},null,8,["ancho","alto"])]),_:2},1024),o(p,{cols:"12",sm:"3"},{default:i(()=>[o(k,{modelValue:l.cantidad,"onUpdate:modelValue":r=>l.cantidad=r,label:"Cantidad",type:"number",min:"1",rules:[r=>r>0||"Debe ser mayor a 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),o(p,{cols:"12",sm:"3"},{default:i(()=>[o(A,{modelValue:l.material,"onUpdate:modelValue":r=>l.material=r,items:w.value,"item-title":"nombre","item-value":"id",label:"Material (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(p,{cols:"12",sm:"3"},{default:i(()=>[o(A,{modelValue:l.color,"onUpdate:modelValue":r=>l.color=r,items:P.value,"item-title":"nombre","item-value":"id",label:"Color (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(p,{cols:"12",sm:"3"},{default:i(()=>[o(A,{modelValue:l.tipoVidrio,"onUpdate:modelValue":r=>l.tipoVidrio=r,items:S.value,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(p,{cols:"12",sm:"3"},{default:i(()=>[o(A,{modelValue:l.productoVidrioProveedor,"onUpdate:modelValue":r=>l.productoVidrioProveedor=r,items:de(l),"item-title":"nombre","item-value":"id",label:"Producto de vidrio (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(p,{cols:"12"},{default:i(()=>[l.costo_total_unitario?(z(),Y(Ce,{key:0,type:"info",variant:"outlined",dense:"",class:"mb-2"},{default:i(()=>[e[24]||(e[24]=_e("strong",null,"Costo unitario:",-1)),y(" $"+J(l.costo_total_unitario.toLocaleString()),1)]),_:2},1024)):te("",!0),l.costo_total?(z(),Y(Ce,{key:1,type:"info",variant:"tonal",dense:"",class:"mb-2"},{default:i(()=>[e[25]||(e[25]=_e("strong",null,"Costo total de materiales:",-1)),y(" $"+J(l.costo_total.toLocaleString()),1)]),_:2},1024)):te("",!0),l.precio?(z(),Y(Ce,{key:2,type:"success",variant:"tonal",dense:"",class:"mt-2"},{default:i(()=>[e[26]||(e[26]=_e("strong",null,"Precio sugerido:",-1)),y(" $"+J(l.precio.toLocaleString()),1)]),_:2},1024)):te("",!0),o(H,{onClick:r=>m.value[n]=!m.value[n],color:"primary",variant:"outlined"},{default:i(()=>[o(X,{left:""},{default:i(()=>e[27]||(e[27]=[y("mdi-eye")])),_:1}),y(" "+J(m.value[n]?"Ocultar":"Ver")+" Costos ",1)]),_:2},1032,["onClick"]),m.value[n]&&l.materiales&&l.materiales.length?(z(),Y(Vl,{key:3,headers:[{title:"Producto",key:"nombre"},{title:"Proveedor",key:"proveedor"},{title:"Cantidad",key:"cantidad"},{title:"Unidad",key:"unidad"},{title:"Costo Unitario",key:"costo_unitario"},{title:"Costo Total",key:"costo_total"}],items:l.materiales,"items-per-page":-1,class:"elevation-1 mt-4","hide-default-footer":""},{"item.costo_unitario":i(({item:r})=>[y(" $"+J(r.costo_unitario.toLocaleString()),1)]),"item.costo_total":i(({item:r})=>[y(" $"+J(r.costo_total.toLocaleString()),1)]),_:2},1032,["items"])):te("",!0)]),_:2},1024),o(p,{cols:"12",class:"text-right"},{default:i(()=>[o(H,{color:"error",variant:"outlined",onClick:r=>me(n)},{default:i(()=>[o(X,{left:""},{default:i(()=>e[28]||(e[28]=[y("mdi-delete")])),_:1}),e[29]||(e[29]=y(" Quitar ventana "))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),o(H,{onClick:ce,color:"primary",variant:"outlined",class:"mb-4"},{default:i(()=>[o(X,{left:""},{default:i(()=>e[30]||(e[30]=[y("mdi-plus")])),_:1}),e[31]||(e[31]=y(" Agregar ventana "))]),_:1}),o(re,{class:"my-4"}),o(H,{color:"primary",onClick:I,block:"","prepend-icon":"mdi-content-save",elevation:"2",class:"py-4"},{default:i(()=>e[32]||(e[32]=[y(" Guardar Cotización ")])),_:1})]),_:1}),o(Pl,{modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=l=>V.value=l),"max-width":"600px"},{default:i(()=>[o(ye,null,{default:i(()=>[o(Ue,null,{default:i(()=>e[33]||(e[33]=[y("Nuevo Cliente")])),_:1}),o(Ul,null,{default:i(()=>[o(Sl,{ref:"formNuevoCliente",onSubmit:tl(O,["prevent"])},{default:i(()=>[o(M,{dense:""},{default:i(()=>[o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.firstName,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value.firstName=l),label:"Nombre"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.lastName,"onUpdate:modelValue":e[8]||(e[8]=l=>b.value.lastName=l),label:"Apellido"},null,8,["modelValue"])]),_:1})]),_:1}),o(M,{dense:""},{default:i(()=>[o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.company,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value.company=l),label:"Razón Social"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.code,"onUpdate:modelValue":e[10]||(e[10]=l=>b.value.code=l),label:"RUT"},null,8,["modelValue"])]),_:1})]),_:1}),o(M,{dense:""},{default:i(()=>[o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.email,"onUpdate:modelValue":e[11]||(e[11]=l=>b.value.email=l),label:"Email"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.phone,"onUpdate:modelValue":e[12]||(e[12]=l=>b.value.phone=l),label:"Teléfono"},null,8,["modelValue"])]),_:1})]),_:1}),o(M,{dense:""},{default:i(()=>[o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.city,"onUpdate:modelValue":e[13]||(e[13]=l=>b.value.city=l),label:"Ciudad"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:i(()=>[o(k,{modelValue:b.value.municipality,"onUpdate:modelValue":e[14]||(e[14]=l=>b.value.municipality=l),label:"Comuna"},null,8,["modelValue"])]),_:1})]),_:1}),o(k,{modelValue:b.value.address,"onUpdate:modelValue":e[15]||(e[15]=l=>b.value.address=l),label:"Dirección"},null,8,["modelValue"]),o(k,{modelValue:b.value.activity,"onUpdate:modelValue":e[16]||(e[16]=l=>b.value.activity=l),label:"Giro"},null,8,["modelValue"])]),_:1},512)]),_:1}),o(nl,null,{default:i(()=>[o(Dl),o(H,{text:"",onClick:e[17]||(e[17]=l=>V.value=!1)},{default:i(()=>e[34]||(e[34]=[y("Cancelar")])),_:1}),o(H,{color:"primary",onClick:O},{default:i(()=>e[35]||(e[35]=[y("Guardar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},so=ul(El,[["__scopeId","data-v-1764c8e5"]]);export{so as default};
