import{d as ar}from"./debounce-IC_wrsGR.js";import{a6 as ps,a7 as ms,aE as lr,aj as hr,Y as ur,aF as cr,aG as dr,aH as pr,ao as mr,aI as fr,ak as gr,aa as fs,b as N,aq as yr,ah as xr,ar as Tr,aJ as Nr,as as wr,aK as Sr,aL as Mr,ai as _r,aM as vr,X as Y,a as _t,c as rs,o as we,e as b,al as Cr,r as le,av as vt,a8 as Ds,am as Er,aw as zr,w as Je,ay as Ti,q as ke,ab as tn,aN as Ar,az as Fr,F as ot,Z as gt,aA as br,aB as Rr,aC as Vr,t as ae,aD as Ir,a9 as Lr,aO as Pr,at as Ni,aP as Or,E as kr,au as Xe,f as Pe,k as Br,a3 as Ct,i as Dr,m as it,d as vs,v as ht}from"./index-jEEivdNe.js";/* empty css                                                                */import{_ as Ur}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Hr}from"./VistaVentanaCorredera-MGj6YLlS.js";import{V as $r}from"./VContainer-DeVJ0jFZ.js";import{V as wi,b as Gr,d as Cs}from"./VCard-BVM4fv5B.js";import{V as Wt}from"./VDivider-D6bfoShh.js";import{V as ut,a as Q}from"./VRow-lYqLH-yh.js";import{u as qr,m as Yr,a as Xr,V as Ee}from"./VSelect-Be64rhu5.js";import{V as Ot,m as Zr}from"./VTextField-Bu5BV4SA.js";import{u as Wr,m as jr,V as Kr}from"./VDataTable-Ct2pyte-.js";import{u as Jr,V as Si,m as Qr,a as eo}from"./VInput-lRgvfACv.js";import{f as to}from"./forwardRefs-DWGaNmQL.js";import{u as so,t as Et,V as io,a as Mi}from"./VList-9YkiQUn2.js";import{m as no}from"./transition-Bbm_uaxY.js";import{V as ro}from"./VMenu-Cv4tyMKU.js";import{V as oo}from"./VCheckboxBtn-DLZjWRIr.js";import{V as ao}from"./VAvatar-Dk5Ecluw.js";import{V as lo}from"./VChip-DwGqwQen.js";import{V as ho}from"./VTextarea-CeH5qJ_G.js";import{V as Us,m as uo,a as co,b as po}from"./VSelectionControl-BVetK15Z.js";import{V as Es}from"./VAlert-v9xRJ9Ax.js";/* empty css              */import"./VCardText-kQd5-tNv.js";import"./VImg-CWuqWPdC.js";import"./VOverlay-DoAKUCB3.js";const mo=ms({color:String,...vr(),..._r(),...Mr(),...Sr(),...wr(),...Nr(),...Tr(),...xr(),...yr()},"VSheet"),fo=ps()({name:"VSheet",props:mo(),setup(r,e){let{slots:t}=e;const{themeClasses:s}=lr(r),{backgroundColorClasses:i,backgroundColorStyles:n}=hr(ur(r,"color")),{borderClasses:o}=cr(r),{dimensionStyles:a}=dr(r),{elevationClasses:l}=pr(r),{locationStyles:h}=mr(r),{positionClasses:u}=fr(r),{roundedClasses:c}=gr(r);return fs(()=>N(r.tag,{class:["v-sheet",s.value,i.value,o.value,l.value,u.value,c.value,r.class],style:[n.value,a.value,h.value,r.style]},t)),{}}}),O=50,go=60,_i=300,yo={__name:"VistaVentanaFijaS60",props:{ancho:{type:Number,required:!0},alto:{type:Number,required:!0},colorMarco:{type:String,default:"#000000"}},setup(r){const e={blanco:"#ffffff",negro:"#0a0a0a",gris:"#808080",grafito:"#2f2f2f",nogal:"#8b5a2b"},t={roble:new Image,nogal:new Image};t.roble.src=new URL("/assets/roble-DlssfbLU.png",import.meta.url).href,t.nogal.src=new URL("/assets/nogal-Lbu-T-XE.png",import.meta.url).href;function s(P){var L,z;const k=typeof n.colorMarco=="object"?(z=(L=n.colorMarco)==null?void 0:L.nombre)==null?void 0:z.toLowerCase():n.colorMarco.toLowerCase();return["roble","nogal"].includes(k)&&t[k]?{points:P,closed:!0,fillPatternImage:t[k],fillPatternRepeat:"repeat",fillPatternScale:{x:.2,y:.2},stroke:"black"}:{points:P,closed:!0,fill:i.value,stroke:"black"}}const i=Y(()=>{var P;return typeof n.colorMarco=="string"?e[n.colorMarco.toLowerCase()]||"#ffffff":typeof n.colorMarco=="object"&&((P=n.colorMarco)!=null&&P.nombre)&&e[n.colorMarco.nombre.toLowerCase()]||"#ffffff"}),n=r,o=Y(()=>{const P=_i/n.ancho,k=_i/n.alto;return Math.min(P,k,1)*.9}),a=Y(()=>go*o.value),l=Y(()=>n.ancho*o.value),h=Y(()=>n.alto*o.value),u={width:400,height:400},c=Y(()=>s([O,O,O+l.value,O,O+l.value-a.value,O+a.value,O+a.value,O+a.value])),p=Y(()=>s([O+l.value,O,O+l.value,O+h.value,O+l.value-a.value,O+h.value-a.value,O+l.value-a.value,O+a.value])),d=Y(()=>s([O+l.value,O+h.value,O,O+h.value,O+a.value,O+h.value-a.value,O+l.value-a.value,O+h.value-a.value])),g=Y(()=>s([O,O+h.value,O,O,O+a.value,O+a.value,O+a.value,O+h.value-a.value])),w=Y(()=>({x:O+a.value,y:O+a.value,width:l.value-a.value*2,height:h.value-a.value*2,fill:"#b3e5fc",stroke:"black"})),C=Y(()=>{const P=Math.max(n.ancho,n.alto);return Math.min(Math.max(P/100,20),40)}),v=Y(()=>({x:O+l.value/2-30,y:O+h.value+10,text:`${n.ancho}mm`,fontSize:C.value,fill:"black"})),H=Y(()=>({x:O-25,y:O+h.value/2,text:`${n.alto}mm`,fontSize:C.value,fill:"black",rotation:-90,offsetX:C.value/2}));return(P,k)=>{const L=_t("v-line"),z=_t("v-rect"),V=_t("v-text"),he=_t("v-layer"),oe=_t("v-stage");return we(),rs("div",null,[N(fo,{height:"400",class:"pa-4",color:"surface"},{default:b(()=>[N(oe,{config:u},{default:b(()=>[N(he,null,{default:b(()=>[N(L,{config:c.value},null,8,["config"]),N(L,{config:p.value},null,8,["config"]),N(L,{config:d.value},null,8,["config"]),N(L,{config:g.value},null,8,["config"]),N(z,{config:w.value},null,8,["config"]),N(V,{config:v.value},null,8,["config"]),N(V,{config:H.value},null,8,["config"])]),_:1})]),_:1})]),_:1})])}}},jt={VERTEX:"vertex"},re={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ut=["x","y","z","w"],ce=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let vi=1234567;const sn=Math.PI/180,nn=180/Math.PI;function xt(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ce[r&255]+ce[r>>8&255]+ce[r>>16&255]+ce[r>>24&255]+"-"+ce[e&255]+ce[e>>8&255]+"-"+ce[e>>16&15|64]+ce[e>>24&255]+"-"+ce[t&63|128]+ce[t>>8&255]+"-"+ce[t>>16&255]+ce[t>>24&255]+ce[s&255]+ce[s>>8&255]+ce[s>>16&255]+ce[s>>24&255]).toLowerCase()}function D(r,e,t){return Math.max(e,Math.min(t,r))}function Zs(r,e){return(r%e+e)%e}function xo(r,e,t,s,i){return s+(r-e)*(i-s)/(t-e)}function To(r,e,t){return r!==e?(t-r)/(e-r):0}function kt(r,e,t){return(1-t)*r+t*e}function No(r,e,t,s){return kt(r,e,1-Math.exp(-t*s))}function wo(r,e=1){return e-Math.abs(Zs(r,e*2)-e)}function So(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function Mo(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function _o(r,e){return r+Math.floor(Math.random()*(e-r+1))}function vo(r,e){return r+Math.random()*(e-r)}function Co(r){return r*(.5-Math.random())}function Eo(r){r!==void 0&&(vi=r);let e=vi+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function zo(r){return r*sn}function Ao(r){return r*nn}function Fo(r){return(r&r-1)===0&&r!==0}function bo(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Ro(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Vo(r,e,t,s,i){const n=Math.cos,o=Math.sin,a=n(t/2),l=o(t/2),h=n((e+s)/2),u=o((e+s)/2),c=n((e-s)/2),p=o((e-s)/2),d=n((s-e)/2),g=o((s-e)/2);switch(i){case"XYX":r.set(a*u,l*c,l*p,a*h);break;case"YZY":r.set(l*p,a*u,l*c,a*h);break;case"ZXZ":r.set(l*c,l*p,a*u,a*h);break;case"XZX":r.set(a*u,l*g,l*d,a*h);break;case"YXY":r.set(l*d,a*u,l*g,a*h);break;case"ZYZ":r.set(l*g,l*d,a*u,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function be(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function G(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Io={DEG2RAD:sn,RAD2DEG:nn,generateUUID:xt,clamp:D,euclideanModulo:Zs,mapLinear:xo,inverseLerp:To,lerp:kt,damp:No,pingpong:wo,smoothstep:So,smootherstep:Mo,randInt:_o,randFloat:vo,randFloatSpread:Co,seededRandom:Eo,degToRad:zo,radToDeg:Ao,isPowerOfTwo:Fo,ceilPowerOfTwo:bo,floorPowerOfTwo:Ro,setQuaternionFromProperEuler:Vo,normalize:G,denormalize:be},Lo=1,Hs=0,Ws=300,rn=301,Po=302,Ci=1e3,Kt=1001,Ei=1002,Nt=1003,$s=1006,on=1008,Oo=1009,ko=1013,an=1014,Bo=1015,Do=1016,Uo=1023,zi=1026,Ho=1027,Ai=0,$o=1,as="",Fe="srgb",Fi="srgb-linear",bi="linear",Bt="srgb",ls=35044,Qe=2e3,hs=2001;class Ie{constructor(e,t,s,i,n,o,a,l,h){Ie.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,i,n,o,a,l,h)}set(e,t,s,i,n,o,a,l,h){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=n,u[5]=l,u[6]=s,u[7]=o,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,n=this.elements,o=s[0],a=s[3],l=s[6],h=s[1],u=s[4],c=s[7],p=s[2],d=s[5],g=s[8],w=i[0],C=i[3],v=i[6],H=i[1],P=i[4],k=i[7],L=i[2],z=i[5],V=i[8];return n[0]=o*w+a*H+l*L,n[3]=o*C+a*P+l*z,n[6]=o*v+a*k+l*V,n[1]=h*w+u*H+c*L,n[4]=h*C+u*P+c*z,n[7]=h*v+u*k+c*V,n[2]=p*w+d*H+g*L,n[5]=p*C+d*P+g*z,n[8]=p*v+d*k+g*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8];return t*o*u-t*a*h-s*n*u+s*a*l+i*n*h-i*o*l}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=u*o-a*h,p=a*l-u*n,d=h*n-o*l,g=t*c+s*p+i*d;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/g;return e[0]=c*w,e[1]=(i*h-u*s)*w,e[2]=(a*s-i*o)*w,e[3]=p*w,e[4]=(u*t-i*l)*w,e[5]=(i*n-a*t)*w,e[6]=d*w,e[7]=(s*l-h*t)*w,e[8]=(o*t-s*n)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,i,n,o,a){const l=Math.cos(n),h=Math.sin(n);return this.set(s*l,s*h,-s*(l*o+h*a)+o+e,-i*h,i*l,-i*(-h*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(zs.makeScale(e,t)),this}rotate(e){return this.premultiply(zs.makeRotation(-e)),this}translate(e,t){return this.premultiply(zs.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<9;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const zs=new Ie;function Ri(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const Vi={};function Ii(r){r in Vi||(Vi[r]=!0,console.warn(r))}const Li=new Ie().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Pi=new Ie().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Go(){const r={enabled:!0,workingColorSpace:Fi,spaces:{},convert:function(i,n,o){return this.enabled===!1||n===o||!n||!o||(this.spaces[n].transfer===Bt&&(i.r=Be(i.r),i.g=Be(i.g),i.b=Be(i.b)),this.spaces[n].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[n].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Bt&&(i.r=Tt(i.r),i.g=Tt(i.g),i.b=Tt(i.b))),i},workingToColorSpace:function(i,n){return this.convert(i,this.workingColorSpace,n)},colorSpaceToWorking:function(i,n){return this.convert(i,n,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===as?bi:this.spaces[i].transfer},getLuminanceCoefficients:function(i,n=this.workingColorSpace){return i.fromArray(this.spaces[n].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,n,o){return i.copy(this.spaces[n].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,n){return Ii("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(i,n)},toWorkingColorSpace:function(i,n){return Ii("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(i,n)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],s=[.3127,.329];return r.define({[Fi]:{primaries:e,whitePoint:s,transfer:bi,toXYZ:Li,fromXYZ:Pi,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Fe},outputColorSpaceConfig:{drawingBufferColorSpace:Fe}},[Fe]:{primaries:e,whitePoint:s,transfer:Bt,toXYZ:Li,fromXYZ:Pi,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Fe}}}),r}const ne=Go();function Be(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Tt(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const ln={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ze={h:0,s:0,l:0},Jt={h:0,s:0,l:0};function As(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class js{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,s)}set(e,t,s){if(t===void 0&&s===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Fe){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ne.colorSpaceToWorking(this,t),this}setRGB(e,t,s,i=ne.workingColorSpace){return this.r=e,this.g=t,this.b=s,ne.colorSpaceToWorking(this,i),this}setHSL(e,t,s,i=ne.workingColorSpace){if(e=Zs(e,1),t=D(t,0,1),s=D(s,0,1),t===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+t):s+t-s*t,o=2*s-n;this.r=As(o,n,e+1/3),this.g=As(o,n,e),this.b=As(o,n,e-1/3)}return ne.colorSpaceToWorking(this,i),this}setStyle(e,t=Fe){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let n;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,t);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],o=n.length;if(o===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Fe){const s=ln[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Be(e.r),this.g=Be(e.g),this.b=Be(e.b),this}copyLinearToSRGB(e){return this.r=Tt(e.r),this.g=Tt(e.g),this.b=Tt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Fe){return ne.workingToColorSpace(de.copy(this),e),Math.round(D(de.r*255,0,255))*65536+Math.round(D(de.g*255,0,255))*256+Math.round(D(de.b*255,0,255))}getHexString(e=Fe){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ne.workingColorSpace){ne.workingToColorSpace(de.copy(this),t);const s=de.r,i=de.g,n=de.b,o=Math.max(s,i,n),a=Math.min(s,i,n);let l,h;const u=(a+o)/2;if(a===o)l=0,h=0;else{const c=o-a;switch(h=u<=.5?c/(o+a):c/(2-o-a),o){case s:l=(i-n)/c+(i<n?6:0);break;case i:l=(n-s)/c+2;break;case n:l=(s-i)/c+4;break}l/=6}return e.h=l,e.s=h,e.l=u,e}getRGB(e,t=ne.workingColorSpace){return ne.workingToColorSpace(de.copy(this),t),e.r=de.r,e.g=de.g,e.b=de.b,e}getStyle(e=Fe){ne.workingToColorSpace(de.copy(this),e);const t=de.r,s=de.g,i=de.b;return e!==Fe?`color(${e} ${t.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(e,t,s){return this.getHSL(Ze),this.setHSL(Ze.h+e,Ze.s+t,Ze.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(Ze),e.getHSL(Jt);const s=kt(Ze.h,Jt.h,t),i=kt(Ze.s,Jt.s,t),n=kt(Ze.l,Jt.l,t);return this.setHSL(s,i,n),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,s=this.g,i=this.b,n=e.elements;return this.r=n[0]*t+n[3]*s+n[6]*i,this.g=n[1]*t+n[4]*s+n[7]*i,this.b=n[2]*t+n[5]*s+n[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const de=new js;js.NAMES=ln;class Ks{constructor(e,t,s,i){Ks.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,s,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let s=0;s<4;s++)this.elements[s]=e[s+t];return this}set(e,t,s,i){const n=this.elements;return n[0]=e,n[2]=t,n[1]=s,n[3]=i,this}}class hn{constructor(e=0,t=0,s=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=i}static slerpFlat(e,t,s,i,n,o,a){let l=s[i+0],h=s[i+1],u=s[i+2],c=s[i+3];const p=n[o+0],d=n[o+1],g=n[o+2],w=n[o+3];if(a===0){e[t+0]=l,e[t+1]=h,e[t+2]=u,e[t+3]=c;return}if(a===1){e[t+0]=p,e[t+1]=d,e[t+2]=g,e[t+3]=w;return}if(c!==w||l!==p||h!==d||u!==g){let C=1-a;const v=l*p+h*d+u*g+c*w,H=v>=0?1:-1,P=1-v*v;if(P>Number.EPSILON){const L=Math.sqrt(P),z=Math.atan2(L,v*H);C=Math.sin(C*z)/L,a=Math.sin(a*z)/L}const k=a*H;if(l=l*C+p*k,h=h*C+d*k,u=u*C+g*k,c=c*C+w*k,C===1-a){const L=1/Math.sqrt(l*l+h*h+u*u+c*c);l*=L,h*=L,u*=L,c*=L}}e[t]=l,e[t+1]=h,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,s,i,n,o){const a=s[i],l=s[i+1],h=s[i+2],u=s[i+3],c=n[o],p=n[o+1],d=n[o+2],g=n[o+3];return e[t]=a*g+u*c+l*d-h*p,e[t+1]=l*g+u*p+h*c-a*d,e[t+2]=h*g+u*d+a*p-l*c,e[t+3]=u*g-a*c-l*p-h*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,i){return this._x=e,this._y=t,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,i=e._y,n=e._z,o=e._order,a=Math.cos,l=Math.sin,h=a(s/2),u=a(i/2),c=a(n/2),p=l(s/2),d=l(i/2),g=l(n/2);switch(o){case"XYZ":this._x=p*u*c+h*d*g,this._y=h*d*c-p*u*g,this._z=h*u*g+p*d*c,this._w=h*u*c-p*d*g;break;case"YXZ":this._x=p*u*c+h*d*g,this._y=h*d*c-p*u*g,this._z=h*u*g-p*d*c,this._w=h*u*c+p*d*g;break;case"ZXY":this._x=p*u*c-h*d*g,this._y=h*d*c+p*u*g,this._z=h*u*g+p*d*c,this._w=h*u*c-p*d*g;break;case"ZYX":this._x=p*u*c-h*d*g,this._y=h*d*c+p*u*g,this._z=h*u*g-p*d*c,this._w=h*u*c+p*d*g;break;case"YZX":this._x=p*u*c+h*d*g,this._y=h*d*c+p*u*g,this._z=h*u*g-p*d*c,this._w=h*u*c-p*d*g;break;case"XZY":this._x=p*u*c-h*d*g,this._y=h*d*c-p*u*g,this._z=h*u*g+p*d*c,this._w=h*u*c+p*d*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,i=Math.sin(s);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],i=t[4],n=t[8],o=t[1],a=t[5],l=t[9],h=t[2],u=t[6],c=t[10],p=s+a+c;if(p>0){const d=.5/Math.sqrt(p+1);this._w=.25/d,this._x=(u-l)*d,this._y=(n-h)*d,this._z=(o-i)*d}else if(s>a&&s>c){const d=2*Math.sqrt(1+s-a-c);this._w=(u-l)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(n+h)/d}else if(a>c){const d=2*Math.sqrt(1+a-s-c);this._w=(n-h)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(l+u)/d}else{const d=2*Math.sqrt(1+c-s-a);this._w=(o-i)/d,this._x=(n+h)/d,this._y=(l+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(D(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const i=Math.min(1,t/s);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,i=e._y,n=e._z,o=e._w,a=t._x,l=t._y,h=t._z,u=t._w;return this._x=s*u+o*a+i*h-n*l,this._y=i*u+o*l+n*a-s*h,this._z=n*u+o*h+s*l-i*a,this._w=o*u-s*a-i*l-n*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const s=this._x,i=this._y,n=this._z,o=this._w;let a=o*e._w+s*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=s,this._y=i,this._z=n,this;const l=1-a*a;if(l<=Number.EPSILON){const d=1-t;return this._w=d*o+t*this._w,this._x=d*s+t*this._x,this._y=d*i+t*this._y,this._z=d*n+t*this._z,this.normalize(),this}const h=Math.sqrt(l),u=Math.atan2(h,a),c=Math.sin((1-t)*u)/h,p=Math.sin(t*u)/h;return this._w=o*c+this._w*p,this._x=s*c+this._x*p,this._y=i*c+this._y*p,this._z=n*c+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(e),i*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class R{constructor(e=0,t=0,s=0){R.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Oi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Oi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*s+n[6]*i,this.y=n[1]*t+n[4]*s+n[7]*i,this.z=n[2]*t+n[5]*s+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*s+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*s+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*s+n[10]*i+n[14])*o,this}applyQuaternion(e){const t=this.x,s=this.y,i=this.z,n=e.x,o=e.y,a=e.z,l=e.w,h=2*(o*i-a*s),u=2*(a*t-n*i),c=2*(n*s-o*t);return this.x=t+l*h+o*c-a*u,this.y=s+l*u+a*h-n*c,this.z=i+l*c+n*u-o*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*s+n[8]*i,this.y=n[1]*t+n[5]*s+n[9]*i,this.z=n[2]*t+n[6]*s+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=D(this.x,e.x,t.x),this.y=D(this.y,e.y,t.y),this.z=D(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=D(this.x,e,t),this.y=D(this.y,e,t),this.z=D(this.z,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(D(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,i=e.y,n=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-n*a,this.y=n*o-s*l,this.z=s*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return Fs.copy(this).projectOnVector(e),this.sub(Fs)}reflect(e){return this.sub(Fs.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(D(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,i=this.z-e.z;return t*t+s*s+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const i=Math.sin(t)*e;return this.x=i*Math.sin(s),this.y=Math.cos(t)*e,this.z=i*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Fs=new R,Oi=new hn;class Ve{constructor(e,t,s,i,n,o,a,l,h,u,c,p,d,g,w,C){Ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,i,n,o,a,l,h,u,c,p,d,g,w,C)}set(e,t,s,i,n,o,a,l,h,u,c,p,d,g,w,C){const v=this.elements;return v[0]=e,v[4]=t,v[8]=s,v[12]=i,v[1]=n,v[5]=o,v[9]=a,v[13]=l,v[2]=h,v[6]=u,v[10]=c,v[14]=p,v[3]=d,v[7]=g,v[11]=w,v[15]=C,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ve().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,i=1/ct.setFromMatrixColumn(e,0).length(),n=1/ct.setFromMatrixColumn(e,1).length(),o=1/ct.setFromMatrixColumn(e,2).length();return t[0]=s[0]*i,t[1]=s[1]*i,t[2]=s[2]*i,t[3]=0,t[4]=s[4]*n,t[5]=s[5]*n,t[6]=s[6]*n,t[7]=0,t[8]=s[8]*o,t[9]=s[9]*o,t[10]=s[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,i=e.y,n=e.z,o=Math.cos(s),a=Math.sin(s),l=Math.cos(i),h=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if(e.order==="XYZ"){const p=o*u,d=o*c,g=a*u,w=a*c;t[0]=l*u,t[4]=-l*c,t[8]=h,t[1]=d+g*h,t[5]=p-w*h,t[9]=-a*l,t[2]=w-p*h,t[6]=g+d*h,t[10]=o*l}else if(e.order==="YXZ"){const p=l*u,d=l*c,g=h*u,w=h*c;t[0]=p+w*a,t[4]=g*a-d,t[8]=o*h,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=d*a-g,t[6]=w+p*a,t[10]=o*l}else if(e.order==="ZXY"){const p=l*u,d=l*c,g=h*u,w=h*c;t[0]=p-w*a,t[4]=-o*c,t[8]=g+d*a,t[1]=d+g*a,t[5]=o*u,t[9]=w-p*a,t[2]=-o*h,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const p=o*u,d=o*c,g=a*u,w=a*c;t[0]=l*u,t[4]=g*h-d,t[8]=p*h+w,t[1]=l*c,t[5]=w*h+p,t[9]=d*h-g,t[2]=-h,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const p=o*l,d=o*h,g=a*l,w=a*h;t[0]=l*u,t[4]=w-p*c,t[8]=g*c+d,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-h*u,t[6]=d*c+g,t[10]=p-w*c}else if(e.order==="XZY"){const p=o*l,d=o*h,g=a*l,w=a*h;t[0]=l*u,t[4]=-c,t[8]=h*u,t[1]=p*c+w,t[5]=o*u,t[9]=d*c-g,t[2]=g*c-d,t[6]=a*u,t[10]=w*c+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(qo,e,Yo)}lookAt(e,t,s){const i=this.elements;return Ne.subVectors(e,t),Ne.lengthSq()===0&&(Ne.z=1),Ne.normalize(),We.crossVectors(s,Ne),We.lengthSq()===0&&(Math.abs(s.z)===1?Ne.x+=1e-4:Ne.z+=1e-4,Ne.normalize(),We.crossVectors(s,Ne)),We.normalize(),Qt.crossVectors(Ne,We),i[0]=We.x,i[4]=Qt.x,i[8]=Ne.x,i[1]=We.y,i[5]=Qt.y,i[9]=Ne.y,i[2]=We.z,i[6]=Qt.z,i[10]=Ne.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,n=this.elements,o=s[0],a=s[4],l=s[8],h=s[12],u=s[1],c=s[5],p=s[9],d=s[13],g=s[2],w=s[6],C=s[10],v=s[14],H=s[3],P=s[7],k=s[11],L=s[15],z=i[0],V=i[4],he=i[8],oe=i[12],F=i[1],y=i[5],f=i[9],I=i[13],E=i[2],W=i[6],ue=i[10],Ge=i[14],qe=i[3],Ye=i[7],at=i[11],lt=i[15];return n[0]=o*z+a*F+l*E+h*qe,n[4]=o*V+a*y+l*W+h*Ye,n[8]=o*he+a*f+l*ue+h*at,n[12]=o*oe+a*I+l*Ge+h*lt,n[1]=u*z+c*F+p*E+d*qe,n[5]=u*V+c*y+p*W+d*Ye,n[9]=u*he+c*f+p*ue+d*at,n[13]=u*oe+c*I+p*Ge+d*lt,n[2]=g*z+w*F+C*E+v*qe,n[6]=g*V+w*y+C*W+v*Ye,n[10]=g*he+w*f+C*ue+v*at,n[14]=g*oe+w*I+C*Ge+v*lt,n[3]=H*z+P*F+k*E+L*qe,n[7]=H*V+P*y+k*W+L*Ye,n[11]=H*he+P*f+k*ue+L*at,n[15]=H*oe+P*I+k*Ge+L*lt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],i=e[8],n=e[12],o=e[1],a=e[5],l=e[9],h=e[13],u=e[2],c=e[6],p=e[10],d=e[14],g=e[3],w=e[7],C=e[11],v=e[15];return g*(+n*l*c-i*h*c-n*a*p+s*h*p+i*a*d-s*l*d)+w*(+t*l*d-t*h*p+n*o*p-i*o*d+i*h*u-n*l*u)+C*(+t*h*c-t*a*d-n*o*c+s*o*d+n*a*u-s*h*u)+v*(-i*a*u-t*l*c+t*a*p+i*o*c-s*o*p+s*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=e[9],p=e[10],d=e[11],g=e[12],w=e[13],C=e[14],v=e[15],H=c*C*h-w*p*h+w*l*d-a*C*d-c*l*v+a*p*v,P=g*p*h-u*C*h-g*l*d+o*C*d+u*l*v-o*p*v,k=u*w*h-g*c*h+g*a*d-o*w*d-u*a*v+o*c*v,L=g*c*l-u*w*l-g*a*p+o*w*p+u*a*C-o*c*C,z=t*H+s*P+i*k+n*L;if(z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const V=1/z;return e[0]=H*V,e[1]=(w*p*n-c*C*n-w*i*d+s*C*d+c*i*v-s*p*v)*V,e[2]=(a*C*n-w*l*n+w*i*h-s*C*h-a*i*v+s*l*v)*V,e[3]=(c*l*n-a*p*n-c*i*h+s*p*h+a*i*d-s*l*d)*V,e[4]=P*V,e[5]=(u*C*n-g*p*n+g*i*d-t*C*d-u*i*v+t*p*v)*V,e[6]=(g*l*n-o*C*n-g*i*h+t*C*h+o*i*v-t*l*v)*V,e[7]=(o*p*n-u*l*n+u*i*h-t*p*h-o*i*d+t*l*d)*V,e[8]=k*V,e[9]=(g*c*n-u*w*n-g*s*d+t*w*d+u*s*v-t*c*v)*V,e[10]=(o*w*n-g*a*n+g*s*h-t*w*h-o*s*v+t*a*v)*V,e[11]=(u*a*n-o*c*n-u*s*h+t*c*h+o*s*d-t*a*d)*V,e[12]=L*V,e[13]=(u*w*i-g*c*i+g*s*p-t*w*p-u*s*C+t*c*C)*V,e[14]=(g*a*i-o*w*i-g*s*l+t*w*l+o*s*C-t*a*C)*V,e[15]=(o*c*i-u*a*i+u*s*l-t*c*l-o*s*p+t*a*p)*V,this}scale(e){const t=this.elements,s=e.x,i=e.y,n=e.z;return t[0]*=s,t[4]*=i,t[8]*=n,t[1]*=s,t[5]*=i,t[9]*=n,t[2]*=s,t[6]*=i,t[10]*=n,t[3]*=s,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,i))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),i=Math.sin(t),n=1-s,o=e.x,a=e.y,l=e.z,h=n*o,u=n*a;return this.set(h*o+s,h*a-i*l,h*l+i*a,0,h*a+i*l,u*a+s,u*l-i*o,0,h*l-i*a,u*l+i*o,n*l*l+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,i,n,o){return this.set(1,s,n,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,s){const i=this.elements,n=t._x,o=t._y,a=t._z,l=t._w,h=n+n,u=o+o,c=a+a,p=n*h,d=n*u,g=n*c,w=o*u,C=o*c,v=a*c,H=l*h,P=l*u,k=l*c,L=s.x,z=s.y,V=s.z;return i[0]=(1-(w+v))*L,i[1]=(d+k)*L,i[2]=(g-P)*L,i[3]=0,i[4]=(d-k)*z,i[5]=(1-(p+v))*z,i[6]=(C+H)*z,i[7]=0,i[8]=(g+P)*V,i[9]=(C-H)*V,i[10]=(1-(p+w))*V,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,s){const i=this.elements;let n=ct.set(i[0],i[1],i[2]).length();const o=ct.set(i[4],i[5],i[6]).length(),a=ct.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],ze.copy(this);const h=1/n,u=1/o,c=1/a;return ze.elements[0]*=h,ze.elements[1]*=h,ze.elements[2]*=h,ze.elements[4]*=u,ze.elements[5]*=u,ze.elements[6]*=u,ze.elements[8]*=c,ze.elements[9]*=c,ze.elements[10]*=c,t.setFromRotationMatrix(ze),s.x=n,s.y=o,s.z=a,this}makePerspective(e,t,s,i,n,o,a=Qe){const l=this.elements,h=2*n/(t-e),u=2*n/(s-i),c=(t+e)/(t-e),p=(s+i)/(s-i);let d,g;if(a===Qe)d=-(o+n)/(o-n),g=-2*o*n/(o-n);else if(a===hs)d=-o/(o-n),g=-o*n/(o-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=h,l[4]=0,l[8]=c,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,s,i,n,o,a=Qe){const l=this.elements,h=1/(t-e),u=1/(s-i),c=1/(o-n),p=(t+e)*h,d=(s+i)*u;let g,w;if(a===Qe)g=(o+n)*c,w=-2*c;else if(a===hs)g=n*c,w=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=w,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<16;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const ct=new R,ze=new Ve,qo=new R(0,0,0),Yo=new R(1,1,1),We=new R,Qt=new R,Ne=new R;class _e{constructor(e=0,t=0){_e.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,s=this.y,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6],this.y=i[1]*t+i[4]*s+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=D(this.x,e.x,t.x),this.y=D(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=D(this.x,e,t),this.y=D(this.y,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(D(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(D(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const s=Math.cos(t),i=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*s-o*i+e.x,this.y=n*i+o*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class et{constructor(e=0,t=0,s=0,i=1){et.prototype.isVector4=!0,this.x=e,this.y=t,this.z=s,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,s,i){return this.x=e,this.y=t,this.z=s,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*s+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*s+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*s+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*s+o[11]*i+o[15]*n,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,s,i,n;const l=e.elements,h=l[0],u=l[4],c=l[8],p=l[1],d=l[5],g=l[9],w=l[2],C=l[6],v=l[10];if(Math.abs(u-p)<.01&&Math.abs(c-w)<.01&&Math.abs(g-C)<.01){if(Math.abs(u+p)<.1&&Math.abs(c+w)<.1&&Math.abs(g+C)<.1&&Math.abs(h+d+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const P=(h+1)/2,k=(d+1)/2,L=(v+1)/2,z=(u+p)/4,V=(c+w)/4,he=(g+C)/4;return P>k&&P>L?P<.01?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(P),i=z/s,n=V/s):k>L?k<.01?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(k),s=z/i,n=he/i):L<.01?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(L),s=V/n,i=he/n),this.set(s,i,n,t),this}let H=Math.sqrt((C-g)*(C-g)+(c-w)*(c-w)+(p-u)*(p-u));return Math.abs(H)<.001&&(H=1),this.x=(C-g)/H,this.y=(c-w)/H,this.z=(p-u)/H,this.w=Math.acos((h+d+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=D(this.x,e.x,t.x),this.y=D(this.y,e.y,t.y),this.z=D(this.z,e.z,t.z),this.w=D(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=D(this.x,e,t),this.y=D(this.y,e,t),this.z=D(this.z,e,t),this.w=D(this.w,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(D(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this.w=e.w+(t.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}function Gs(r,e=0){let t=3735928559^e,s=1103547991^e;if(r instanceof Array)for(let i=0,n;i<r.length;i++)n=r[i],t=Math.imul(t^n,2654435761),s=Math.imul(s^n,1597334677);else for(let i=0,n;i<r.length;i++)n=r.charCodeAt(i),t=Math.imul(t^n,2654435761),s=Math.imul(s^n,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&s)+(t>>>0)}const un=(...r)=>Gs(r);function Xo(r,e=!1){const t=[];r.isNode===!0&&(t.push(r.id),r=r.getSelf());for(const{property:s,childNode:i}of qs(r))t.push(Gs(s.slice(0,-4)),i.getCacheKey(e));return Gs(t)}function*qs(r,e=!1){for(const t in r){if(t.startsWith("_")===!0)continue;const s=r[t];if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const n=s[i];n&&(n.isNode===!0||e&&typeof n.toJSON=="function")&&(yield{property:t,index:i,childNode:n})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const i in s){const n=s[i];n&&(n.isNode===!0||e&&typeof n.toJSON=="function")&&(yield{property:t,index:i,childNode:n})}}}function us(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function cn(r,...e){const t=r?r.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new js(...e):t==="vec2"?new _e(...e):t==="vec3"?new R(...e):t==="vec4"?new et(...e):t==="mat2"?new Ks(...e):t==="mat3"?new Ie(...e):t==="mat4"?new Ve(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?Wo(e[0]):null}function Zo(r){let e="";const t=new Uint8Array(r);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function Wo(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}class Js{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s===void 0?!1:s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners;if(s===void 0)return;const i=s[e];if(i!==void 0){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const s=t[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let n=0,o=i.length;n<o;n++)i[n].call(this,e);e.target=null}}}const jo={analyze:"setup",generate:"analyze"};let Ko=0;class $ extends Js{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=re.NONE,this.updateBeforeType=re.NONE,this.updateAfterType=re.NONE,this.uuid=Io.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:Ko++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,re.FRAME)}onRenderUpdate(e){return this.onUpdate(e,re.RENDER)}onObjectUpdate(e){return this.onUpdate(e,re.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of qs(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=un(Xo(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let s=0;for(const i of this.getChildren())t["node"+s++]=i;return t.outputNode||null}analyze(e,t=null){const s=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(s===1){const i=e.getNodeProperties(this);for(const n of Object.values(i))n&&n.isNode===!0&&n.build(e,this)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const n=jo[e.buildStage];if(n&&i.buildStages[n]!==!0){const l=e.getBuildStage();e.setBuildStage(n),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const h of Object.values(l))if(h&&h.isNode===!0){if(h.parents===!0){const u=e.getNodeProperties(h);u.parents=u.parents||[],u.parents.push(this)}h.build(e)}}o=l.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate")if(this.generate.length===1){const h=this.getNodeType(e),u=e.getDataFromNode(this);o=u.snippet,o===void 0?u.generated===void 0?(u.generated=!0,o=this.generate(e)||"",u.snippet=o):(console.warn("THREE.Node: Recursion detected.",this),o=""):u.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,h,t)}else o=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return qs(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:i,index:n,childNode:o}of t)n!==void 0?(s[i]===void 0&&(s[i]=Number.isInteger(n)?[]:{}),s[i][n]=o.toJSON(e.meta).uuid):s[i]=o.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const i=[];for(const n of e.inputNodes[s])i.push(t[n]);this[s]=i}else if(typeof e.inputNodes[s]=="object"){const i={};for(const n in e.inputNodes[s]){const o=e.inputNodes[s][n];i[n]=t[o]}this[s]=i}else{const i=e.inputNodes[s];this[s]=t[i]}}}toJSON(e){const{uuid:t,type:s}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let n=e.nodes[t];n===void 0&&(n={uuid:t,type:s,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[n.uuid]=n),this.serialize(n),delete n.meta);function o(a){const l=[];for(const h in a){const u=a[h];delete u.metadata,l.push(u)}return l}if(i){const a=o(e.textures),l=o(e.images),h=o(e.nodes);a.length>0&&(n.textures=a),l.length>0&&(n.images=l),h.length>0&&(n.nodes=h)}return n}}class fe extends ${static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),n=e.getDataFromNode(this);if(n.propertyName!==void 0)return e.format(n.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),a=e.getVarFromNode(this,null,i),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),n.snippet=o,n.propertyName=l,e.format(n.propertyName,i,t)}}return super.build(e,t)}}class Ht extends ${static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),s=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${s}[ ${i} ]`}}class dn extends ${static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const i of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(i))&&(s=i);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,i=this.getNodeType(e),n=s.build(e,i);return e.format(n,i,t)}}class Jo extends fe{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),i=e.getTypeLength(s),n=this.nodes,o=e.getComponentType(s),a=[];let l=0;for(const u of n){if(l>=i){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${s}()' type.`);break}let c=u.getNodeType(e),p=e.getTypeLength(c),d;l+p>i&&(console.error(`THREE.TSL: Length of '${s}()' data exceeds maximum length of output type.`),p=i-l,c=e.getTypeFromLength(p)),l+=p,d=u.build(e,c);const g=e.getComponentType(c);g!==o&&(d=e.format(d,g,o)),a.push(d)}const h=`${e.getType(s)}( ${a.join(", ")} )`;return e.format(h,s,t)}}const Qo=Ut.join("");class ki extends ${static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ut.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const s=this.node,i=e.getTypeLength(s.getNodeType(e));let n=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=s.build(e,o);this.components.length===i&&this.components===Qo.slice(0,this.components.length)?n=e.format(l,o,t):n=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else n=s.build(e,t);return n}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class ea extends fe{static get type(){return"SetNode"}constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:i}=this,n=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),a=e.getTypeFromLength(s.length,o),l=i.build(e,a),h=t.build(e,n),u=e.getTypeLength(n),c=[];for(let p=0;p<u;p++){const d=Ut[p];d===s[0]?(c.push(l),p+=s.length-1):c.push(h+"."+d)}return`${e.getType(n)}( ${c.join(", ")} )`}}class ta extends fe{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:s}=this,i=this.getNodeType(e),n=s.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+n,this);const l=e.getTypeLength(i),h=[];let u=0;for(let c=0;c<l;c++){const p=Ut[c];p===t[u]?(h.push("1.0 - "+(a+"."+p)),u++):h.push(a+"."+p)}return`${e.getType(i)}( ${h.join(", ")} )`}}class Qs extends ${static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?us(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=us(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Zo(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?cn(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const Bi=/float|u?int/;class He extends Qs{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return Bi.test(s)&&Bi.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),s,t)}}class sa extends ${static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let pn=null;const yt=new Map;function T(r,e){if(yt.has(r)){console.warn(`THREE.TSL: Redefinition of method chaining '${r}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);yt.set(r,e)}const mn=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Di=r=>mn(r).split("").sort().join(""),fn={setup(r,e){const t=e.shift();return r(xs(t),...e)},get(r,e,t){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...s)=>(pn.assign(t,...s),t);if(yt.has(e)){const s=yt.get(e);return r.isStackNode?(...i)=>t.add(s(...i)):(...i)=>s(t,...i)}else{if(e==="self")return r;if(e.endsWith("Assign")&&yt.has(e.slice(0,e.length-6))){const s=yt.get(e.slice(0,e.length-6));return r.isStackNode?(...i)=>t.assign(i[0],s(...i)):(...i)=>t.assign(s(t,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=mn(e),M(new ki(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Di(e.slice(3).toLowerCase()),s=>M(new ea(r,e,M(s)));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Di(e.slice(4).toLowerCase()),()=>M(new ta(M(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),M(new ki(r,e));if(/^\d+$/.test(e)===!0)return M(new Ht(t,new He(Number(e),"uint")));if(/^get$/.test(e)===!0)return s=>M(new sa(t,s))}}}return Reflect.get(r,e,t)},set(r,e,t,s){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(r,e,t,s)}},bs=new WeakMap,Ui=new WeakMap,ia=function(r,e=null){const t=us(r);if(t==="node"){let s=bs.get(r);return s===void 0&&(s=new Proxy(r,fn),bs.set(r,s),bs.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return M(Ys(r,e));if(t==="shader")return K(r)}return r},na=function(r,e=null){for(const t in r)r[t]=M(r[t],e);return r},ra=function(r,e=null){const t=r.length;for(let s=0;s<t;s++)r[s]=M(r[s],e);return r},oa=function(r,e=null,t=null,s=null){const i=u=>M(s!==null?Object.assign(u,s):u);let n,o=e,a,l;function h(u){let c;return o?c=/[a-z]/i.test(o)?o+"()":o:c=r.type,a!==void 0&&u.length<a?(console.error(`THREE.TSL: "${c}" parameter length is less than minimum required.`),u.concat(new Array(a-u.length).fill(0))):l!==void 0&&u.length>l?(console.error(`THREE.TSL: "${c}" parameter length exceeds limit.`),u.slice(0,l)):u}return e===null?n=(...u)=>i(new r(...Dt(h(u)))):t!==null?(t=M(t),n=(...u)=>i(new r(e,...Dt(h(u)),t))):n=(...u)=>i(new r(e,...Dt(h(u)))),n.setParameterLength=(...u)=>(u.length===1?a=l=u[0]:u.length===2&&([a,l]=u),n),n.setName=u=>(o=u,n),n},aa=function(r,...e){return M(new r(...Dt(e)))};class la extends ${constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:s}=this,i=e.getNodeProperties(t),n=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(i[n])return i[n];let o=null;if(t.layout){let a=Ui.get(e.constructor);a===void 0&&(a=new WeakMap,Ui.set(e.constructor,a));let l=a.get(t);l===void 0&&(l=M(e.buildFunctionNode(t)),a.set(t,l)),e.addInclude(l),o=M(l.call(s))}else{const a=t.jsFunc,l=s!==null||a.length>1?a(s||[],e):a(e);o=M(l)}return t.once&&(i[n]=o),o}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),s=e.getOutputNamespace();return t[s]=t[s]||this.setupOutput(e),t[s]}build(e,t=null){let s=null;const i=e.getBuildStage(),n=e.getNodeProperties(this),o=e.getOutputNamespace(),a=this.getOutputNode(e);if(i==="setup"){const l=e.getNamespace("initialized");n[l]!==!0&&(n[l]=!0,n[o]=this.getOutputNode(e),n[o].build(e)),s=n[o]}else i==="analyze"?a.build(e,t):i==="generate"&&(s=a.build(e,t)||"");return s}}class ha extends ${constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(e=null){return xs(e),M(new la(this,e))}setup(){return this.call()}}const ua=[!1,!0],ca=[0,1,2,3],da=[-1,-2],gn=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],ei=new Map;for(const r of ua)ei.set(r,new He(r));const ti=new Map;for(const r of ca)ti.set(r,new He(r,"uint"));const si=new Map([...ti].map(r=>new He(r.value,"int")));for(const r of da)si.set(r,new He(r,"int"));const gs=new Map([...si].map(r=>new He(r.value)));for(const r of gn)gs.set(r,new He(r));for(const r of gn)gs.set(-r,new He(-r));const ys={bool:ei,uint:ti,ints:si,float:gs},Hi=new Map([...ei,...gs]),Ys=(r,e)=>Hi.has(r)?Hi.get(r):r.isNode===!0?r:new He(r,e),pa=r=>{try{return r.getNodeType()}catch{return}},ie=function(r,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(r)&&t.every(i=>typeof i!="object"))&&(t=[cn(r,...t)]),t.length===1&&e!==null&&e.has(t[0]))return M(e.get(t[0]));if(t.length===1){const i=Ys(t[0],r);return pa(i)===r?M(i):M(new dn(i,r))}const s=t.map(i=>Ys(i));return M(new Jo(s,r))}},ma=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function fa(r,e){return new Proxy(new ha(r,e),fn)}const M=(r,e=null)=>ia(r,e),xs=(r,e=null)=>new na(r,e),Dt=(r,e=null)=>new ra(r,e),S=(...r)=>new oa(...r),A=(...r)=>new aa(...r);let ga=0;const K=(r,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const s=new fa(r,t),i=(...n)=>{let o;xs(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?o=[...n]:o=n[0];const l=s.call(o);return t==="void"&&l.toStack(),l};if(i.shaderNode=s,i.id=s.id,i.getNodeType=(...n)=>s.getNodeType(...n),i.getCacheKey=(...n)=>s.getCacheKey(...n),i.setLayout=n=>(s.setLayout(n),i),i.once=(n=null)=>(s.once=!0,s.namespace=n,i),e!==null){if(typeof e.inputs!="object"){const n={name:"fn"+ga++,type:t,inputs:[]};for(const o in e)o!=="return"&&n.inputs.push({name:o,type:e[o]});e=n}i.setLayout(e)}return i},ya=(...r)=>pn.If(...r);function xa(r){return r}T("toStack",xa);const Ta=new ie("color"),Se=new ie("float",ys.float),wt=new ie("int",ys.ints),Na=new ie("uint",ys.uint),wa=new ie("bool",ys.bool),$t=new ie("vec2"),Sa=new ie("ivec2"),Ma=new ie("uvec2"),_a=new ie("bvec2"),q=new ie("vec3"),va=new ie("ivec3"),Ca=new ie("uvec3"),Ea=new ie("bvec3"),De=new ie("vec4"),za=new ie("ivec4"),Aa=new ie("uvec4"),Fa=new ie("bvec4"),yn=new ie("mat2"),Gt=new ie("mat3"),ba=new ie("mat4");T("toColor",Ta);T("toFloat",Se);T("toInt",wt);T("toUint",Na);T("toBool",wa);T("toVec2",$t);T("toIVec2",Sa);T("toUVec2",Ma);T("toBVec2",_a);T("toVec3",q);T("toIVec3",va);T("toUVec3",Ca);T("toBVec3",Ea);T("toVec4",De);T("toIVec4",za);T("toUVec4",Aa);T("toBVec4",Fa);T("toMat2",yn);T("toMat3",Gt);T("toMat4",ba);const Ra=S(Ht).setParameterLength(2),Va=(r,e)=>M(new dn(M(r),e));T("element",Ra);T("convert",Va);T("append",r=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),r));class Ia extends fe{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return Ut.join("").slice(0,s)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:s}=this,i=e.getNodeProperties(this);i.sourceNode=s,i.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:s,sourceNode:i}=e.getNodeProperties(this),n=this.needsSplitAssign(e),o=s.getNodeType(e),a=s.build(e),l=i.build(e,o),h=i.getNodeType(e),u=e.getDataFromNode(this);let c;if(u.initialized===!0)t!=="void"&&(c=a);else if(n){const p=e.getVarFromNode(this,null,o),d=e.getPropertyName(p);e.addLineFlowCode(`${d} = ${l}`,this);const g=s.node,C=g.node.context({assign:!0}).build(e);for(let v=0;v<g.components.length;v++){const H=g.components[v];e.addLineFlowCode(`${C}.${H} = ${d}[ ${v} ]`,this)}t!=="void"&&(c=a)}else c=`${a} = ${l}`,(t==="void"||h==="void")&&(e.addLineFlowCode(c,this),t!=="void"&&(c=a));return u.initialized=!0,e.format(c,o,t)}}const La=S(Ia).setParameterLength(2);T("assign",La);class $i extends fe{static get type(){return"ArrayNode"}constructor(e,t,s=null){super(e),this.count=t,this.values=s,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const Pa=(...r)=>{let e;if(r.length===1){const t=r[0];e=new $i(null,t.length,t)}else{const t=r[0],s=r[1];e=new $i(t,s)}return M(e)};T("toArray",(r,e)=>Pa(Array(e).fill(r)));class xn extends ${static get type(){return"UniformGroupNode"}constructor(e,t=!1,s=1){super("string"),this.name=e,this.shared=t,this.order=s,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Oa=r=>new xn(r),Tn=(r,e=0)=>new xn(r,!0,e),St=Tn("render"),ka=Oa("object");class qt extends Qs{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=ka}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const s=this.getSelf();return e=e.bind(s),super.onUpdate(i=>{const n=e(i,s);n!==void 0&&(this.value=n)},t)}generate(e,t){const s=this.getNodeType(e),i=this.getUniformHash(e);let n=e.getNodeFromHash(i);n===void 0&&(e.setHashNode(this,i),n=this);const o=n.getInputType(e),a=e.getUniformFromNode(n,o,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(l,s,t)}}const pe=(r,e)=>{const t=ma(e||r),s=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return M(new qt(s,t))};class Nn extends ${static get type(){return"PropertyNode"}constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Ba=(r,e)=>M(new Nn(r,e)),Gi=A(Nn,"vec4","Output");class Da extends fe{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,i=s.getInputs(e),n=this.parameters,o=(l,h)=>{const u=h.type,c=u==="pointer";let p;return c?p="&"+l.build(e):p=l.build(e,u),p};if(Array.isArray(n)){if(n.length>i.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),n.length=i.length;else if(n.length<i.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");n.length<i.length;)n.push(Se(0));for(let l=0;l<n.length;l++)t.push(o(n[l],i[l]))}else for(const l of i){const h=n[l.name];h!==void 0?t.push(o(h,l)):(console.error(`THREE.TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(o(Se(0),l)))}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const Ua=(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Dt(e):xs(e[0]),M(new Da(M(r),e)));T("call",Ua);const Ha={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class J extends fe{static get type(){return"OperatorNode"}constructor(e,t,s,...i){if(super(),i.length>0){let n=new J(e,t,s);for(let o=0;o<i.length-1;o++)n=new J(e,n,i[o]);t=n,s=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=s,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(Ha[this.op],t)}getNodeType(e){const t=this.op,s=this.aNode,i=this.bNode,n=s.getNodeType(e),o=i?i.getNodeType(e):null;if(n==="void"||o==="void")return"void";if(t==="%")return n;if(t==="~"||t==="&"||t==="|"||t==="^"||t===">>"||t==="<<")return e.getIntegerType(n);if(t==="!"||t==="&&"||t==="||"||t==="^^")return"bool";if(t==="=="||t==="!="||t==="<"||t===">"||t==="<="||t===">="){const a=Math.max(e.getTypeLength(n),e.getTypeLength(o));return a>1?`bvec${a}`:"bool"}else{if(e.isMatrix(n)){if(o==="float")return n;if(e.isVector(o))return e.getVectorFromMatrix(n);if(e.isMatrix(o))return n}else if(e.isMatrix(o)){if(n==="float")return o;if(e.isVector(n))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(n)?o:n}}generate(e,t){const s=this.op,{aNode:i,bNode:n}=this,o=this.getNodeType(e);let a=null,l=null;o!=="void"?(a=i.getNodeType(e),l=n?n.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="||s==="!="?e.isVector(a)?l=a:e.isVector(l)?a=l:a!==l&&(a=l="float"):s===">>"||s==="<<"?(a=o,l=e.changeComponentType(l,"uint")):s==="%"?(a=o,l=e.isInteger(a)&&e.isInteger(l)?l:a):e.isMatrix(a)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(a):e.isMatrix(l)||(a=l=o):e.isMatrix(l)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(l):a=l=o:a=l=o):a=l=o;const h=i.build(e,a),u=n?n.build(e,l):null,c=e.getFunctionOperator(s);if(t!=="void"){const p=e.renderer.coordinateSystem===Qe;if(s==="=="||s==="!="||s==="<"||s===">"||s==="<="||s===">=")return p?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${h}, ${u} )`,o,t):e.format(`( ${h} ${s} ${u} )`,o,t):e.format(`( ${h} ${s} ${u} )`,o,t);if(s==="%")return e.isInteger(l)?e.format(`( ${h} % ${u} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${h}, ${u} )`,o,t);if(s==="!"||s==="~")return e.format(`(${s}${h})`,a,t);if(c)return e.format(`${c}( ${h}, ${u} )`,o,t);if(e.isMatrix(a)&&l==="float")return e.format(`( ${u} ${s} ${h} )`,o,t);if(a==="float"&&e.isMatrix(l))return e.format(`${h} ${s} ${u}`,o,t);{let d=`( ${h} ${s} ${u} )`;return!p&&o==="bool"&&e.isVector(a)&&e.isVector(l)&&(d=`all${d}`),e.format(d,o,t)}}else if(a!=="void")return c?e.format(`${c}( ${h}, ${u} )`,o,t):e.isMatrix(a)&&l==="float"?e.format(`${u} ${s} ${h}`,o,t):e.format(`${h} ${s} ${u}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const wn=S(J,"+").setParameterLength(2,1/0).setName("add"),Xs=S(J,"-").setParameterLength(2,1/0).setName("sub"),ii=S(J,"*").setParameterLength(2,1/0).setName("mul"),Sn=S(J,"/").setParameterLength(2,1/0).setName("div"),Ts=S(J,"%").setParameterLength(2).setName("mod"),Mn=S(J,"==").setParameterLength(2).setName("equal"),$a=S(J,"!=").setParameterLength(2).setName("notEqual"),Ga=S(J,"<").setParameterLength(2).setName("lessThan"),qa=S(J,">").setParameterLength(2).setName("greaterThan"),Ya=S(J,"<=").setParameterLength(2).setName("lessThanEqual"),Xa=S(J,">=").setParameterLength(2).setName("greaterThanEqual"),Za=S(J,"&&").setParameterLength(2,1/0).setName("and"),Wa=S(J,"||").setParameterLength(2,1/0).setName("or"),ja=S(J,"!").setParameterLength(1).setName("not"),Ka=S(J,"^^").setParameterLength(2).setName("xor"),Ja=S(J,"&").setParameterLength(2).setName("bitAnd"),Qa=S(J,"~").setParameterLength(2).setName("bitNot"),el=S(J,"|").setParameterLength(2).setName("bitOr"),tl=S(J,"^").setParameterLength(2).setName("bitXor"),sl=S(J,"<<").setParameterLength(2).setName("shiftLeft"),il=S(J,">>").setParameterLength(2).setName("shiftRight"),nl=K(([r])=>(r.addAssign(1),r)),rl=K(([r])=>(r.subAssign(1),r)),ol=K(([r])=>{const e=wt(r).toConst();return r.addAssign(1),e}),al=K(([r])=>{const e=wt(r).toConst();return r.subAssign(1),e});T("add",wn);T("sub",Xs);T("mul",ii);T("div",Sn);T("mod",Ts);T("equal",Mn);T("notEqual",$a);T("lessThan",Ga);T("greaterThan",qa);T("lessThanEqual",Ya);T("greaterThanEqual",Xa);T("and",Za);T("or",Wa);T("not",ja);T("xor",Ka);T("bitAnd",Ja);T("bitNot",Qa);T("bitOr",el);T("bitXor",tl);T("shiftLeft",sl);T("shiftRight",il);T("incrementBefore",nl);T("decrementBefore",rl);T("increment",ol);T("decrement",al);const ll=(r,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),Ts(r,e)),hl=(r,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Ts(wt(r),wt(e)));T("remainder",ll);T("modInt",hl);class m extends fe{static get type(){return"MathNode"}constructor(e,t,s=null,i=null){if(super(),(e===m.MAX||e===m.MIN)&&arguments.length>3){let n=new m(e,t,s);for(let o=2;o<arguments.length-1;o++)n=new m(e,n,arguments[o]);t=n,s=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=s,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,n=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(i)?0:e.getTypeLength(i);return n>o&&n>a?t:o>a?s:a>n?i:t}getNodeType(e){const t=this.method;return t===m.LENGTH||t===m.DISTANCE||t===m.DOT?"float":t===m.CROSS?"vec3":t===m.ALL||t===m.ANY?"bool":t===m.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:s,method:i}=this;let n=null;if(i===m.ONE_MINUS)n=Xs(1,t);else if(i===m.RECIPROCAL)n=Sn(1,t);else if(i===m.DIFFERENCE)n=ni(Xs(t,s));else if(i===m.TRANSFORM_DIRECTION){let o=t,a=s;e.isMatrix(o.getNodeType(e))?a=De(q(a),0):o=De(q(o),0);const l=ii(o,a).xyz;n=_n(l)}return n!==null?n:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const n=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,l=this.bNode,h=this.cNode,u=e.renderer.coordinateSystem;if(i===m.NEGATE)return e.format("( - "+a.build(e,o)+" )",n,t);{const c=[];return i===m.CROSS?c.push(a.build(e,n),l.build(e,n)):u===Qe&&i===m.STEP?c.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),l.build(e,o)):u===Qe&&(i===m.MIN||i===m.MAX)?c.push(a.build(e,o),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o)):i===m.REFRACT?c.push(a.build(e,o),l.build(e,o),h.build(e,"float")):i===m.MIX?c.push(a.build(e,o),l.build(e,o),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":o)):(u===hs&&i===m.ATAN&&l!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===m.DFDX||i===m.DFDY)&&(console.warn(`THREE.TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),c.push(a.build(e,o)),l!==null&&c.push(l.build(e,o)),h!==null&&c.push(h.build(e,o))),e.format(`${e.getMethod(i,n)}( ${c.join(", ")} )`,n,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}m.ALL="all";m.ANY="any";m.RADIANS="radians";m.DEGREES="degrees";m.EXP="exp";m.EXP2="exp2";m.LOG="log";m.LOG2="log2";m.SQRT="sqrt";m.INVERSE_SQRT="inversesqrt";m.FLOOR="floor";m.CEIL="ceil";m.NORMALIZE="normalize";m.FRACT="fract";m.SIN="sin";m.COS="cos";m.TAN="tan";m.ASIN="asin";m.ACOS="acos";m.ATAN="atan";m.ABS="abs";m.SIGN="sign";m.LENGTH="length";m.NEGATE="negate";m.ONE_MINUS="oneMinus";m.DFDX="dFdx";m.DFDY="dFdy";m.ROUND="round";m.RECIPROCAL="reciprocal";m.TRUNC="trunc";m.FWIDTH="fwidth";m.TRANSPOSE="transpose";m.BITCAST="bitcast";m.EQUALS="equals";m.MIN="min";m.MAX="max";m.STEP="step";m.REFLECT="reflect";m.DISTANCE="distance";m.DIFFERENCE="difference";m.DOT="dot";m.CROSS="cross";m.POW="pow";m.TRANSFORM_DIRECTION="transformDirection";m.MIX="mix";m.CLAMP="clamp";m.REFRACT="refract";m.SMOOTHSTEP="smoothstep";m.FACEFORWARD="faceforward";const ul=Se(Math.PI),cl=S(m,m.ALL).setParameterLength(1),dl=S(m,m.ANY).setParameterLength(1),pl=S(m,m.RADIANS).setParameterLength(1),ml=S(m,m.DEGREES).setParameterLength(1),fl=S(m,m.EXP).setParameterLength(1),gl=S(m,m.EXP2).setParameterLength(1),yl=S(m,m.LOG).setParameterLength(1),xl=S(m,m.LOG2).setParameterLength(1),Tl=S(m,m.SQRT).setParameterLength(1),Nl=S(m,m.INVERSE_SQRT).setParameterLength(1),wl=S(m,m.FLOOR).setParameterLength(1),Sl=S(m,m.CEIL).setParameterLength(1),_n=S(m,m.NORMALIZE).setParameterLength(1),vn=S(m,m.FRACT).setParameterLength(1),Cn=S(m,m.SIN).setParameterLength(1),Ml=S(m,m.COS).setParameterLength(1),_l=S(m,m.TAN).setParameterLength(1),vl=S(m,m.ASIN).setParameterLength(1),Cl=S(m,m.ACOS).setParameterLength(1),En=S(m,m.ATAN).setParameterLength(1,2),ni=S(m,m.ABS).setParameterLength(1),zn=S(m,m.SIGN).setParameterLength(1),El=S(m,m.LENGTH).setParameterLength(1),zl=S(m,m.NEGATE).setParameterLength(1),Al=S(m,m.ONE_MINUS).setParameterLength(1),Fl=S(m,m.DFDX).setParameterLength(1),bl=S(m,m.DFDY).setParameterLength(1),Rl=S(m,m.ROUND).setParameterLength(1),Vl=S(m,m.RECIPROCAL).setParameterLength(1),Il=S(m,m.TRUNC).setParameterLength(1),Ll=S(m,m.FWIDTH).setParameterLength(1),Pl=S(m,m.TRANSPOSE).setParameterLength(1),Ol=(r,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),Mn(r,e)),kl=S(m,m.MIN).setParameterLength(2,1/0),Bl=S(m,m.MAX).setParameterLength(2,1/0),Dl=S(m,m.STEP).setParameterLength(2),Ul=S(m,m.REFLECT).setParameterLength(2),Hl=S(m,m.DISTANCE).setParameterLength(2),$l=S(m,m.DIFFERENCE).setParameterLength(2),ri=S(m,m.DOT).setParameterLength(2),Gl=S(m,m.CROSS).setParameterLength(2),An=S(m,m.POW).setParameterLength(2),ql=S(m,m.POW,2).setParameterLength(1),Yl=S(m,m.POW,3).setParameterLength(1),Xl=S(m,m.POW,4).setParameterLength(1),Zl=S(m,m.TRANSFORM_DIRECTION).setParameterLength(2),Wl=r=>ii(zn(r),An(ni(r),1/3)),Fn=r=>ri(r,r),oi=S(m,m.MIX).setParameterLength(3),bn=(r,e=0,t=1)=>M(new m(m.CLAMP,M(r),M(e),M(t))),jl=r=>bn(r),Kl=S(m,m.REFRACT).setParameterLength(3),ai=S(m,m.SMOOTHSTEP).setParameterLength(3),Jl=S(m,m.FACEFORWARD).setParameterLength(3),Ql=K(([r])=>{const s=43758.5453,i=ri(r.xy,$t(12.9898,78.233)),n=Ts(i,ul);return vn(Cn(n).mul(s))}),eh=(r,e,t)=>oi(e,t,r),th=(r,e,t)=>ai(e,t,r),sh=(r,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),En(r,e));T("all",cl);T("any",dl);T("equals",Ol);T("radians",pl);T("degrees",ml);T("exp",fl);T("exp2",gl);T("log",yl);T("log2",xl);T("sqrt",Tl);T("inverseSqrt",Nl);T("floor",wl);T("ceil",Sl);T("normalize",_n);T("fract",vn);T("sin",Cn);T("cos",Ml);T("tan",_l);T("asin",vl);T("acos",Cl);T("atan",En);T("abs",ni);T("sign",zn);T("length",El);T("lengthSq",Fn);T("negate",zl);T("oneMinus",Al);T("dFdx",Fl);T("dFdy",bl);T("round",Rl);T("reciprocal",Vl);T("trunc",Il);T("fwidth",Ll);T("atan2",sh);T("min",kl);T("max",Bl);T("step",Dl);T("reflect",Ul);T("distance",Hl);T("dot",ri);T("cross",Gl);T("pow",An);T("pow2",ql);T("pow3",Yl);T("pow4",Xl);T("transformDirection",Zl);T("mix",eh);T("clamp",bn);T("refract",Kl);T("smoothstep",th);T("faceForward",Jl);T("difference",$l);T("saturate",jl);T("cbrt",Wl);T("transpose",Pl);T("rand",Ql);class ih extends ${static get type(){return"ConditionalNode"}constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const{ifNode:t,elseNode:s}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const i=t.getNodeType(e);if(s!==null){const n=s.getNodeType(e);if(e.getTypeLength(n)>e.getTypeLength(i))return n}return i}setup(e){const t=this.condNode.cache(),s=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,n=e.context.nodeBlock;e.getDataFromNode(s).parentNodeBlock=n,i!==null&&(e.getDataFromNode(i).parentNodeBlock=n);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=s.context({nodeBlock:s}),o.elseNode=i?i.context({nodeBlock:i}):null}generate(e,t){const s=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:n,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=e.currentFunctionNode,h=t!=="void",u=h?Ba(s).build(e):"";i.nodeProperty=u;const c=n.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let p=o.build(e,s);if(p&&(h?p=u+" = "+p+";":(p="return "+p+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),p="// "+p))),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let d=a.build(e,s);d&&(h?d=u+" = "+d+";":(d="return "+d+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),d="// "+d))),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,s,t)}}const Ns=S(ih).setParameterLength(2,3);T("select",Ns);const nh=(...r)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),Ns(...r));T("cond",nh);class rh extends ${static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e,t);return e.setContext(s),i}}const Rn=S(rh).setParameterLength(1,2),oh=(r,e)=>Rn(r,{label:e});T("context",Rn);T("label",oh);class ah extends ${static get type(){return"VarNode"}constructor(e,t=null,s=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=s,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s,readOnly:i}=this,{renderer:n}=e,o=n.backend.isWebGPUBackend===!0;let a=!1,l=!1;i&&(a=e.isDeterministic(t),l=o?i:a);const h=e.getVectorType(this.getNodeType(e)),u=t.build(e,h),c=e.getVarFromNode(this,s,h,void 0,l),p=e.getPropertyName(c);let d=p;if(l)if(o)d=a?`const ${p}`:`let ${p}`;else{const g=e.getArrayCount(t);d=`const ${e.getVar(c.type,p,g)}`}return e.addLineFlowCode(`${d} = ${u}`,this),p}}const li=S(ah),lh=(r,e=null)=>li(r,e).toStack(),hh=(r,e=null)=>li(r,e,!0).toStack();T("toVar",lh);T("toConst",hh);const uh=r=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),li(r));T("temp",uh);class ch extends ${static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let s=t.varying;if(s===void 0){const i=this.name,n=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=s=e.getVaryingFromNode(this,i,n,o,a),t.node=this.node}return s.needsInterpolation||(s.needsInterpolation=e.shaderStage==="fragment"),s}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(jt.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(jt.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),s=this.setupVarying(e);if(t.propertyName===void 0){const i=this.getNodeType(e),n=e.getPropertyName(s,jt.VERTEX);e.flowNodeFromShaderStage(jt.VERTEX,this.node,i,n),t.propertyName=n}return e.getPropertyName(s)}}const $e=S(ch).setParameterLength(1,2),dh=r=>$e(r);T("toVarying",$e);T("toVertexStage",dh);T("varying",(...r)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),$e(...r)));T("vertexStage",(...r)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),$e(...r)));const ph=K(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),t=r.mul(.0773993808),s=r.lessThanEqual(.04045);return oi(e,t,s)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),mh=K(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),t=r.mul(12.92),s=r.lessThanEqual(.0031308);return oi(e,t,s)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),hi="WorkingColorSpace",fh="OutputColorSpace";class Vn extends fe{static get type(){return"ColorSpaceNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.source=t,this.target=s}resolveColorSpace(e,t){return t===hi?ne.workingColorSpace:t===fh?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,s=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let n=t;return ne.enabled===!1||s===i||!s||!i||(ne.getTransfer(s)===Bt&&(n=De(ph(n.rgb),n.a)),ne.getPrimaries(s)!==ne.getPrimaries(i)&&(n=De(Gt(ne._getMatrix(new Ie,s,i)).mul(n.rgb),n.a)),ne.getTransfer(i)===Bt&&(n=De(mh(n.rgb),n.a))),n}}const gh=(r,e)=>M(new Vn(M(r),hi,e)),In=(r,e)=>M(new Vn(M(r),e,hi));T("workingToColorSpace",gh);T("colorSpaceToWorking",In);let yh=class extends Ht{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,s,i)}};class xh extends ${static get type(){return"ReferenceBaseNode"}constructor(e,t,s=null,i=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=i,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=re.OBJECT}setGroup(e){return this.group=e,this}element(e){return M(new yh(this,M(e)))}setNodeType(e){const t=pe(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let i=1;i<t.length;i++)s=s[t[i]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class Th extends xh{static get type(){return"RendererReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.renderer=s,this.setGroup(St)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Nh=(r,e,t=null)=>M(new Th(r,e,t));class wh extends fe{static get type(){return"ToneMappingNode"}constructor(e,t=Mh,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}customCacheKey(){return un(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===Hs)return t;let i=null;const n=e.renderer.library.getToneMappingFunction(s);return n!==null?i=De(n(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),i=t),i}}const Sh=(r,e,t)=>M(new wh(r,M(e),M(t))),Mh=Nh("toneMappingExposure","float");T("toneMapping",(r,e,t)=>Sh(e,t,r));const te=new R,es=new _e;let _h=0;class vh{constructor(e,t,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_h++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=s,this.usage=ls,this.updateRanges=[],this.gpuType=Bo,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,s){e*=this.itemSize,s*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[s+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,s=this.count;t<s;t++)es.fromBufferAttribute(this,t),es.applyMatrix3(e),this.setXY(t,es.x,es.y);else if(this.itemSize===3)for(let t=0,s=this.count;t<s;t++)te.fromBufferAttribute(this,t),te.applyMatrix3(e),this.setXYZ(t,te.x,te.y,te.z);return this}applyMatrix4(e){for(let t=0,s=this.count;t<s;t++)te.fromBufferAttribute(this,t),te.applyMatrix4(e),this.setXYZ(t,te.x,te.y,te.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)te.fromBufferAttribute(this,t),te.applyNormalMatrix(e),this.setXYZ(t,te.x,te.y,te.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)te.fromBufferAttribute(this,t),te.transformDirection(e),this.setXYZ(t,te.x,te.y,te.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let s=this.array[e*this.itemSize+t];return this.normalized&&(s=be(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=G(s,this.array)),this.array[e*this.itemSize+t]=s,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=be(t,this.array)),t}setX(e,t){return this.normalized&&(t=G(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=be(t,this.array)),t}setY(e,t){return this.normalized&&(t=G(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=be(t,this.array)),t}setZ(e,t){return this.normalized&&(t=G(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=be(t,this.array)),t}setW(e,t){return this.normalized&&(t=G(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,s){return e*=this.itemSize,this.normalized&&(t=G(t,this.array),s=G(s,this.array)),this.array[e+0]=t,this.array[e+1]=s,this}setXYZ(e,t,s,i){return e*=this.itemSize,this.normalized&&(t=G(t,this.array),s=G(s,this.array),i=G(i,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=i,this}setXYZW(e,t,s,i,n){return e*=this.itemSize,this.normalized&&(t=G(t,this.array),s=G(s,this.array),i=G(i,this.array),n=G(n,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==ls&&(e.usage=this.usage),e}}const me=new R;class ui{constructor(e,t,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,s=this.data.count;t<s;t++)me.fromBufferAttribute(this,t),me.applyMatrix4(e),this.setXYZ(t,me.x,me.y,me.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)me.fromBufferAttribute(this,t),me.applyNormalMatrix(e),this.setXYZ(t,me.x,me.y,me.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)me.fromBufferAttribute(this,t),me.transformDirection(e),this.setXYZ(t,me.x,me.y,me.z);return this}getComponent(e,t){let s=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(s=be(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=G(s,this.array)),this.data.array[e*this.data.stride+this.offset+t]=s,this}setX(e,t){return this.normalized&&(t=G(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=G(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=G(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=G(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=be(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=be(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=be(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=be(t,this.array)),t}setXY(e,t,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=G(t,this.array),s=G(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this}setXYZ(e,t,s,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=G(t,this.array),s=G(s,this.array),i=G(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=i,this}setXYZW(e,t,s,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=G(t,this.array),s=G(s,this.array),i=G(i,this.array),n=G(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return new vh(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ui(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ch{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=ls,this.updateRanges=[],this.version=0,this.uuid=xt()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,s){e*=this.stride,s*=t.stride;for(let i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[s+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(t,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}class Eh extends Qs{static get type(){return"BufferAttributeNode"}constructor(e,t=null,s=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=i,this.usage=ls,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,i=e.getTypeLength(t),n=this.bufferStride||i,o=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Ch(s,n),l=new ui(a,i,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(s);let n=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,n=i):n=$e(this).build(e,t),n}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const zh=(r,e=null,t=0,s=0)=>M(new Eh(r,e,t,s));T("toAttribute",r=>zh(r.value));class Ah extends ${static get type(){return"ComputeNode"}constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=re.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let i=1;i<t.length;i++)s*=t[i];this.dispatchCount=Math.ceil(e/s)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const s=e.getNodeProperties(this);s.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:s}=e;if(s==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const n=e.getNodeProperties(this).outputComputeNode;if(n)return n.build(e,t)}}}const Fh=(r,e,t)=>M(new Ah(M(r),e,t));T("compute",Fh);class bh extends ${static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const s=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const n=this.node.build(e,...t);return e.setCache(s),n}}const Rh=(r,e)=>M(new bh(M(r),e));T("cache",Rh);class Vh extends ${static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Ih=S(Vh).setParameterLength(2);T("bypass",Ih);class Ln extends ${static get type(){return"RemapNode"}constructor(e,t,s,i=Se(0),n=Se(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=i,this.outHighNode=n,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:i,outHighNode:n,doClamp:o}=this;let a=e.sub(t).div(s.sub(t));return o===!0&&(a=a.clamp()),a.mul(n.sub(i)).add(i)}}const Lh=S(Ln,null,null,{doClamp:!1}).setParameterLength(3,5),Ph=S(Ln).setParameterLength(3,5);T("remap",Lh);T("remapClamp",Ph);class Oh extends ${static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),i=this.snippet;if(s==="void")e.addLineFlowCode(i,this);else return e.format(i,s,t)}}const cs=S(Oh).setParameterLength(1,2),kh=r=>(r?Ns(r,cs("discard")):cs("discard")).toStack();T("discard",kh);class Bh extends fe{static get type(){return"RenderOutputNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=s,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const s=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Hs,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||as;return s!==Hs&&(t=t.toneMapping(s)),i!==as&&i!==ne.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const Dh=(r,e=null,t=null)=>M(new Bh(M(r),e,t));T("renderOutput",Dh);class Uh extends fe{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,s=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",n="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+s+` /* ... */
`,o+="// #"+n+`#
`,t!==null?t(e,o):console.log(o),s}}const Hh=(r,e=null)=>M(new Uh(M(r),e));T("debug",Hh);class $h extends ${static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const i=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const n=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(n),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,s):$e(this).build(e,s)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ci=(r,e=null)=>M(new $h(r,e));class j extends ${static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let i;if(s===j.VERTEX)i=e.getVertexIndex();else if(s===j.INSTANCE)i=e.getInstanceIndex();else if(s===j.DRAW)i=e.getDrawIndex();else if(s===j.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(s===j.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(s===j.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let n;return e.shaderStage==="vertex"||e.shaderStage==="compute"?n=i:n=$e(this).build(e,t),n}}j.VERTEX="vertex";j.INSTANCE="instance";j.SUBGROUP="subgroup";j.INVOCATION_LOCAL="invocationLocal";j.INVOCATION_SUBGROUP="invocationSubgroup";j.DRAW="draw";j.VERTEX;j.INSTANCE;j.SUBGROUP;j.INVOCATION_SUBGROUP;j.INVOCATION_LOCAL;j.DRAW;class Pn{constructor(e=new R(1/0,1/0,1/0),t=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t+=3)this.expandByPoint(Ae.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,s=e.count;t<s;t++)this.expandByPoint(Ae.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const s=Ae.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const n=s.getAttribute("position");if(t===!0&&n!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=n.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Ae):Ae.fromBufferAttribute(n,o),Ae.applyMatrix4(e.matrixWorld),this.expandByPoint(Ae);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ts.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),ts.copy(s.boundingBox)),ts.applyMatrix4(e.matrixWorld),this.union(ts)}const i=e.children;for(let n=0,o=i.length;n<o;n++)this.expandByObject(i[n],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ae),Ae.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,s;return e.normal.x>0?(t=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),t<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(zt),ss.subVectors(this.max,zt),dt.subVectors(e.a,zt),pt.subVectors(e.b,zt),mt.subVectors(e.c,zt),je.subVectors(pt,dt),Ke.subVectors(mt,pt),nt.subVectors(dt,mt);let t=[0,-je.z,je.y,0,-Ke.z,Ke.y,0,-nt.z,nt.y,je.z,0,-je.x,Ke.z,0,-Ke.x,nt.z,0,-nt.x,-je.y,je.x,0,-Ke.y,Ke.x,0,-nt.y,nt.x,0];return!Rs(t,dt,pt,mt,ss)||(t=[1,0,0,0,1,0,0,0,1],!Rs(t,dt,pt,mt,ss))?!1:(is.crossVectors(je,Ke),t=[is.x,is.y,is.z],Rs(t,dt,pt,mt,ss))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ae).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ae).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Oe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Oe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Oe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Oe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Oe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Oe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Oe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Oe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Oe),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Oe=[new R,new R,new R,new R,new R,new R,new R,new R],Ae=new R,ts=new Pn,dt=new R,pt=new R,mt=new R,je=new R,Ke=new R,nt=new R,zt=new R,ss=new R,is=new R,rt=new R;function Rs(r,e,t,s,i){for(let n=0,o=r.length-3;n<=o;n+=3){rt.fromArray(r,n);const a=i.x*Math.abs(rt.x)+i.y*Math.abs(rt.y)+i.z*Math.abs(rt.z),l=e.dot(rt),h=t.dot(rt),u=s.dot(rt);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>a)return!1}return!0}const Gh=new Pn,At=new R,Vs=new R;class qh{constructor(e=new R,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const s=this.center;t!==void 0?s.copy(t):Gh.setFromPoints(e).getCenter(s);let i=0;for(let n=0,o=e.length;n<o;n++)i=Math.max(i,s.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const s=this.center.distanceToSquared(e);return t.copy(e),s>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;At.subVectors(e,this.center);const t=At.lengthSq();if(t>this.radius*this.radius){const s=Math.sqrt(t),i=(s-this.radius)*.5;this.center.addScaledVector(At,i/s),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Vs.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(At.copy(e.center).add(Vs)),this.expandByPoint(At.copy(e.center).sub(Vs))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const qi=new qh;class Z extends ${static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=re.OBJECT,this.uniformNode=new qt(null)}getNodeType(){const e=this.scope;if(e===Z.WORLD_MATRIX)return"mat4";if(e===Z.POSITION||e===Z.VIEW_POSITION||e===Z.DIRECTION||e===Z.SCALE)return"vec3";if(e===Z.RADIUS)return"float"}update(e){const t=this.object3d,s=this.uniformNode,i=this.scope;if(i===Z.WORLD_MATRIX)s.value=t.matrixWorld;else if(i===Z.POSITION)s.value=s.value||new R,s.value.setFromMatrixPosition(t.matrixWorld);else if(i===Z.SCALE)s.value=s.value||new R,s.value.setFromMatrixScale(t.matrixWorld);else if(i===Z.DIRECTION)s.value=s.value||new R,t.getWorldDirection(s.value);else if(i===Z.VIEW_POSITION){const n=e.camera;s.value=s.value||new R,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(n.matrixWorldInverse)}else if(i===Z.RADIUS){const n=e.object.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),qi.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),s.value=qi.radius}}generate(e){const t=this.scope;return t===Z.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Z.POSITION||t===Z.VIEW_POSITION||t===Z.DIRECTION||t===Z.SCALE?this.uniformNode.nodeType="vec3":t===Z.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Z.WORLD_MATRIX="worldMatrix";Z.POSITION="position";Z.SCALE="scale";Z.VIEW_POSITION="viewPosition";Z.DIRECTION="direction";Z.RADIUS="radius";class On extends qt{static get type(){return"BufferNode"}constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Yh=(r,e,t)=>M(new On(r,e,t));class Xh extends Ht{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),s=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,s)}}class Zh extends On{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?us(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=re.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,s=this.elementType;if(s==="float"||s==="int"||s==="uint")for(let i=0;i<e.length;i++){const n=i*4;t[n]=e[i]}else if(s==="color")for(let i=0;i<e.length;i++){const n=i*4,o=e[i];t[n]=o.r,t[n+1]=o.g,t[n+2]=o.b||0}else if(s==="mat2")for(let i=0;i<e.length;i++){const n=i*4,o=e[i];t[n]=o.elements[0],t[n+1]=o.elements[1],t[n+2]=o.elements[2],t[n+3]=o.elements[3]}else if(s==="mat3")for(let i=0;i<e.length;i++){const n=i*16,o=e[i];t[n]=o.elements[0],t[n+1]=o.elements[1],t[n+2]=o.elements[2],t[n+4]=o.elements[3],t[n+5]=o.elements[4],t[n+6]=o.elements[5],t[n+8]=o.elements[6],t[n+9]=o.elements[7],t[n+10]=o.elements[8],t[n+15]=1}else if(s==="mat4")for(let i=0;i<e.length;i++){const n=i*16,o=e[i];for(let a=0;a<o.elements.length;a++)t[n+a]=o.elements[a]}else for(let i=0;i<e.length;i++){const n=i*4,o=e[i];t[n]=o.x,t[n+1]=o.y,t[n+2]=o.z||0,t[n+3]=o.w||0}}setup(e){const t=this.array.length,s=this.elementType;let i=Float32Array;const n=this.paddedType,o=e.getTypeLength(n);return s.charAt(0)==="i"&&(i=Int32Array),s.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=n,super.setup(e)}element(e){return M(new Xh(this,M(e)))}}const kn=(r,e)=>M(new Zh(r,e));class Wh extends ${constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const jh=S(Wh).setParameterLength(1),Kh=pe(0,"uint").label("u_cameraIndex").setGroup(Tn("cameraIndex")).toVarying("v_cameraIndex"),Ft=pe("float").label("cameraNear").setGroup(St).onRenderUpdate(({camera:r})=>r.near),bt=pe("float").label("cameraFar").setGroup(St).onRenderUpdate(({camera:r})=>r.far),ws=K(({camera:r})=>{let e;if(r.isArrayCamera&&r.cameras.length>0){const t=[];for(const i of r.cameras)t.push(i.matrixWorldInverse);e=kn(t).setGroup(St).label("cameraViewMatrices").element(r.isMultiViewCamera?jh("gl_ViewID_OVR"):Kh).toVar("cameraViewMatrix")}else e=pe("mat4").label("cameraViewMatrix").setGroup(St).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()();class Ce extends Z{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Ce.DIRECTION;const Jh=A(Ce,Ce.WORLD_MATRIX);Ce.POSITION;Ce.SCALE;Ce.VIEW_POSITION;Ce.RADIUS;const Qh=pe(new Ie).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),eu=K(r=>r.renderer.overrideNodes.modelViewMatrix||tu).once()().toVar("modelViewMatrix"),tu=ws.mul(Jh),Ue=K(r=>r.context.setupPositionView().toVarying(r.getNamespace("v_positionView")),"vec3").once("POSITION")(),Bn=Ue.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class su extends ${static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:s}=e;return t.coordinateSystem===Qe&&s.side===Lo?"false":e.getFrontFacing()}}const iu=A(su),di=Se(iu).mul(2).sub(1),nu=ci("normal","vec3"),ru=K(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),q(0,1,0)):nu,"vec3").once()().toVar("normalLocal"),ou=Ue.dFdx().cross(Ue.dFdy()).normalize().toVar("normalFlat"),Mt=K(r=>{let e;return r.material.flatShading===!0?e=ou:e=$e(Un(ru),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),Dn=K(r=>{let e=r.context.setupNormal().context({getUV:null});return r.material.flatShading!==!0&&(e=e.mul(di)),e},"vec3").once()().toVar("transformedNormalView"),Un=K(([r],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(r);const s=Qh.mul(r);return ws.transformDirection(s)});class au extends qt{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=re.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:i,height:n}=s;this.value=Math.log2(Math.max(i,n))}}}const lu=S(au).setParameterLength(1);let Rt,Vt;class se extends ${static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===se.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=re.NONE;return(this.scope===se.SIZE||this.scope===se.VIEWPORT)&&(e=re.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===se.VIEWPORT?t!==null?Vt.copy(t.viewport):(e.getViewport(Vt),Vt.multiplyScalar(e.getPixelRatio())):t!==null?(Rt.width=t.width,Rt.height=t.height):e.getDrawingBufferSize(Rt)}setup(){const e=this.scope;let t=null;return e===se.SIZE?t=pe(Rt||(Rt=new _e)):e===se.VIEWPORT?t=pe(Vt||(Vt=new et)):t=$t(Hn.div(Yi)),t}generate(e){if(this.scope===se.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Yi).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}se.COORDINATE="coordinate";se.VIEWPORT="viewport";se.SIZE="size";se.UV="uv";const pi=A(se,se.UV),Yi=A(se,se.SIZE),Hn=A(se,se.COORDINATE),$n=A(se,se.VIEWPORT);$n.zw;$n.xy;const Ss=(r=0)=>ci("uv"+(r>0?r:""),"vec2");class hu extends ${static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${i} )`,this.getNodeType(e),t)}}const Xi=S(hu).setParameterLength(1,2);let ft;class uu{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{ft===void 0&&(ft=Ri("canvas")),ft.width=e.width,ft.height=e.height;const i=ft.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),s=ft}return s.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ri("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const i=s.getImageData(0,0,e.width,e.height),n=i.data;for(let o=0;o<n.length;o++)n[o]=Be(n[o]/255)*255;return s.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(Be(t[s]/255)*255):t[s]=Be(t[s]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let cu=0;class mi{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:cu++}),this.uuid=xt(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?n.push(Is(i[o].image)):n.push(Is(i[o]))}else n=Is(i);s.url=n}return t||(e.images[this.uuid]=s),s}}function Is(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?uu.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let du=0;const Ls=new R;class ve extends Js{constructor(e=ve.DEFAULT_IMAGE,t=ve.DEFAULT_MAPPING,s=Kt,i=Kt,n=$s,o=on,a=Uo,l=Oo,h=ve.DEFAULT_ANISOTROPY,u=as){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:du++}),this.uuid=xt(),this.name="",this.source=new mi(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=o,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=l,this.offset=new _e(0,0),this.repeat=new _e(1,1),this.center=new _e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ls).x}get height(){return this.source.getSize(Ls).y}get depth(){return this.source.getSize(Ls).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const s=e[t];if(s===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&s&&i.isVector2&&s.isVector2||i&&s&&i.isVector3&&s.isVector3||i&&s&&i.isMatrix3&&s.isMatrix3?i.copy(s):this[t]=s}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),t||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Ws)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ci:e.x=e.x-Math.floor(e.x);break;case Kt:e.x=e.x<0?0:1;break;case Ei:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ci:e.y=e.y-Math.floor(e.y);break;case Kt:e.y=e.y<0?0:1;break;case Ei:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ve.DEFAULT_IMAGE=null;ve.DEFAULT_MAPPING=Ws;ve.DEFAULT_ANISOTROPY=1;const Gn=new ve;class Ms extends qt{static get type(){return"TextureNode"}constructor(e=Gn,t=null,s=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=re.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===an?"uvec4":this.value.type===ko?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ss(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=pe(this.value.matrix)),this._matrixUniform.mul(q(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?re.OBJECT:re.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.image instanceof ImageBitmap&&s.flipY===!0||s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(wt(Xi(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const s=this.value;if(!s||s.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let i=this.uvNode;(i===null||e.context.forceUVContext===!0)&&e.context.getUV&&(i=e.context.getUV(this,e)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let n=this.levelNode;n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=n,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,i,n,o,a,l){const h=this.value;let u;return i?u=e.generateTextureLevel(h,t,s,i,o):n?u=e.generateTextureBias(h,t,s,n,o):l?u=e.generateTextureGrad(h,t,s,l,o):a?u=e.generateTextureCompare(h,t,s,a,o):this.sampler===!1?u=e.generateTextureLoad(h,t,s,o):u=e.generateTexture(h,t,s,o),u}generate(e,t){const s=this.value,i=e.getNodeProperties(this),n=super.generate(e,"property");if(/^sampler/.test(t))return n+"_sampler";if(e.isReference(t))return n;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:c,biasNode:p,compareNode:d,depthNode:g,gradNode:w}=i,C=this.generateUV(e,u),v=c?c.build(e,"float"):null,H=p?p.build(e,"float"):null,P=g?g.build(e,"int"):null,k=d?d.build(e,"float"):null,L=w?[w[0].build(e,"vec2"),w[1].build(e,"vec2")]:null,z=e.getVarFromNode(this);a=e.getPropertyName(z);const V=this.generateSnippet(e,n,C,v,H,P,k,L);e.addLineFlowCode(`${a} = ${V}`,this),o.snippet=V,o.propertyName=a}let l=a;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(s)&&(l=In(cs(l,h),s.colorSpace).setup(e).build(e,h)),e.format(l,h,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=M(e),t.referenceNode=this.getSelf(),M(t)}blur(e){const t=this.clone();t.biasNode=M(e).mul(lu(t)),t.referenceNode=this.getSelf();const s=t.value;return t.generateMipmaps===!1&&(s&&s.generateMipmaps===!1||s.minFilter===Nt||s.magFilter===Nt)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),M(t)}level(e){const t=this.clone();return t.levelNode=M(e),t.referenceNode=this.getSelf(),M(t)}size(e){return Xi(this,e)}bias(e){const t=this.clone();return t.biasNode=M(e),t.referenceNode=this.getSelf(),M(t)}compare(e){const t=this.clone();return t.compareNode=M(e),t.referenceNode=this.getSelf(),M(t)}grad(e,t){const s=this.clone();return s.gradNode=[M(e),M(t)],s.referenceNode=this.getSelf(),M(s)}depth(e){const t=this.clone();return t.depthNode=M(e),t.referenceNode=this.getSelf(),M(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const pu=S(Ms).setParameterLength(1,4).setName("texture"),mu=(r=Gn,e=null,t=null,s=null)=>{let i;return r&&r.isTextureNode===!0?(i=M(r.clone()),i.referenceNode=r.getSelf(),e!==null&&(i.uvNode=M(e)),t!==null&&(i.levelNode=M(t)),s!==null&&(i.biasNode=M(s))):i=pu(r,e,t,s),i};class fu extends ve{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Nt,this.minFilter=Nt,this.generateMipmaps=!1,this.needsUpdate=!0}}const It=new _e;class gu extends Ms{static get type(){return"ViewportTextureNode"}constructor(e=pi,t=null,s=null){s===null&&(s=new fu,s.minFilter=on),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=re.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(It);const s=this.value;(s.image.width!==It.width||s.image.height!==It.height)&&(s.image.width=It.width,s.image.height=It.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}class fi extends ve{constructor(e,t,s=an,i,n,o,a=Nt,l=Nt,h,u=zi,c=1){if(u!==zi&&u!==Ho)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const p={width:e,height:t,depth:c};super(p,i,n,o,a,l,u,s,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new mi(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}let Ps=null;class yu extends gu{static get type(){return"ViewportDepthTextureNode"}constructor(e=pi,t=null){Ps===null&&(Ps=new fi),super(e,t,Ps)}}const xu=S(yu).setParameterLength(0,2);class ye extends ${static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===ye.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,s=this.valueNode;let i=null;if(t===ye.DEPTH_BASE)s!==null&&(i=Yn().assign(s));else if(t===ye.DEPTH)e.isPerspectiveCamera?i=Tu(Ue.z,Ft,bt):i=os(Ue.z,Ft,bt);else if(t===ye.LINEAR_DEPTH)if(s!==null)if(e.isPerspectiveCamera){const n=qn(s,Ft,bt);i=os(n,Ft,bt)}else i=s;else i=os(Ue.z,Ft,bt);return i}}ye.DEPTH_BASE="depthBase";ye.DEPTH="depth";ye.LINEAR_DEPTH="linearDepth";const os=(r,e,t)=>r.add(e).div(e.sub(t)),Tu=(r,e,t)=>e.add(r).mul(t).div(t.sub(e).mul(r)),qn=(r,e,t)=>e.mul(t).div(t.sub(e).mul(r).sub(t)),Yn=S(ye,ye.DEPTH_BASE),Nu=A(ye,ye.DEPTH),wu=S(ye,ye.LINEAR_DEPTH).setParameterLength(0,1);xu();Nu.assign=r=>Yn(r);const Os=new R,Su=new R,Mu=new Ie;class _u{constructor(e=new R(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,s,i){return this.normal.set(e,t,s),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,s){const i=Os.subVectors(s,t).cross(Su.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const s=e.delta(Os),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:t.copy(e.start).addScaledVector(s,n)}intersectsLine(e){const t=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return t<0&&s>0||s<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const s=t||Mu.getNormalMatrix(e),i=this.coplanarPoint(Os).applyMatrix4(e),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Zi=new Ve,Wi=new hn;class Yt{constructor(e=0,t=0,s=0,i=Yt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=s,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,i=this._order){return this._x=e,this._y=t,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){const i=e.elements,n=i[0],o=i[4],a=i[8],l=i[1],h=i[5],u=i[9],c=i[2],p=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(D(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-D(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(D(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(l,n));break;case"ZYX":this._y=Math.asin(-D(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(D(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-D(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return Zi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Zi,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Wi.setFromEuler(this),this.setFromQuaternion(Wi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Yt.DEFAULT_ORDER="XYZ";class Xn extends Js{constructor(e=1,t=1,s={}){super(),s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:$s,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},s),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=s.depth,this.scissor=new et(0,0,e,t),this.scissorTest=!1,this.viewport=new et(0,0,e,t);const i={width:e,height:t,depth:s.depth},n=new ve(i);this.textures=[];const o=s.count;for(let a=0;a<o;a++)this.textures[a]=n.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(s),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=s.depthTexture,this.samples=s.samples,this.multiview=s.multiview}_setTextureOptions(e={}){const t={minFilter:$s,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let s=0;s<this.textures.length;s++)this.textures[s].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,s=1){if(this.width!==e||this.height!==t||this.depth!==s){this.width=e,this.height=t,this.depth=s;for(let i=0,n=this.textures.length;i<n;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=s,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,s=e.textures.length;t<s;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new mi(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}new _u;new R;new R;new R;new Ve;new R(0,0,-1);new et;new R;new R;new et;new _e;const vu=new Xn;pi.flipX();vu.depthTexture=new fi(1,1);const ji=new Yt,ks=new Ve,Cu=pe(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio),Eu=pe(new Ve).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:e}){const t=e.environment!==null&&r.envMap===null?e.environmentRotation:r.envMapRotation;return t?(ji.copy(t),ks.makeRotationFromEuler(ji)):ks.identity(),ks}),zu=Bn.negate().reflect(Dn),Au=Bn.negate().refract(Dn,Cu),Fu=zu.transformDirection(ws).toVar("reflectVector"),bu=Au.transformDirection(ws).toVar("reflectVector");class Ru extends ve{constructor(e=[],t=rn,s,i,n,o,a,l,h,u){super(e,t,s,i,n,o,a,l,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}const Vu=new Ru;class Iu extends Ms{static get type(){return"CubeTextureNode"}constructor(e,t=null,s=null,i=null){super(e,t,s,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===rn?Fu:e.mapping===Po?bu:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),q(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return(e.renderer.coordinateSystem===hs||!s.isRenderTargetTexture)&&(t=q(t.x.negate(),t.yz)),Eu.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const Lu=S(Iu).setParameterLength(1,4).setName("cubeTexture"),Pu=(r=Vu,e=null,t=null,s=null)=>{let i;return r&&r.isCubeTextureNode===!0?(i=M(r.clone()),i.referenceNode=r.getSelf(),e!==null&&(i.uvNode=M(e)),t!==null&&(i.levelNode=M(t)),s!==null&&(i.biasNode=M(s))):i=Lu(r,e,t,s),i};class Ou extends Ht{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,s,i)}}class Zn extends ${static get type(){return"ReferenceNode"}constructor(e,t,s=null,i=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=i,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=re.OBJECT}element(e){return M(new Ou(this,M(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=Yh(null,e,this.count):Array.isArray(this.getValueFromReference())?t=kn(null,e):e==="texture"?t=mu(null):e==="cubeTexture"?t=Pu(null):t=pe(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let i=1;i<t.length;i++)s=s[t[i]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const ds=(r,e,t)=>M(new Zn(r,e,t));class ku extends Zn{static get type(){return"MaterialReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Bu=(r,e,t=null)=>M(new ku(r,e,t)),Wn=K(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),ci("tangent","vec4")))(),Du=Wn.xyz.toVar("tangentLocal"),jn=eu.mul(De(Du,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),Uu=K(([r,e],t)=>{let s=r.mul(Wn.w).xyz;return t.material.flatShading!==!0&&(s=$e(s,e)),s}).once(),Hu=Uu(Mt.cross(jn),"v_bitangentView").normalize().toVar("bitangentView"),$u=Gt(jn,Hu,Mt),Gu=K(r=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:i}=r,n=e.dFdx(),o=e.dFdy(),a=i.dFdx(),l=i.dFdy(),h=t,u=o.cross(h),c=h.cross(n),p=u.mul(a.x).add(c.mul(l.x)),d=u.mul(a.y).add(c.mul(l.y)),g=p.dot(p).max(d.dot(d)),w=di.mul(g.inverseSqrt());return wn(p.mul(s.x,w),d.mul(s.y,w),h.mul(s.z)).normalize()});class qu extends fe{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Ai}setup(e){const{normalMapType:t,scaleNode:s}=this;let i=this.node.mul(2).sub(1);s!==null&&(i=q(i.xy.mul(s),i.z));let n=null;return t===$o?n=Un(i):t===Ai&&(e.hasGeometryAttribute("tangent")===!0?n=$u.mul(i).normalize():n=Gu({eye_pos:Ue,surf_norm:Mt,mapN:i,uv:Ss()})),n}}const Ki=S(qu).setParameterLength(1,2),Yu=K(({textureNode:r,bumpScale:e})=>{const t=i=>r.cache().context({getUV:n=>i(n.uvNode||Ss()),forceUVContext:!0}),s=Se(t(i=>i));return $t(Se(t(i=>i.add(i.dFdx()))).sub(s),Se(t(i=>i.add(i.dFdy()))).sub(s)).mul(e)}),Xu=K(r=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=r,i=e.dFdx().normalize(),n=e.dFdy().normalize(),o=t,a=n.cross(o),l=o.cross(i),h=i.dot(a).mul(di),u=h.sign().mul(s.x.mul(a).add(s.y.mul(l)));return h.abs().mul(t).sub(u).normalize()});class Zu extends fe{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Yu({textureNode:this.textureNode,bumpScale:e});return Xu({surf_pos:Ue,surf_norm:Mt,dHdxy:t})}}const Wu=S(Zu).setParameterLength(1,2),Ji=new Map;class x extends ${static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let s=Ji.get(e);return s===void 0&&(s=Bu(e,t),Ji.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let i=null;if(s===x.COLOR){const n=t.color!==void 0?this.getColor(s):q();t.map&&t.map.isTexture===!0?i=n.mul(this.getTexture("map")):i=n}else if(s===x.OPACITY){const n=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?i=n.mul(this.getTexture("alpha")):i=n}else if(s===x.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=Se(1);else if(s===x.SPECULAR_INTENSITY){const n=this.getFloat(s);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=n.mul(this.getTexture(s).a):i=n}else if(s===x.SPECULAR_COLOR){const n=this.getColor(s);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=n.mul(this.getTexture(s).rgb):i=n}else if(s===x.ROUGHNESS){const n=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).g):i=n}else if(s===x.METALNESS){const n=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=n.mul(this.getTexture(s).b):i=n}else if(s===x.EMISSIVE){const n=this.getFloat("emissiveIntensity"),o=this.getColor(s).mul(n);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(s)):i=o}else if(s===x.NORMAL)t.normalMap?(i=Ki(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):t.bumpMap?i=Wu(this.getTexture("bump").r,this.getFloat("bumpScale")):i=Mt;else if(s===x.CLEARCOAT){const n=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===x.CLEARCOAT_ROUGHNESS){const n=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===x.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=Ki(this.getTexture(s),this.getCache(s+"Scale","vec2")):i=Mt;else if(s===x.SHEEN){const n=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=n.mul(this.getTexture("sheenColor").rgb):i=n}else if(s===x.SHEEN_ROUGHNESS){const n=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).a):i=n,i=i.clamp(.07,1)}else if(s===x.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const n=this.getTexture(s);i=yn(Lt.x,Lt.y,Lt.y.negate(),Lt.x).mul(n.rg.mul(2).sub($t(1)).normalize().mul(n.b))}else i=Lt;else if(s===x.IRIDESCENCE_THICKNESS){const n=ds("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=ds("0","float",t.iridescenceThicknessRange);i=n.sub(o).mul(this.getTexture(s).g).add(o)}else i=n}else if(s===x.TRANSMISSION){const n=this.getFloat(s);t.transmissionMap?i=n.mul(this.getTexture(s).r):i=n}else if(s===x.THICKNESS){const n=this.getFloat(s);t.thicknessMap?i=n.mul(this.getTexture(s).g):i=n}else if(s===x.IOR)i=this.getFloat(s);else if(s===x.LIGHT_MAP)i=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===x.AO)i=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(s===x.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(s):Se(0);else{const n=this.getNodeType(e);i=this.getCache(s,n)}return i}}x.ALPHA_TEST="alphaTest";x.COLOR="color";x.OPACITY="opacity";x.SHININESS="shininess";x.SPECULAR="specular";x.SPECULAR_STRENGTH="specularStrength";x.SPECULAR_INTENSITY="specularIntensity";x.SPECULAR_COLOR="specularColor";x.REFLECTIVITY="reflectivity";x.ROUGHNESS="roughness";x.METALNESS="metalness";x.NORMAL="normal";x.CLEARCOAT="clearcoat";x.CLEARCOAT_ROUGHNESS="clearcoatRoughness";x.CLEARCOAT_NORMAL="clearcoatNormal";x.EMISSIVE="emissive";x.ROTATION="rotation";x.SHEEN="sheen";x.SHEEN_ROUGHNESS="sheenRoughness";x.ANISOTROPY="anisotropy";x.IRIDESCENCE="iridescence";x.IRIDESCENCE_IOR="iridescenceIOR";x.IRIDESCENCE_THICKNESS="iridescenceThickness";x.IOR="ior";x.TRANSMISSION="transmission";x.THICKNESS="thickness";x.ATTENUATION_DISTANCE="attenuationDistance";x.ATTENUATION_COLOR="attenuationColor";x.LINE_SCALE="scale";x.LINE_DASH_SIZE="dashSize";x.LINE_GAP_SIZE="gapSize";x.LINE_WIDTH="linewidth";x.LINE_DASH_OFFSET="dashOffset";x.POINT_SIZE="size";x.DISPERSION="dispersion";x.LIGHT_MAP="light";x.AO="ao";x.ALPHA_TEST;x.COLOR;x.SHININESS;x.EMISSIVE;x.OPACITY;x.SPECULAR;x.SPECULAR_INTENSITY;x.SPECULAR_COLOR;x.SPECULAR_STRENGTH;x.REFLECTIVITY;x.ROUGHNESS;x.METALNESS;x.NORMAL;x.CLEARCOAT;x.CLEARCOAT_ROUGHNESS;x.CLEARCOAT_NORMAL;x.ROTATION;x.SHEEN;x.SHEEN_ROUGHNESS;x.ANISOTROPY;x.IRIDESCENCE;x.IRIDESCENCE_IOR;x.IRIDESCENCE_THICKNESS;x.TRANSMISSION;x.THICKNESS;x.IOR;x.ATTENUATION_DISTANCE;x.ATTENUATION_COLOR;x.LINE_SCALE;x.LINE_DASH_SIZE;x.LINE_GAP_SIZE;x.LINE_WIDTH;x.LINE_DASH_OFFSET;x.POINT_SIZE;x.DISPERSION;x.LIGHT_MAP;x.AO;const Lt=pe(new _e).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),Pt=new Yt,Bs=new Ve;class xe extends ${static get type(){return"SceneNode"}constructor(e=xe.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let i;return t===xe.BACKGROUND_BLURRINESS?i=ds("backgroundBlurriness","float",s):t===xe.BACKGROUND_INTENSITY?i=ds("backgroundIntensity","float",s):t===xe.BACKGROUND_ROTATION?i=pe("mat4").label("backgroundRotation").setGroup(St).onRenderUpdate(()=>{const n=s.background;return n!==null&&n.isTexture&&n.mapping!==Ws?(Pt.copy(s.backgroundRotation),Pt.x*=-1,Pt.y*=-1,Pt.z*=-1,Bs.makeRotationFromEuler(Pt)):Bs.identity(),Bs}):console.error("THREE.SceneNode: Unknown scope:",t),i}}xe.BACKGROUND_BLURRINESS="backgroundBlurriness";xe.BACKGROUND_INTENSITY="backgroundIntensity";xe.BACKGROUND_ROTATION="backgroundRotation";xe.BACKGROUND_BLURRINESS;xe.BACKGROUND_INTENSITY;xe.BACKGROUND_ROTATION;K(({texture:r,uv:e})=>{const s=q().toVar();return ya(e.x.lessThan(1e-4),()=>{s.assign(q(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{s.assign(q(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{s.assign(q(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{s.assign(q(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{s.assign(q(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{s.assign(q(0,0,-1))}).Else(()=>{const n=r.sample(e.add(q(-.01,0,0))).r.sub(r.sample(e.add(q(.01,0,0))).r),o=r.sample(e.add(q(0,-.01,0))).r.sub(r.sample(e.add(q(0,.01,0))).r),a=r.sample(e.add(q(0,0,-.01))).r.sub(r.sample(e.add(q(0,0,.01))).r);s.assign(q(n,o,a))}),s.normalize()});const ns=new _e;class ju extends Ms{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Qi extends ju{static get type(){return"PassMultipleTextureNode"}constructor(e,t,s=!1){super(e,null),this.textureName=t,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class _s extends fe{static get type(){return"PassNode"}constructor(e,t,s,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const n=new fi;n.isRenderTargetTexture=!0,n.name="depth";const o=new Xn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Do,...i});o.texture.name="output",o.depthTexture=n,this.renderTarget=o,this._textures={output:o.texture,depth:n},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=pe(0),this._cameraFar=pe(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=re.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const s=this._textures[e],i=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=s,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=M(new Qi(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=M(new Qi(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const s=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=qn(this.getTextureNode(e),s,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const s=this._cameraNear,i=this._cameraFar,n=this.getViewZNode(e);this._linearDepthNodes[e]=t=os(n,s,i)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===_s.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s}=this;let i,n;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(n=1,i=t.xr.getCamera(),t.xr.updateCamera(i),ns.set(o.width,o.height)):(i=this.camera,n=t.getPixelRatio(),t.getSize(ns)),this._pixelRatio=n,this.setSize(ns.width,ns.height);const a=t.getRenderTarget(),l=t.getMRT(),h=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const u in this._previousTextures)this.toggleTexture(u);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(s,i),t.setRenderTarget(a),t.setMRT(l),i.layers.mask=h}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio*this._resolution,i=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}_s.COLOR="color";_s.DEPTH="depth";q(1.6605,-.1246,-.0182),q(-.5876,1.1329,-.1006),q(-.0728,-.0083,1.1187);q(.6274,.0691,.0164),q(.3293,.9195,.088),q(.0433,.0113,.8956);function Kn(r){let e;const t=r.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Ue.z).negate()}K(([r,e],t)=>{const s=Kn(t);return ai(r,e,s)});K(([r],e)=>{const t=Kn(e);return r.mul(r,t,t).negate().exp().oneMinus()});K(([r,e])=>De(e.toFloat().mix(Gi.rgb,r.toVec3()),Gi.a));class Ku extends ${constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:s}=e;s.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}S(Ku);class Le extends ${static get type(){return"AtomicFunctionNode"}constructor(e,t,s){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=s,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),s=t.parents,i=this.method,n=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,l=this.valueNode,h=[];h.push(`&${a.build(e,o)}`),l!==null&&h.push(l.build(e,o));const u=`${e.getMethod(i,n)}( ${h.join(", ")} )`;if(s.length===1&&s[0].isStackNode===!0)e.addLineFlowCode(u,this);else return t.constNode===void 0&&(t.constNode=cs(u,n).toConst()),t.constNode.build(e)}}Le.ATOMIC_LOAD="atomicLoad";Le.ATOMIC_STORE="atomicStore";Le.ATOMIC_ADD="atomicAdd";Le.ATOMIC_SUB="atomicSub";Le.ATOMIC_MAX="atomicMax";Le.ATOMIC_MIN="atomicMin";Le.ATOMIC_AND="atomicAnd";Le.ATOMIC_OR="atomicOr";Le.ATOMIC_XOR="atomicXor";S(Le);K(([r=Ss()],{renderer:e,material:t})=>{const s=Fn(r.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.samples>1){const n=Se(s.fwidth()).toVar();i=ai(n.oneMinus(),n.add(1),s).oneMinus()}else i=Ns(s.greaterThan(1),0,1);return i});function Ju(r,e,t){if(e==null)return r;if(Array.isArray(e))throw new Error("Multiple matches is not implemented");return typeof e=="number"&&~e?N(ot,null,[N("span",{class:"v-combobox__unmask"},[r.substr(0,e)]),N("span",{class:"v-combobox__mask"},[r.substr(e,t)]),N("span",{class:"v-combobox__unmask"},[r.substr(e+t)])]):r}const Qu=ms({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...jr({filterKeys:["title"]}),...Yr({hideNoData:!0,returnObject:!0}),...tn(Zr({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...no({transition:!1})},"VCombobox"),ec=ps()({name:"VCombobox",props:Qu(),emits:{"update:focused":r=>!0,"update:modelValue":r=>!0,"update:search":r=>!0,"update:menu":r=>!0},setup(r,e){var gi;let{emit:t,slots:s}=e;const{t:i}=Cr(),n=le(),o=vt(!1),a=vt(!0),l=vt(!1),h=le(),u=le(),c=Ds(r,"menu"),p=Y({get:()=>c.value,set:_=>{var B;c.value&&!_&&((B=h.value)!=null&&B.openChildren.size)||(c.value=_)}}),d=vt(-1);let g=!1;const w=Y(()=>{var _;return(_=n.value)==null?void 0:_.color}),C=Y(()=>p.value?r.closeText:r.openText),{items:v,transformIn:H,transformOut:P}=so(r),{textColorClasses:k,textColorStyles:L}=Er(w),z=Ds(r,"modelValue",[],_=>H(zr(_)),_=>{const B=P(_);return r.multiple?B:B[0]??null}),V=Jr(r),he=Y(()=>!!(r.chips||s.chip)),oe=Y(()=>he.value||!!s.selection),F=vt(!r.multiple&&!oe.value?((gi=z.value[0])==null?void 0:gi.title)??"":""),y=Y({get:()=>F.value,set:_=>{var B;if(F.value=_??"",!r.multiple&&!oe.value&&(z.value=[Et(r,_)]),_&&r.multiple&&((B=r.delimiters)!=null&&B.length)){const ee=_.split(new RegExp(`(?:${r.delimiters.join("|")})+`));ee.length>1&&(ee.forEach(U=>{U=U.trim(),U&&Re(Et(r,U))}),F.value="")}_||(d.value=-1),a.value=!_}}),f=Y(()=>typeof r.counterValue=="function"?r.counterValue(z.value):typeof r.counterValue=="number"?r.counterValue:r.multiple?z.value.length:y.value.length);Je(F,_=>{g?Ti(()=>g=!1):o.value&&!p.value&&(p.value=!0),t("update:search",_)}),Je(z,_=>{var B;!r.multiple&&!oe.value&&(F.value=((B=_[0])==null?void 0:B.title)??"")});const{filteredItems:I,getMatches:E}=Wr(r,v,()=>a.value?"":y.value),W=Y(()=>r.hideSelected?I.value.filter(_=>!z.value.some(B=>B.value===_.value)):I.value),ue=Y(()=>z.value.map(_=>_.value)),Ge=Y(()=>{var B;return(r.autoSelectFirst===!0||r.autoSelectFirst==="exact"&&y.value===((B=W.value[0])==null?void 0:B.title))&&W.value.length>0&&!a.value&&!l.value}),qe=Y(()=>r.hideNoData&&!W.value.length||V.isReadonly.value||V.isDisabled.value),Ye=le(),at=qr(Ye,n);function lt(_){g=!0,r.openOnClear&&(p.value=!0)}function Jn(){qe.value||(p.value=!0)}function Qn(_){qe.value||(o.value&&(_.preventDefault(),_.stopPropagation()),p.value=!p.value)}function er(_){var B;Ir(_)&&((B=n.value)==null||B.focus())}function tr(_){var U;if(Ar(_)||V.isReadonly.value)return;const B=n.value.selectionStart,ee=z.value.length;if((d.value>-1||["Enter","ArrowDown","ArrowUp"].includes(_.key))&&_.preventDefault(),["Enter","ArrowDown"].includes(_.key)&&(p.value=!0),["Escape"].includes(_.key)&&(p.value=!1),["Enter","Escape","Tab"].includes(_.key)&&(Ge.value&&["Enter","Tab"].includes(_.key)&&!z.value.some(X=>{let{value:Me}=X;return Me===W.value[0].value})&&Re(I.value[0]),a.value=!0),_.key==="ArrowDown"&&Ge.value&&((U=Ye.value)==null||U.focus("next")),_.key==="Enter"&&y.value&&(Re(Et(r,y.value)),oe.value&&(F.value="")),["Backspace","Delete"].includes(_.key)){if(!r.multiple&&oe.value&&z.value.length>0&&!y.value)return Re(z.value[0],!1);if(~d.value){const X=d.value;Re(z.value[d.value],!1),d.value=X>=ee-1?ee-2:X}else _.key==="Backspace"&&!y.value&&(d.value=ee-1)}if(r.multiple){if(_.key==="ArrowLeft"){if(d.value<0&&B>0)return;const X=d.value>-1?d.value-1:ee-1;z.value[X]?d.value=X:(d.value=-1,n.value.setSelectionRange(y.value.length,y.value.length))}if(_.key==="ArrowRight"){if(d.value<0)return;const X=d.value+1;z.value[X]?d.value=X:(d.value=-1,n.value.setSelectionRange(0,0))}}}function sr(){var _;r.eager&&((_=u.value)==null||_.calculateVisibleItems())}function ir(){var _;o.value&&(a.value=!0,(_=n.value)==null||_.focus())}function Re(_){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!_||_.props.disabled))if(r.multiple){const ee=z.value.findIndex(X=>r.valueComparator(X.value,_.value)),U=B??!~ee;if(~ee){const X=U?[...z.value,_]:[...z.value];X.splice(ee,1),z.value=X}else U&&(z.value=[...z.value,_]);r.clearOnSelect&&(y.value="")}else{const ee=B!==!1;z.value=ee?[_]:[],F.value=ee&&!oe.value?_.title:"",Ti(()=>{p.value=!1,a.value=!0})}}function nr(_){o.value=!0,setTimeout(()=>{l.value=!0})}function rr(_){l.value=!1}function or(_){(_==null||_===""&&!r.multiple&&!oe.value)&&(z.value=[])}return Je(o,(_,B)=>{if(!(_||_===B)&&(d.value=-1,p.value=!1,y.value)){if(r.multiple){Re(Et(r,y.value));return}if(!oe.value)return;z.value.some(ee=>{let{title:U}=ee;return U===y.value})?F.value="":Re(Et(r,y.value))}}),Je(p,()=>{if(!r.hideSelected&&p.value&&z.value.length){const _=W.value.findIndex(B=>z.value.some(ee=>r.valueComparator(ee.value,B.value)));Fr&&window.requestAnimationFrame(()=>{var B;_>=0&&((B=u.value)==null||B.scrollToIndex(_))})}}),Je(()=>r.items,(_,B)=>{p.value||o.value&&!B.length&&_.length&&(p.value=!0)}),fs(()=>{const _=!!(!r.hideNoData||W.value.length||s["prepend-item"]||s["append-item"]||s["no-data"]),B=z.value.length>0,ee=Ot.filterProps(r);return N(Ot,ke({ref:n},ee,{modelValue:y.value,"onUpdate:modelValue":[U=>y.value=U,or],focused:o.value,"onUpdate:focused":U=>o.value=U,validationValue:z.externalValue,counterValue:f.value,dirty:B,class:["v-combobox",{"v-combobox--active-menu":p.value,"v-combobox--chips":!!r.chips,"v-combobox--selection-slot":!!oe.value,"v-combobox--selecting-index":d.value>-1,[`v-combobox--${r.multiple?"multiple":"single"}`]:!0},r.class],style:r.style,readonly:V.isReadonly.value,placeholder:B?void 0:r.placeholder,"onClick:clear":lt,"onMousedown:control":Jn,onKeydown:tr}),{...s,default:()=>N(ot,null,[N(ro,ke({ref:h,modelValue:p.value,"onUpdate:modelValue":U=>p.value=U,activator:"parent",contentClass:"v-combobox__content",disabled:qe.value,eager:r.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:r.transition,onAfterEnter:sr,onAfterLeave:ir},r.menuProps),{default:()=>[_&&N(io,ke({ref:Ye,selected:ue.value,selectStrategy:r.multiple?"independent":"single-independent",onMousedown:U=>U.preventDefault(),onKeydown:er,onFocusin:nr,onFocusout:rr,tabindex:"-1","aria-live":"polite",color:r.itemColor??r.color},at,r.listProps),{default:()=>{var U,X,Me;return[(U=s["prepend-item"])==null?void 0:U.call(s),!W.value.length&&!r.hideNoData&&(((X=s["no-data"])==null?void 0:X.call(s))??N(Mi,{title:i(r.noDataText)},null)),N(Xr,{ref:u,renderless:!0,items:W.value},{default:tt=>{var xi;let{item:ge,index:st,itemRef:Te}=tt;const yi=ke(ge.props,{ref:Te,key:st,active:Ge.value&&st===0?!0:void 0,onClick:()=>Re(ge,null)});return((xi=s.item)==null?void 0:xi.call(s,{item:ge,index:st,props:yi}))??N(Mi,ke(yi,{role:"option"}),{prepend:Xt=>{let{isSelected:Zt}=Xt;return N(ot,null,[r.multiple&&!r.hideSelected?N(oo,{key:ge.value,modelValue:Zt,ripple:!1,tabindex:"-1"},null):void 0,ge.props.prependAvatar&&N(ao,{image:ge.props.prependAvatar},null),ge.props.prependIcon&&N(gt,{icon:ge.props.prependIcon},null)])},title:()=>{var Xt,Zt;return a.value?ge.title:Ju(ge.title,(Xt=E(ge))==null?void 0:Xt.title,((Zt=y.value)==null?void 0:Zt.length)??0)}})}}),(Me=s["append-item"])==null?void 0:Me.call(s)]}})]}),z.value.map((U,X)=>{function Me(Te){Te.stopPropagation(),Te.preventDefault(),Re(U,!1)}const tt={"onClick:close":Me,onKeydown(Te){Te.key!=="Enter"&&Te.key!==" "||(Te.preventDefault(),Te.stopPropagation(),Me(Te))},onMousedown(Te){Te.preventDefault(),Te.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},ge=he.value?!!s.chip:!!s.selection,st=ge?Rr(he.value?s.chip({item:U,index:X,props:tt}):s.selection({item:U,index:X})):void 0;if(!(ge&&!st))return N("div",{key:U.value,class:["v-combobox__selection",X===d.value&&["v-combobox__selection--selected",k.value]],style:X===d.value?L.value:{}},[he.value?s.chip?N(Vr,{key:"chip-defaults",defaults:{VChip:{closable:r.closableChips,size:"small",text:U.title}}},{default:()=>[st]}):N(lo,ke({key:"chip",closable:r.closableChips,size:"small",text:U.title,disabled:U.props.disabled},tt),null):st??N("span",{class:"v-combobox__selection-text"},[U.title,r.multiple&&X<z.value.length-1&&N("span",{class:"v-combobox__selection-comma"},[ae(",")])])])})]),"append-inner":function(){var tt;for(var U=arguments.length,X=new Array(U),Me=0;Me<U;Me++)X[Me]=arguments[Me];return N(ot,null,[(tt=s["append-inner"])==null?void 0:tt.call(s,...X),(!r.hideNoData||r.items.length)&&r.menuIcon?N(gt,{class:"v-combobox__menu-icon",icon:r.menuIcon,onMousedown:Qn,onClick:br,"aria-label":i(C.value),title:i(C.value),tabindex:"-1"},null):void 0])}})}),to({isFocused:o,isPristine:a,menu:p,search:y,selectionIndex:d,filteredItems:I,select:Re},n)}}),tc=ms({...uo({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),en=ps()({name:"VRadio",props:tc(),setup(r,e){let{slots:t}=e;return fs(()=>{const s=Us.filterProps(r);return N(Us,ke(s,{class:["v-radio",r.class],style:r.style,type:"radio"}),t)}),{}}}),sc=ms({height:{type:[Number,String],default:"auto"},...Qr(),...tn(co(),["multiple"]),trueIcon:{type:Ni,default:"$radioOn"},falseIcon:{type:Ni,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),ic=ps()({name:"VRadioGroup",inheritAttrs:!1,props:sc(),emits:{"update:modelValue":r=>!0},setup(r,e){let{attrs:t,slots:s}=e;const i=Lr(),n=Y(()=>r.id||`radio-group-${i}`),o=Ds(r,"modelValue");return fs(()=>{const[a,l]=Pr(t),h=Si.filterProps(r),u=Us.filterProps(r),c=s.label?s.label({label:r.label,props:{for:n.value}}):r.label;return N(Si,ke({class:["v-radio-group",r.class],style:r.style},a,h,{modelValue:o.value,"onUpdate:modelValue":p=>o.value=p,id:n.value}),{...s,default:p=>{let{id:d,messagesId:g,isDisabled:w,isReadonly:C}=p;return N(ot,null,[c&&N(eo,{id:d.value},{default:()=>[c]}),N(po,ke(u,{id:d.value,"aria-describedby":g.value,defaultsTarget:"VRadio",trueIcon:r.trueIcon,falseIcon:r.falseIcon,type:r.type,disabled:w.value,readonly:C.value,"aria-labelledby":c?d.value:void 0,multiple:!1},l,{modelValue:o.value,"onUpdate:modelValue":v=>o.value=v}),s)])}})}),{}}}),nc=.45,rc={__name:"index",setup(r){const e=le([]),t=Br(),s=le({cliente_id:null,observaciones:"",material:"",color:"",tipoVidrio:"",productoVidrioProveedor:"",ventanas:[]}),i=le({}),n=Or({cliente:null}),o=le([]),a=le([]),l=le([]),h=le([]),u=le([]),c=le([]),p=le(""),d=le(!1),g=le(0);le({firstName:"",lastName:"",company:"",code:"",email:"",phone:"",city:"",municipality:"",address:"",activity:""}),Y(()=>h.value.flatMap(F=>F.colores_por_proveedor.map(y=>{var f;return{id:`${F.id}-${y.proveedor_id}`,producto_id:F.id,proveedor_id:y.proveedor_id,nombre:`${F.nombre} (${((f=y.proveedor)==null?void 0:f.nombre)||"Proveedor desconocido"})`}})));const w=Y(()=>{const F=s.value.tipoVidrio;return h.value.filter(y=>y.tipo_producto_id===F).flatMap(y=>y.colores_por_proveedor.map(f=>{var I;return{id:f.id,producto_id:y.id,proveedor_id:f.proveedor_id,nombre:`${y.nombre} (${((I=f.proveedor)==null?void 0:I.nombre)||"Proveedor desconocido"})`}}))});kr(async()=>{const[F,y,f,I,E,W]=await Promise.all([Xe.get("/api/tipos_material"),Xe.get("/api/colores"),Xe.get("/api/tipos_producto"),Xe.get("/api/productos"),Xe.get("/api/tipos_ventana"),Xe.get("/api/clientes")]);o.value=F.data,a.value=y.data,l.value=f.data.filter(ue=>[1,2].includes(ue.id)),h.value=I.data.filter(ue=>[1,2].includes(ue.tipo_producto_id)),u.value=E.data,c.value=W.data});const C=F=>(F=parseInt(F),h.value.flatMap(y=>y.colores_por_proveedor.map(f=>({id:f.id,producto_id:y.id,proveedor_id:f.proveedor_id}))).find(y=>y.id===F)),v=F=>{const y=F.tipoVidrio??s.value.tipoVidrio;return h.value.filter(f=>f.tipo_producto_id===y).flatMap(f=>f.colores_por_proveedor.map(I=>{var E;return{id:I.id,producto_id:f.id,proveedor_id:I.proveedor_id,nombre:`${f.nombre} (${((E=I.proveedor)==null?void 0:E.nombre)||"Proveedor desconocido"})`}}))},H=Y(()=>{const F=p.value.toLowerCase(),y=new Set;return c.value.filter(f=>{var I;return(I=f.razon_social)==null?void 0:I.toLowerCase().includes(F)}).filter(f=>y.has(f.id)?!1:(y.add(f.id),!0)).map((f,I)=>{var E;return{uid:`${f.id}-${I}`,id:f.id,razon_social:(E=f.razon_social)==null?void 0:E.trim(),raw:f}})}),P=(F=null)=>{const f={...{tipo:null,ancho:null,alto:null,cantidad:1,material:s.value.material,color:s.value.color,tipoVidrio:s.value.tipoVidrio,productoVidrioProveedor:s.value.productoVidrioProveedor??null,hojas_totales:2,hojas_moviles:2,materiales:[],costo_total:0,costo_total_unitario:0,costo:0,precio_unitario:0,precio:0,hoja1AlFrente:!0},...F||{}};s.value.ventanas.push(f);const I=C(f.productoVidrioProveedor);if(f.tipo&&f.ancho&&f.alto&&I){const E={...f,productoVidrio:I.producto_id,proveedorVidrio:I.proveedor_id,hojas_moviles:f.tipo===3||f.tipo===46?f.hojas_moviles:void 0};z(E,f)}},k=F=>{s.value.ventanas.splice(F,1)},L=F=>{const y=F.material??s.value.material;return u.value.filter(f=>f.material_id===y)},z=ar(async(F,y)=>{if(!F.productoVidrio||!F.proveedorVidrio){console.warn(" Faltan datos en el payload para calcular materiales:",F);return}try{const f=await Xe.post("/api/cotizador/calcular-materiales",F);y.costo_total_unitario=f.data.costo_unitario;const I=y.cantidad>0?y.cantidad:1;y.costo_total=f.data.costo_unitario*y.cantidad,y.precio=Math.ceil(y.costo_total/(1-nc)),y.materiales=f.data.materiales}catch(f){console.error(" Error al calcular materiales",f),y.costo_total=0,y.materiales=[]}},1e3);Je(()=>s.value.ventanas,F=>{F.forEach(y=>{Je(()=>[y.tipo,y.ancho,y.alto,y.cantidad,y.material,y.color,y.tipoVidrio,y.productoVidrioProveedor,y.hojas_totales,y.hojas_moviles],()=>{const f=[];y.tipo||f.push("tipo_ventana_id faltante"),y.ancho||f.push("ancho faltante"),y.alto||f.push("alto faltante"),(!y.cantidad||y.cantidad<=0)&&f.push("cantidad invlida"),y.productoVidrioProveedor||f.push("productoVidrioProveedor faltante");const I=C(y.productoVidrioProveedor);if(I||f.push(`relacin producto-proveedor no encontrada (ID: ${y.productoVidrioProveedor})`),f.length>0){console.warn(` No se puede recalcular la ventana (tipo ${y.tipo}):`,f.join(", "));return}const E={...y,productoVidrio:I.producto_id,proveedorVidrio:I.proveedor_id,hojas_moviles:y.tipo===3||y.tipo===46?y.hojas_moviles:void 0};console.log(" Recalculando ventana:",E),z(E,y)},{deep:!0,immediate:!1})})},{deep:!0}),Je(()=>n.cliente,F=>{F!=null&&F.raw&&console.log(" Cliente seleccionado:",F.raw)});const V=()=>{d.value=!0},he=async()=>{const F=[];for(let y=0;y<e.value.length;y++){const f=e.value[y];if(f!=null&&f.exportarImagen){const I=f.exportarImagen();F.push(I)}else F.push(null)}return F},oe=async()=>{var F;try{const y=await he(),f=(F=n.cliente)==null?void 0:F.raw;if(!f||s.value.ventanas.length===0){alert("Debes seleccionar un cliente y agregar al menos una ventana");return}const I={cliente_id:f.id,vendedor_id:1,fecha:new Date().toISOString().split("T")[0],estado_cotizacion_id:s.value.estado_cotizacion_id??1,observaciones:s.value.observaciones,imagenes_ventanas:y,ventanas:s.value.ventanas.map(E=>{const W=C(E.productoVidrioProveedor);return{tipo_ventana_id:E.tipo,ancho:E.ancho,alto:E.alto,cantidad:E.cantidad,color_id:E.color,producto_vidrio_proveedor_id:E.productoVidrioProveedor,producto_id:W==null?void 0:W.producto_id,proveedor_id:W==null?void 0:W.proveedor_id,costo:E.costo_total||E.costo||0,costo_unitario:E.costo_unitario||0,precio:E.precio||0,precio_unitario:E.precio_unitario||0}})};await Xe.post("api/cotizaciones",I),alert("Cotizacin guardada correctamente"),t.push({name:"cotizaciones"})}catch(y){console.error("Error al guardar cotizacin:",y),alert("Error al guardar la cotizacin")}};return(F,y)=>(we(),Pe($r,{fluid:""},{default:b(()=>[N(wi,{class:"pa-6",elevation:"2"},{default:b(()=>[N(Gr,{class:"text-h5 mb-4"},{default:b(()=>y[7]||(y[7]=[ae("Nueva Cotizacin")])),_:1}),N(Cs,{class:"text-h6"},{default:b(()=>y[8]||(y[8]=[ae("Datos generales")])),_:1}),N(Wt,{class:"mb-4"}),N(ut,{dense:""},{default:b(()=>[N(Q,{cols:"6",md:"4"},{default:b(()=>[N(ut,{"no-gutters":"",align:"center"},{default:b(()=>[N(Q,null,{default:b(()=>[(we(),Pe(ec,{modelValue:n.cliente,"onUpdate:modelValue":y[0]||(y[0]=f=>n.cliente=f),rules:[f=>!!f||"Selecciona un cliente"],search:p.value,"onUpdate:search":y[1]||(y[1]=f=>p.value=f),items:H.value,"item-title":"razon_social","item-value":"uid",label:"Cliente","return-object":"",clearable:"","menu-props":{virtualScroll:!1},key:g.value,outlined:"",color:"primary"},null,8,["modelValue","rules","search","items"]))]),_:1}),N(Q,{cols:"auto"},{default:b(()=>[N(Ct,{icon:"",color:"primary",onClick:V,class:"ml-2"},{default:b(()=>[N(gt,null,{default:b(()=>y[9]||(y[9]=[ae("mdi-plus")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),N(ut,{dense:""},{default:b(()=>[N(Q,{cols:"6"},{default:b(()=>[N(ho,{modelValue:s.value.observaciones,"onUpdate:modelValue":y[2]||(y[2]=f=>s.value.observaciones=f),label:"Observaciones",outlined:"",color:"primary","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1}),N(ut,{dense:"",class:"mb-4"},{default:b(()=>[N(Q,{cols:"12",md:"6"},{default:b(()=>[N(Ee,{modelValue:s.value.material,"onUpdate:modelValue":y[3]||(y[3]=f=>s.value.material=f),items:o.value,"item-title":"nombre","item-value":"id",label:"Material",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),N(Q,{cols:"12",md:"6"},{default:b(()=>[N(Ee,{modelValue:s.value.color,"onUpdate:modelValue":y[4]||(y[4]=f=>s.value.color=f),items:a.value,"item-title":"nombre","item-value":"id",label:"Color",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1})]),_:1}),N(Cs,{class:"text-h6"},{default:b(()=>y[10]||(y[10]=[ae("Vidrio por defecto")])),_:1}),N(Wt,{class:"mb-4"}),N(ut,{dense:"",class:"mb-4"},{default:b(()=>[N(Q,{cols:"12",sm:"6"},{default:b(()=>[N(Ee,{modelValue:s.value.tipoVidrio,"onUpdate:modelValue":y[5]||(y[5]=f=>s.value.tipoVidrio=f),items:l.value,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1}),N(Q,{cols:"12",sm:"6"},{default:b(()=>[N(Ee,{modelValue:s.value.productoVidrioProveedor,"onUpdate:modelValue":y[6]||(y[6]=f=>s.value.productoVidrioProveedor=f),items:w.value,"item-title":"nombre","item-value":"id",label:"Producto de vidrio",outlined:"",color:"primary"},null,8,["modelValue","items"])]),_:1})]),_:1}),N(Cs,{class:"text-h6"},{default:b(()=>y[11]||(y[11]=[ae("Ventanas")])),_:1}),N(Wt,{class:"mb-4"}),(we(!0),rs(ot,null,Dr(s.value.ventanas,(f,I)=>(we(),rs("div",{key:I,class:"mb-4"},[N(wi,{class:"pa-4",outlined:""},{default:b(()=>[N(ut,{dense:""},{default:b(()=>[N(Q,{cols:"12",sm:"6"},{default:b(()=>[N(Ee,{modelValue:f.tipo,"onUpdate:modelValue":E=>f.tipo=E,items:L(f),"item-title":"nombre","item-value":"id",label:"Tipo de ventana",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ot,{modelValue:f.ancho,"onUpdate:modelValue":E=>f.ancho=E,modelModifiers:{number:!0},label:"Ancho (mm)",type:"number",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ot,{modelValue:f.alto,"onUpdate:modelValue":E=>f.alto=E,modelModifiers:{number:!0},label:"Alto (mm)",type:"number",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),f.tipo===3||f.tipo===46?(we(),rs(ot,{key:0},[N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ee,{modelValue:f.hojas_totales,"onUpdate:modelValue":E=>f.hojas_totales=E,items:[2,3,4,6],label:"Hojas totales",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ee,{modelValue:f.hojas_moviles,"onUpdate:modelValue":E=>f.hojas_moviles=E,items:[1,2,3,4],label:"Hojas mviles",disabled:!f.hojas_totales,rules:[E=>!E||E<=f.hojas_totales||"No puede exceder total"],outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","disabled","rules"])]),_:2},1024),f.hojas_moviles===1?(we(),Pe(Q,{key:0,cols:"12",sm:"6"},{default:b(()=>[N(ic,{modelValue:f.hojaMovilSeleccionada,"onUpdate:modelValue":E=>f.hojaMovilSeleccionada=E,row:"",label:"Selecciona la hoja que se mueve"},{default:b(()=>[N(en,{label:"Mover hoja izquierda (1)",value:1}),N(en,{label:"Mover hoja derecha (2)",value:2})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):it("",!0)],64)):it("",!0),N(Q,{cols:"6"},{default:b(()=>{var E,W;return[f.tipo===2?(we(),Pe(yo,{key:0,ancho:f.ancho,alto:f.alto,"color-marco":((E=a.value.find(ue=>ue.id===f.color))==null?void 0:E.nombre)||"blanco"},null,8,["ancho","alto","color-marco"])):f.tipo===3?(we(),Pe(Hr,{key:1,ref_for:!0,ref:ue=>e.value[I]=ue,ancho:f.ancho,alto:f.alto,"color-marco":((W=a.value.find(ue=>ue.id===f.color))==null?void 0:W.nombre)||"blanco","hojas-moviles":f.hojas_moviles,"hoja-movil-seleccionada":f.hojaMovilSeleccionada,"hojas-totales":f.hojas_totales,"orden-hoja1-al-frente":f.hoja1AlFrente},null,8,["ancho","alto","color-marco","hojas-moviles","hoja-movil-seleccionada","hojas-totales","orden-hoja1-al-frente"])):it("",!0)]}),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ot,{modelValue:f.cantidad,"onUpdate:modelValue":E=>f.cantidad=E,label:"Cantidad",type:"number",min:"1",rules:[E=>E>0||"Debe ser mayor a 0"],outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ee,{modelValue:f.material,"onUpdate:modelValue":E=>f.material=E,items:o.value,"item-title":"nombre","item-value":"id",label:"Material (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ee,{modelValue:f.color,"onUpdate:modelValue":E=>f.color=E,items:a.value,"item-title":"nombre","item-value":"id",label:"Color (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),N(Q,{cols:"6",sm:"3"},{default:b(()=>[N(Ee,{modelValue:f.tipoVidrio,"onUpdate:modelValue":E=>f.tipoVidrio=E,items:l.value,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),N(Q,{cols:"12",sm:"6"},{default:b(()=>[N(Ee,{modelValue:f.productoVidrioProveedor,"onUpdate:modelValue":E=>f.productoVidrioProveedor=E,items:v(f),"item-title":"nombre","item-value":"id",label:"Producto de vidrio (opcional)",outlined:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),N(Q,{cols:"12"},{default:b(()=>[f.costo_total_unitario?(we(),Pe(Es,{key:0,type:"info",variant:"outlined",dense:"",class:"mb-2"},{default:b(()=>[y[12]||(y[12]=vs("strong",null,"Costo unitario:",-1)),ae(" $"+ht(f.costo_total_unitario.toLocaleString()),1)]),_:2},1024)):it("",!0),f.costo_total?(we(),Pe(Es,{key:1,type:"info",variant:"tonal",dense:"",class:"mb-2"},{default:b(()=>[y[13]||(y[13]=vs("strong",null,"Costo total de materiales:",-1)),ae(" $"+ht(f.costo_total.toLocaleString()),1)]),_:2},1024)):it("",!0),f.precio?(we(),Pe(Es,{key:2,type:"success",variant:"tonal",dense:"",class:"mt-2"},{default:b(()=>[y[14]||(y[14]=vs("strong",null,"Precio sugerido:",-1)),ae(" $"+ht(f.precio.toLocaleString()),1)]),_:2},1024)):it("",!0),N(Ct,{onClick:E=>i.value[I]=!i.value[I],color:"primary",variant:"outlined"},{default:b(()=>[N(gt,{left:""},{default:b(()=>y[15]||(y[15]=[ae("mdi-eye")])),_:1}),ae(" "+ht(i.value[I]?"Ocultar":"Ver")+" Costos ",1)]),_:2},1032,["onClick"]),i.value[I]&&f.materiales&&f.materiales.length?(we(),Pe(Kr,{key:3,headers:[{title:"Producto",key:"nombre"},{title:"Proveedor",key:"proveedor"},{title:"Cantidad",key:"cantidad"},{title:"Unidad",key:"unidad"},{title:"Costo Unitario",key:"costo_unitario"},{title:"Costo Total",key:"costo_total"}],items:f.materiales,"items-per-page":-1,class:"elevation-1 mt-4","hide-default-footer":""},{"item.costo_unitario":b(({item:E})=>[ae(" $"+ht(E.costo_unitario.toLocaleString()),1)]),"item.costo_total":b(({item:E})=>[ae(" $"+ht(E.costo_total.toLocaleString()),1)]),_:2},1032,["items"])):it("",!0)]),_:2},1024),N(Q,{cols:"12",class:"text-right"},{default:b(()=>[N(Ct,{color:"error",variant:"outlined",onClick:E=>k(I)},{default:b(()=>[N(gt,{left:""},{default:b(()=>y[16]||(y[16]=[ae("mdi-delete")])),_:1}),y[17]||(y[17]=ae(" Quitar ventana "))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),N(Ct,{onClick:P,color:"primary",variant:"outlined",class:"mb-4"},{default:b(()=>[N(gt,{left:""},{default:b(()=>y[18]||(y[18]=[ae("mdi-plus")])),_:1}),y[19]||(y[19]=ae(" Agregar ventana "))]),_:1}),N(Wt,{class:"my-4"}),N(Ct,{color:"primary",onClick:oe,block:"","prepend-icon":"mdi-content-save",elevation:"2",class:"py-4"},{default:b(()=>y[20]||(y[20]=[ae(" Guardar Cotizacin ")])),_:1})]),_:1})]),_:1}))}},Ic=Ur(rc,[["__scopeId","data-v-7b5684a0"]]);export{Ic as default};
