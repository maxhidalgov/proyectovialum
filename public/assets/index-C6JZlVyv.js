import{r as m,X as u,w as P,E as q,c as H,b as t,f as K,m as Q,e as a,ar as T,o as $,n as W,a3 as Z,t as x,v as n,d as r,x as ee}from"./index-zXGCFGIg.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as v}from"./VCard-BivyUXWm.js";import{V as ae}from"./VAlert-DnyJZ4VW.js";import{V as C,a as d}from"./VRow-C1LQQmap.js";import{V}from"./VCardText-C6b6sPjd.js";import{V as F}from"./VSelect-DPytfcsj.js";import{V as N}from"./VDataTable-CyyfS5q2.js";import"./VAvatar-MgFTNfdu.js";import"./VImg-CHMTV0xF.js";import"./transition-BvxzZJi3.js";/* empty css              */import"./VTextField-B1sfjoWq.js";import"./VInput-pyJZwFq9.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-B-_lPbF_.js";import"./VDivider-Dz9kH9oT.js";import"./VOverlay-C3-CcM7k.js";import"./VMenu-5q30PoDq.js";import"./VCheckboxBtn-D0lPBrIw.js";import"./VSelectionControl-DgQkzTB8.js";import"./VChip-8OtzmJWd.js";import"./filter-C9QZNLH-.js";const oe={class:"text-h4 mt-2"},le={class:"text-caption"},se={class:"text-h4 mt-2"},re={class:"text-caption"},ne={class:"text-h4 mt-2"},de={class:"text-h4 mt-2"},ie={class:"text-caption"},ue={class:"text-h5 text-success"},ce={class:"text-h5 text-error"},me={__name:"index",setup(ve){const f=m(new Date().getMonth()+1),g=m(new Date().getFullYear()),w=m(!1),A=m(!1),D=m(!1),b=m(""),p=m(null),i=m(null),R=[{title:"Enero",value:1},{title:"Febrero",value:2},{title:"Marzo",value:3},{title:"Abril",value:4},{title:"Mayo",value:5},{title:"Junio",value:6},{title:"Julio",value:7},{title:"Agosto",value:8},{title:"Septiembre",value:9},{title:"Octubre",value:10},{title:"Noviembre",value:11},{title:"Diciembre",value:12}],S=Array.from({length:5},(o,e)=>new Date().getFullYear()-e),U=[{title:"Cliente",key:"cliente",width:"60%"},{title:"Docs",key:"cantidad",width:"20%"},{title:"Total",key:"total",width:"20%"}],I=[{title:"Proveedor",key:"proveedor",width:"60%"},{title:"Docs",key:"cantidad",width:"20%"},{title:"Total",key:"total",width:"20%"}],j=async()=>{var o,e,s;A.value=!0,console.log("🔍 DEBUG VENTAS - Endpoint: /api/dashboard/ventas-mensuales"),console.log("📅 Parámetros:",{mes:f.value,anio:g.value});try{const l=await T.get("/api/dashboard/ventas-mensuales",{params:{mes:f.value,anio:g.value}});console.log("📈 Respuesta ventas completa:",l.data),p.value={total_mes:l.data.total_mes||0,cantidad:l.data.cantidad||0,clientes:l.data.clientes||[]},console.log("✅ Datos ventas procesados:",p.value)}catch(l){console.error("❌ Error al cargar ventas:",l),console.error("❌ Error.response:",(o=l.response)==null?void 0:o.data),b.value="Error al cargar datos de ventas: "+(((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||l.message)}finally{A.value=!1}},G=async()=>{var o,e,s;D.value=!0,console.log("🔍 DEBUG COMPRAS - Endpoint: /api/compras-terceros-mensuales"),console.log("📅 Parámetros:",{mes:f.value,anio:g.value});try{const l=await T.get("/api/compras-terceros-mensuales",{params:{mes:f.value,anio:g.value}});console.log("📉 Respuesta compras completa:",l.data),i.value={total_mes:l.data.total_mes||0,cantidad:l.data.cantidad||0,proveedores:l.data.proveedores||{}},console.log("✅ Datos compras procesados:",i.value)}catch(l){console.error("❌ Error al cargar compras:",l),console.error("❌ Error.response:",(o=l.response)==null?void 0:o.data),b.value="Error al cargar datos de compras: "+(((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||l.message)}finally{D.value=!1}},E=async()=>{w.value=!0,b.value="";try{await Promise.all([j(),G()])}catch(o){console.error("❌ Error general:",o)}finally{w.value=!1}},_=u(()=>{var o;return((o=p.value)==null?void 0:o.total_mes)||0}),z=u(()=>{var o;return((o=p.value)==null?void 0:o.cantidad)||0}),h=u(()=>{var o;return((o=i.value)==null?void 0:o.total_mes)||0}),O=u(()=>{var o;return((o=i.value)==null?void 0:o.cantidad)||0}),M=u(()=>Math.round(_.value*.19/1.19)),k=u(()=>Math.round(h.value*.19/1.19)),y=u(()=>M.value-k.value),B=u(()=>_.value-h.value),J=u(()=>_.value?(B.value/_.value*100).toFixed(1):0),L=u(()=>{var o;return(o=p.value)!=null&&o.clientes?p.value.clientes.sort((e,s)=>(s.total||0)-(e.total||0)).slice(0,10):[]}),Y=u(()=>{var e;if(!((e=i.value)!=null&&e.proveedores))return[];if(console.log("🔍 DEBUG tipo de proveedores:",Array.isArray(i.value.proveedores)),console.log("🔍 DEBUG proveedores:",i.value.proveedores),Array.isArray(i.value.proveedores)){const s=i.value.proveedores.map(l=>(console.log("📦 Proveedor del array:",l),{proveedor:l.proveedor||l.nombre||"Sin nombre",cantidad:l.cantidad||0,total:l.total||0})).sort((l,X)=>X.total-l.total).slice(0,10);return console.log("✅ Proveedores procesados desde array:",s),s}const o=Object.entries(i.value.proveedores).map(([s,l])=>(console.log(`📦 Procesando proveedor objeto: "${s}":`,l),{proveedor:s,cantidad:l.cantidad||0,total:l.total||0})).sort((s,l)=>l.total-s.total).slice(0,10);return console.log("✅ Proveedores procesados desde objeto:",o),o}),c=o=>Number(o||0).toLocaleString("es-CL");return P(p,o=>{console.log("🔄 datosVentas cambió:",o),console.log("💰 totalVentas calculado:",_.value)},{deep:!0}),P(i,o=>{console.log("🔄 datosCompras cambió:",o),console.log("💰 totalCompras calculado:",h.value)},{deep:!0}),q(()=>{E()}),(o,e)=>($(),H("div",null,[t(v,{class:"mb-6",title:"Dashboard Financiero 📊"},{default:a(()=>[t(V,null,{default:a(()=>[t(C,{dense:""},{default:a(()=>[t(d,{cols:"12",md:"3"},{default:a(()=>[t(F,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),items:R,label:"Mes","item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"3"},{default:a(()=>[t(F,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),items:W(S),label:"Año",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(d,{cols:"12",md:"6"},{default:a(()=>[t(Z,{color:"primary",onClick:E,loading:w.value,block:""},{default:a(()=>e[2]||(e[2]=[x(" Actualizar Dashboard ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),b.value?($(),K(ae,{key:0,type:"error",class:"mb-4"},{default:a(()=>[x(n(b.value),1)]),_:1})):Q("",!0),t(C,{class:"mb-6"},{default:a(()=>[t(d,{cols:"12",md:"3"},{default:a(()=>[t(v,{color:"success",variant:"tonal"},{default:a(()=>[t(V,{class:"text-center"},{default:a(()=>[e[3]||(e[3]=r("div",{class:"text-h6 font-weight-bold"},"Total Ventas",-1)),r("div",oe," $"+n(c(_.value)),1),r("div",le,n(z.value)+" documentos ",1)]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"3"},{default:a(()=>[t(v,{color:"error",variant:"tonal"},{default:a(()=>[t(V,{class:"text-center"},{default:a(()=>[e[4]||(e[4]=r("div",{class:"text-h6 font-weight-bold"},"Total Compras",-1)),r("div",se," $"+n(c(h.value)),1),r("div",re,n(O.value)+" documentos ",1)]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"3"},{default:a(()=>[t(v,{color:"warning",variant:"tonal"},{default:a(()=>[t(V,{class:"text-center"},{default:a(()=>[e[5]||(e[5]=r("div",{class:"text-h6 font-weight-bold"},"IVA por Pagar",-1)),r("div",ne," $"+n(c(y.value)),1),e[6]||(e[6]=r("div",{class:"text-caption"}," Ventas - Compras ",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"3"},{default:a(()=>[t(v,{color:"info",variant:"tonal"},{default:a(()=>[t(V,{class:"text-center"},{default:a(()=>[e[7]||(e[7]=r("div",{class:"text-h6 font-weight-bold"},"Margen Bruto",-1)),r("div",de," $"+n(c(B.value)),1),r("div",ie,n(J.value)+"% margen ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(d,{cols:"12",md:"6"},{default:a(()=>[t(v,{title:"Top 10 Clientes del Mes",class:"h-100"},{default:a(()=>[t(N,{items:L.value,headers:U,class:"elevation-0","items-per-page":10,loading:A.value},{"item.total":a(({item:s})=>[x(" $"+n(c(s.total||0)),1)]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(d,{cols:"12",md:"6"},{default:a(()=>[t(v,{title:"Top 10 Compras del Mes",class:"h-100"},{default:a(()=>[t(N,{items:Y.value,headers:I,class:"elevation-0","items-per-page":10,loading:D.value},{"item.total":a(({item:s})=>[x(" $"+n(c(s.total||0)),1)]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),t(v,{class:"mt-6",title:"Resumen Tributario"},{default:a(()=>[t(V,null,{default:a(()=>[t(C,null,{default:a(()=>[t(d,{cols:"12",md:"4"},{default:a(()=>[e[8]||(e[8]=r("div",{class:"text-subtitle-1 mb-2"},"📈 IVA Ventas (Débito Fiscal)",-1)),r("div",ue," $"+n(c(M.value)),1)]),_:1}),t(d,{cols:"12",md:"4"},{default:a(()=>[e[9]||(e[9]=r("div",{class:"text-subtitle-1 mb-2"},"📉 IVA Compras (Crédito Fiscal)",-1)),r("div",ce," $"+n(c(k.value)),1)]),_:1}),t(d,{cols:"12",md:"4"},{default:a(()=>[e[10]||(e[10]=r("div",{class:"text-subtitle-1 mb-2"},"💰 IVA Resultante",-1)),r("div",{class:ee(["text-h5",y.value>=0?"text-warning":"text-success"])},[x(" $"+n(c(Math.abs(y.value)))+" ",1),r("small",null,n(y.value>=0?"(A Pagar)":"(A Favor)"),1)],2)]),_:1})]),_:1})]),_:1})]),_:1})]))}},Se=te(me,[["__scopeId","data-v-5835222f"]]);export{Se as default};
