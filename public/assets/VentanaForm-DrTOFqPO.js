import{d as j}from"./debounce-DXIiIT6J.js";import{w as g,ar as C,f as _,e as i,o as s,b as n,c as w,m as y,F as U,d as v,t as c,v as p}from"./index-Bbf9NtO_.js";import{V as A}from"./VCard-C1PjMmAL.js";import{V as N,a as d}from"./VRow-e2eJeLw2.js";import{V as m}from"./VSelect-CaTpVbiJ.js";import{V}from"./VTextField-BML0o-9-.js";import{V as x}from"./VAlert-CYbz_vFs.js";import"./VAvatar-CFjRqMQj.js";import"./VImg-DDK4CAHl.js";import"./transition-BVD5sUHd.js";import"./VCardText-BS7-d3lL.js";/* empty css              */import"./VInput-BQ9KC5pQ.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-B-rGQG8c.js";import"./VDivider-gR8e3Iny.js";import"./VOverlay-DUm3p4jJ.js";import"./VMenu-B1TTIrK1.js";import"./VCheckboxBtn-sSehld79.js";import"./VSelectionControl-BaBBSdHs.js";import"./VChip-DRg--sXz.js";const L=.45,X={__name:"VentanaForm",props:{ventana:Object,tiposVentana:Array,colores:Array,tiposVidrio:Array,productosVidrio:Array},setup(o){const l=r=>{var t;return((t=a.ventana.original)==null?void 0:t[r])!==a.ventana[r]},a=o;g(()=>a.productosVidrio.length,r=>{r>0&&a.ventana.tipo_ventana_id&&a.ventana.ancho&&a.ventana.alto&&a.ventana.producto_vidrio_proveedor_id&&(console.log("✅ Productos cargados, ejecutando recálculo inicial"),f())},{immediate:!0});const f=j(async()=>{const r=a.productosVidrio.find(e=>e.id===a.ventana.producto_vidrio_proveedor_id),t={tipo:a.ventana.tipo_ventana_id,ancho:a.ventana.ancho,alto:a.ventana.alto,cantidad:a.ventana.cantidad,material:2,color:a.ventana.color_id,tipoVidrio:a.ventana.tipo_vidrio_id,productoVidrioProveedor:r.id,productoVidrio:r.producto_id,proveedorVidrio:r.proveedor_id,hojas_totales:a.ventana.hojas_totales,hojas_moviles:a.ventana.tipo_ventana_id===3||a.ventana.tipo_ventana_id===46?a.ventana.hojas_moviles:void 0};try{console.log(t);const{data:e}=await C.post("/api/cotizador/calcular-materiales",t),u=Number(a.ventana.cantidad)||1;a.ventana.costo_unitario=e.costo_unitario,a.ventana.costo_total=e.costo_total,a.ventana.precio=Math.ceil(e.costo_unitario/(1-L))*u,a.ventana.materiales=e.materiales}catch(e){console.error("❌ Error al calcular materiales",e)}},800);return g(()=>[a.ventana.tipo_ventana_id,a.ventana.ancho,a.ventana.alto,a.ventana.cantidad,a.ventana.color_id,a.ventana.tipo_vidrio_id,a.ventana.producto_vidrio_proveedor_id,a.ventana.hojas_totales,a.ventana.hojas_moviles],()=>{a.ventana.tipo_ventana_id&&a.ventana.ancho&&a.ventana.alto&&a.ventana.producto_vidrio_proveedor_id&&Number(a.ventana.cantidad)>0&&f()},{deep:!0}),(r,t)=>(s(),_(A,{class:"pa-4 mb-4",outlined:""},{default:i(()=>[n(N,{dense:""},{default:i(()=>[n(d,{cols:"12",sm:"6"},{default:i(()=>[n(m,{modelValue:o.ventana.tipo_ventana_id,"onUpdate:modelValue":t[0]||(t[0]=e=>o.ventana.tipo_ventana_id=e),items:o.tiposVentana,"item-title":"nombre","item-value":"id",label:"Tipo de ventana"},null,8,["modelValue","items"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.ancho,"onUpdate:modelValue":t[1]||(t[1]=e=>o.ventana.ancho=e),label:"Ancho (mm)",type:"number",color:l("ancho")?"warning":void 0,"append-inner-icon":l("ancho")?"mdi-pencil":""},null,8,["modelValue","color","append-inner-icon"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.alto,"onUpdate:modelValue":t[2]||(t[2]=e=>o.ventana.alto=e),label:"Alto (mm)",type:"number",outlined:"",color:l("alto")?"warning":void 0,"append-inner-icon":l("alto")?"mdi-pencil":""},null,8,["modelValue","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.cantidad,"onUpdate:modelValue":t[3]||(t[3]=e=>o.ventana.cantidad=e),modelModifiers:{number:!0},label:"Cantidad",type:"number",min:"1",rules:[e=>e>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.color_id,"onUpdate:modelValue":t[4]||(t[4]=e=>o.ventana.color_id=e),items:o.colores,"item-title":"nombre","item-value":"id",label:"Color",color:l("color_id")?"warning":void 0,"append-inner-icon":l("color_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.tipo_vidrio_id,"onUpdate:modelValue":t[5]||(t[5]=e=>o.ventana.tipo_vidrio_id=e),items:o.tiposVidrio,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio",color:l("tipo_vidrio_id")?"warning":void 0,"append-inner-icon":l("tipo_vidrio_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.producto_vidrio_proveedor_id,"onUpdate:modelValue":t[6]||(t[6]=e=>o.ventana.producto_vidrio_proveedor_id=e),items:o.productosVidrio,"item-title":"nombre","item-value":"id",label:"Producto de vidrio",color:l("producto_vidrio_proveedor_id")?"warning":void 0,"append-inner-icon":l("producto_vidrio_proveedor_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),o.ventana.tipo_ventana_id===3||o.ventana.tipo_ventana_id===46?(s(),w(U,{key:0},[n(d,{cols:"6",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.hojas_totales,"onUpdate:modelValue":t[7]||(t[7]=e=>o.ventana.hojas_totales=e),items:[2,3,4,6],label:"Hojas totales",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.hojas_moviles,"onUpdate:modelValue":t[8]||(t[8]=e=>o.ventana.hojas_moviles=e),items:[1,2,3,4],label:"Hojas móviles",disabled:!o.ventana.hojas_totales,rules:[e=>!e||e<=o.ventana.hojas_totales||"No puede exceder total"],outlined:"",color:"primary"},null,8,["modelValue","disabled","rules"])]),_:1})],64)):y("",!0),o.ventana.costo_total?(s(),_(d,{key:1,cols:"12"},{default:i(()=>[n(x,{type:"info",variant:"outlined"},{default:i(()=>{var e,u,b;return[t[9]||(t[9]=v("strong",null,"Costo unitario:",-1)),c(" "+p((e=o.ventana.costo_unitario)==null?void 0:e.toLocaleString("es-CL"))+" — ",1),t[10]||(t[10]=v("strong",null,"Costo total:",-1)),c(" "+p((u=o.ventana.costo_total)==null?void 0:u.toLocaleString("es-CL"))+" — ",1),t[11]||(t[11]=v("strong",null,"Precio:",-1)),c(" "+p((b=o.ventana.precio)==null?void 0:b.toLocaleString("es-CL")),1)]}),_:1})]),_:1})):y("",!0)]),_:1})]),_:1}))}};export{X as default};
