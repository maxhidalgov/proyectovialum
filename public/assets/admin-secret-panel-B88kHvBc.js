import{k as M,r as n,E as j,ar as V,f as y,o as c,e as r,b as l,m as S,d as o,a3 as w,t as v,Z as G,v as i,as as J,c as A,F as O,i as Z,a2 as h}from"./index-COm4NVKR.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as N,a as C}from"./VRow-D7Q6o8Uy.js";import{V as $,b as B,c as K}from"./VCard-td-zcGQo.js";import{V as Q}from"./VDivider-Dbrw5H8e.js";import{V as R}from"./VAlert-DjP_sbX7.js";import{V as q}from"./VCardText-D0eELi7j.js";import{V as W}from"./VTable-knHealOg.js";import{V as X}from"./VChip-DZHIFqm9.js";import{V as Y}from"./VDialog-Dlh9uZi9.js";import{V as ee}from"./VForm-BbwvP89X.js";import{V as k}from"./VTextField-CunrbR4e.js";import{V as ae}from"./VSelect-DS1z6fi2.js";import{V as le}from"./VSpacer-Rk6o96vg.js";import{V as re}from"./VContainer-D3ws7H_L.js";/* empty css              */import"./VAvatar-CDt_NOM9.js";import"./VImg-3mTdHPb7.js";import"./transition-ZXjYSd4o.js";import"./VOverlay-RDD_0lBz.js";import"./forwardRefs-DWGaNmQL.js";import"./VInput-TTRGKgFr.js";import"./VList-U5eOqvkq.js";import"./VMenu-Cn8TkKo0.js";import"./VCheckboxBtn-BN3MgTKX.js";import"./VSelectionControl-z1tALCsc.js";const te={__name:"admin-secret-panel",setup(oe){const z=M(),d=n(!1),u=n(null),m=n(null),x=n([]),U=n([]),f=n(!1),p=n(!1),E=n(null),s=n({name:"",email:"",password:"",role_id:null});j(async()=>{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="Admin"){z.push({name:"root"});return}await _(),await F()});const _=async()=>{d.value=!0;try{const{data:t}=await V.get("/api/admin/users");x.value=t.users}catch{u.value="Error al cargar usuarios"}finally{d.value=!1}},F=async()=>{try{const{data:t}=await V.get("/api/admin/roles");U.value=t.roles}catch{u.value="Error al cargar roles"}},T=()=>{p.value=!1,s.value={name:"",email:"",password:"",role_id:null},f.value=!0},I=t=>{var e;p.value=!0,E.value=t,s.value={name:t.name,email:t.email,password:"",role_id:((e=t.role)==null?void 0:e.id)||null},f.value=!0},D=async()=>{var t,e;u.value=null,m.value=null,d.value=!0;try{if(p.value){const a={...s.value};a.password||delete a.password,await V.put(`/api/admin/users/${E.value.id}`,a),m.value="Usuario actualizado exitosamente"}else await V.post("/api/admin/users",s.value),m.value="Usuario creado exitosamente";f.value=!1,await _()}catch(a){u.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Error al guardar usuario"}finally{d.value=!1}},P=async t=>{var e,a;if(confirm("쮼st치s seguro de eliminar este usuario?")){d.value=!0,u.value=null;try{await V.delete(`/api/admin/users/${t}`),m.value="Usuario eliminado exitosamente",await _()}catch(g){u.value=((a=(e=g.response)==null?void 0:e.data)==null?void 0:a.error)||"Error al eliminar usuario"}finally{d.value=!1}}},L=t=>{switch(t){case"Admin":return"error";case"Vendedor":return"primary";case"Practicante":return"warning";default:return"default"}};return(t,e)=>(c(),y(re,{fluid:""},{default:r(()=>[l(N,null,{default:r(()=>[l(C,{cols:"12"},{default:r(()=>[l($,null,{default:r(()=>[l(B,{class:"d-flex align-center justify-space-between"},{default:r(()=>[e[9]||(e[9]=o("div",null,[o("h2",null,"游댏 Panel de Administraci칩n"),o("p",{class:"text-caption text-disabled mb-0"}," Gesti칩n de usuarios y roles del sistema ")],-1)),l(w,{color:"primary",onClick:T},{default:r(()=>[l(G,{start:"",icon:"tabler-plus"}),e[8]||(e[8]=v(" Crear Usuario "))]),_:1})]),_:1}),l(Q),u.value?(c(),y(R,{key:0,type:"error",closable:"","onClick:close":e[0]||(e[0]=a=>u.value=null),class:"ma-4"},{default:r(()=>[v(i(u.value),1)]),_:1})):S("",!0),m.value?(c(),y(R,{key:1,type:"success",closable:"","onClick:close":e[1]||(e[1]=a=>m.value=null),class:"ma-4"},{default:r(()=>[v(i(m.value),1)]),_:1})):S("",!0),l(q,null,{default:r(()=>[d.value?(c(),y(J,{key:0,indeterminate:"",color:"primary"})):(c(),y(W,{key:1},{default:r(()=>[e[10]||(e[10]=o("thead",null,[o("tr",null,[o("th",null,"ID"),o("th",null,"Nombre"),o("th",null,"Email"),o("th",null,"Rol"),o("th",null,"Fecha Creaci칩n"),o("th",null,"Acciones")])],-1)),o("tbody",null,[(c(!0),A(O,null,Z(x.value,a=>{var g;return c(),A("tr",{key:a.id},[o("td",null,i(a.id),1),o("td",null,i(a.name),1),o("td",null,i(a.email),1),o("td",null,[l(X,{color:L((g=a.role)==null?void 0:g.nombre),size:"small"},{default:r(()=>{var b;return[v(i(((b=a.role)==null?void 0:b.nombre)||"Sin rol"),1)]}),_:2},1032,["color"])]),o("td",null,i(new Date(a.created_at).toLocaleDateString()),1),o("td",null,[l(w,{icon:"tabler-edit",size:"small",variant:"text",onClick:b=>I(a)},null,8,["onClick"]),l(w,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:b=>P(a.id)},null,8,["onClick"])])])}),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),l(Y,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=a=>f.value=a),"max-width":"600"},{default:r(()=>[l($,null,{default:r(()=>[l(B,null,{default:r(()=>[v(i(p.value?"Editar Usuario":"Crear Usuario"),1)]),_:1}),l(q,null,{default:r(()=>[l(ee,{onSubmit:h(D,["prevent"])},{default:r(()=>[l(N,null,{default:r(()=>[l(C,{cols:"12"},{default:r(()=>[l(k,{modelValue:s.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.name=a),label:"Nombre completo",required:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"12"},{default:r(()=>[l(k,{modelValue:s.value.email,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.email=a),label:"Email",type:"email",required:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"12"},{default:r(()=>[l(k,{modelValue:s.value.password,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.password=a),label:"Contrase침a",type:"password",hint:p.value?"Dejar vac칤o para no cambiar":"",required:!p.value},null,8,["modelValue","hint","required"])]),_:1}),l(C,{cols:"12"},{default:r(()=>[l(ae,{modelValue:s.value.role_id,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.role_id=a),items:U.value,"item-title":"nombre","item-value":"id",label:"Rol",required:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1}),l(K,null,{default:r(()=>[l(le),l(w,{color:"default",onClick:e[6]||(e[6]=a=>f.value=!1)},{default:r(()=>e[11]||(e[11]=[v(" Cancelar ")])),_:1}),l(w,{color:"primary",loading:d.value,onClick:D},{default:r(()=>[v(i(p.value?"Actualizar":"Crear"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Be=H(te,[["__scopeId","data-v-95404e41"]]);export{Be as default};
