import{r as n,E as X,f as Y,e as a,ar as b,o as L,b as o,d as l,a3 as u,t as i,v as d,c as h,m as ee,q as oe,Z as te}from"./index-DVH5_zAC.js";import ae from"./ModalPrecio-CFBgQuyi.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as le}from"./VContainer-BQTr2538.js";import{V as D,b as T,c as S}from"./VCard-COrdRJy_.js";import{V as U}from"./VDivider-DRFFLgzE.js";import{V as z}from"./VCardText-CjaUBipx.js";import{V as ie,a as j}from"./VRow-B11LxY42.js";import{V as B}from"./VTextField-CPMs-WRD.js";import{V as se}from"./VSelect-1AUmKITv.js";import{V as ne}from"./VDataTable-I1JlzO2v.js";import{V as y}from"./VChip-6LEPsz9j.js";import{V as de}from"./VTooltip-2HMUWtmH.js";import{V as M}from"./VDialog-BnFs-wUc.js";import{V as ue}from"./VAlert-C8Os17kO.js";import{V as R}from"./VSpacer-Doa9SyIl.js";import"./VForm-39R0lN7h.js";import"./VInput-DvJG3W6V.js";import"./transition-sBQMWBRJ.js";import"./forwardRefs-DWGaNmQL.js";import"./VAutocomplete-BpRMQiZT.js";import"./filter-bYy-Y7_U.js";import"./VList-DlqD1lUI.js";import"./VAvatar-DhgsH_Fv.js";import"./VImg-CFgr5isP.js";import"./VMenu-DPmMVBcN.js";import"./VOverlay-DzZwY3HF.js";import"./VCheckboxBtn-7U5_OoeV.js";import"./VSelectionControl-sJMu9Y8j.js";import"./VSwitch-BVE41btl.js";/* empty css              */const ce={class:"d-flex gap-2"},me={class:"font-weight-medium"},pe={class:"text-caption"},ve={key:0,class:"text-caption text-grey mt-1"},fe={class:"font-weight-medium"},ge={class:"font-weight-bold text-success"},Ve={class:"text-caption"},xe={class:"d-flex gap-1"},be={class:"text-center pa-4"},ye={class:"font-weight-bold mt-2"},_e={__name:"index",setup(Ce){const _=n([]),C=n(!1),k=n(!1),w=n(!1),g=n(""),V=n(null),x=n(!1),p=n(!1),v=n(!1),E=n(!1),P=n(null),I=n(null),$=n(45),O=[{title:"Producto",key:"producto",sortable:!0},{title:"Color / Proveedor",key:"color_proveedor",sortable:!1},{title:"Precio Costo",key:"precio_costo",sortable:!0,align:"end"},{title:"Margen",key:"margen",sortable:!0,align:"center"},{title:"Precio Venta",key:"precio_venta",sortable:!0,align:"end"},{title:"Estado",key:"activo",sortable:!0,align:"center"},{title:"Vigencia",key:"vigencia",sortable:!1},{title:"Acciones",key:"acciones",sortable:!1,align:"center"}],c=async()=>{C.value=!0;try{const r={};V.value!==null&&(r.activo=V.value),g.value&&(r.search=g.value);const e=await b.get("/api/lista-precios",{params:r});_.value=e.data,console.log("📦 Datos cargados:",e.data),e.data.length>0&&console.log("📦 Primer item:",e.data[0])}catch(r){console.error("Error al cargar precios:",r),alert("Error al cargar los precios")}finally{C.value=!1}},q=()=>{c()},F=()=>{E.value=!1,P.value=null,x.value=!0},G=r=>{E.value=!0,P.value=r,x.value=!0},H=r=>{I.value=r,v.value=!0},Z=async()=>{w.value=!0;try{await b.delete(`/api/lista-precios/${I.value.id}`),alert("Precio eliminado correctamente"),await c(),v.value=!1}catch(r){console.error("Error al eliminar precio:",r),alert("Error al eliminar el precio")}finally{w.value=!1}},J=async()=>{k.value=!0;try{const r=await b.post("/api/lista-precios/importar",{margen:$.value});alert(`Importación completada:
- Creados: ${r.data.creados}
- Actualizados: ${r.data.actualizados}
- Total: ${r.data.total}`),await c(),p.value=!1}catch(r){console.error("Error al importar precios:",r),alert("Error al importar los precios")}finally{k.value=!1}},K=async()=>{try{const r=await b.get("/api/lista-precios/exportar");if(r.data.length===0){alert("No hay datos para exportar");return}const e=Object.keys(r.data[0]),t=[e.join(","),...r.data.map(Q=>e.map(W=>Q[W]).join(","))].join(`
`),s=new Blob([t],{type:"text/csv"}),f=window.URL.createObjectURL(s),m=document.createElement("a");m.href=f,m.download=`lista-precios-${new Date().toISOString().split("T")[0]}.csv`,m.click(),window.URL.revokeObjectURL(f)}catch(r){console.error("Error al exportar precios:",r),alert("Error al exportar los precios")}},N=r=>new Intl.NumberFormat("es-CL").format(r||0),A=r=>r?new Date(r).toLocaleDateString("es-CL"):"-";return X(()=>{c()}),(r,e)=>(L(),Y(le,{fluid:""},{default:a(()=>[o(D,null,{default:a(()=>[o(T,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[12]||(e[12]=l("div",null,[l("h2",{class:"text-h5"},"Lista de Precios"),l("p",{class:"text-subtitle-2 text-grey mt-1"}," Gestiona los precios de tus productos ")],-1)),l("div",ce,[o(u,{color:"info","prepend-icon":"mdi-upload",onClick:e[0]||(e[0]=t=>p.value=!0)},{default:a(()=>e[9]||(e[9]=[i(" Importar desde PCP ")])),_:1}),o(u,{color:"success","prepend-icon":"mdi-download",onClick:K},{default:a(()=>e[10]||(e[10]=[i(" Exportar Excel ")])),_:1}),o(u,{color:"primary","prepend-icon":"mdi-plus",onClick:F},{default:a(()=>e[11]||(e[11]=[i(" Nuevo Precio ")])),_:1})])]),_:1}),o(U),o(z,null,{default:a(()=>[o(ie,null,{default:a(()=>[o(j,{cols:"12",md:"6"},{default:a(()=>[o(B,{modelValue:g.value,"onUpdate:modelValue":[e[1]||(e[1]=t=>g.value=t),q],label:"Buscar por nombre o código","prepend-inner-icon":"mdi-magnify",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),o(j,{cols:"12",md:"3"},{default:a(()=>[o(se,{modelValue:V.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>V.value=t),c],items:[{title:"Todos",value:null},{title:"Activos",value:"1"},{title:"Inactivos",value:"0"}],label:"Estado",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ne,{headers:O,items:_.value,loading:C.value,"items-per-page":15,"items-per-page-options":[10,15,25,50,100],class:"elevation-1"},{"item.producto":a(({item:t})=>{var s;return[l("div",null,[l("div",me,d((s=t.producto)==null?void 0:s.nombre),1)])]}),"item.color_proveedor":a(({item:t})=>[l("div",null,[l("div",pe,[o(y,{size:"x-small",color:"primary",class:"mr-1"},{default:a(()=>{var s,f,m;return[i(d(((s=t.color)==null?void 0:s.nombre)||((m=(f=t.producto_color_proveedor)==null?void 0:f.color)==null?void 0:m.nombre)||"Sin color"),1)]}),_:2},1024)]),t.proveedor_sugerido?(L(),h("div",ve,[o(de,{location:"top"},{activator:a(({props:s})=>[l("span",oe(s,{class:"text-decoration-underline"}),[o(te,{size:"x-small"},{default:a(()=>e[13]||(e[13]=[i("mdi-information-outline")])),_:1}),e[14]||(e[14]=i(" Proveedor sugerido "))],16)]),default:a(()=>[l("span",null,d(t.proveedor_sugerido.nombre),1)]),_:2},1024)])):ee("",!0)])]),"item.precio_costo":a(({item:t})=>[l("span",fe,"$"+d(N(t.precio_costo)),1)]),"item.margen":a(({item:t})=>[o(y,{size:"small",color:"info"},{default:a(()=>[i(d(t.margen)+"% ",1)]),_:2},1024)]),"item.precio_venta":a(({item:t})=>[l("span",ge," $"+d(N(t.precio_venta)),1)]),"item.activo":a(({item:t})=>[o(y,{color:t.activo?"success":"error",size:"small"},{default:a(()=>[i(d(t.activo?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.vigencia":a(({item:t})=>[l("div",Ve,[l("div",null,"Desde: "+d(A(t.vigencia_desde)),1),l("div",null,"Hasta: "+d(A(t.vigencia_hasta)),1)])]),"item.acciones":a(({item:t})=>[l("div",xe,[o(u,{icon:"mdi-pencil",size:"small",color:"primary",variant:"text",onClick:s=>G(t)},null,8,["onClick"]),o(u,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:s=>H(t)},null,8,["onClick"])])]),bottom:a(()=>[l("div",be,[o(y,{color:"primary",class:"mr-2"},{default:a(()=>[i(" Total: "+d(_.value.length)+" precios ",1)]),_:1})])]),_:1},8,["items","loading"])]),_:1}),o(ae,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),precio:P.value,"modo-edicion":E.value,onGuardado:c},null,8,["modelValue","precio","modo-edicion"]),o(M,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),"max-width":"500px"},{default:a(()=>[o(D,null,{default:a(()=>[o(T,{class:"text-h6 bg-info"},{default:a(()=>e[15]||(e[15]=[i(" Importar desde Producto-Color-Proveedor ")])),_:1}),o(z,{class:"pt-4"},{default:a(()=>[o(ue,{type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>e[16]||(e[16]=[i(" Esta acción importará todos los productos con color y proveedor definidos, creando o actualizando los precios en la lista. ")])),_:1}),o(B,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=t=>$.value=t),modelModifiers:{number:!0},label:"Margen por defecto (%)",type:"number",suffix:"%",variant:"outlined",hint:"Se aplicará este margen a todos los productos importados","persistent-hint":""},null,8,["modelValue"])]),_:1}),o(U),o(S,null,{default:a(()=>[o(R),o(u,{color:"grey",variant:"text",onClick:e[5]||(e[5]=t=>p.value=!1)},{default:a(()=>e[17]||(e[17]=[i(" Cancelar ")])),_:1}),o(u,{color:"info",variant:"elevated",loading:k.value,onClick:J},{default:a(()=>e[18]||(e[18]=[i(" Importar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(M,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=t=>v.value=t),"max-width":"400px"},{default:a(()=>[o(D,null,{default:a(()=>[o(T,{class:"text-h6 bg-error"},{default:a(()=>e[19]||(e[19]=[i(" Confirmar Eliminación ")])),_:1}),o(z,{class:"pt-4"},{default:a(()=>{var t,s;return[e[20]||(e[20]=l("p",null,"¿Estás seguro de que deseas eliminar este precio?",-1)),l("p",ye,d((s=(t=I.value)==null?void 0:t.producto)==null?void 0:s.nombre),1)]}),_:1}),o(U),o(S,null,{default:a(()=>[o(R),o(u,{color:"grey",variant:"text",onClick:e[7]||(e[7]=t=>v.value=!1)},{default:a(()=>e[21]||(e[21]=[i(" Cancelar ")])),_:1}),o(u,{color:"error",variant:"elevated",loading:w.value,onClick:Z},{default:a(()=>e[22]||(e[22]=[i(" Eliminar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},eo=re(_e,[["__scopeId","data-v-9098875f"]]);export{eo as default};
