import{r as s,E as Y,f as Z,e as a,au as x,o as D,b as t,d as l,a3 as c,t as i,v as d,c as N}from"./index-BeJKwT3L.js";import ee from"./ModalPrecio-CU106dDG.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as te}from"./VContainer-C1TFicUA.js";import{V as U,b as S,c as j}from"./VCard-CGdkx-aT.js";import{V as T}from"./VDivider-BwTOxVso.js";import{V as z}from"./VCardText-DwCeoSnf.js";import{V as ae,a as B}from"./VRow-D5xgHycP.js";import{V as M}from"./VTextField-Jwusj3K2.js";import{V as re}from"./VSelect-CP_h5oZu.js";import{V as le}from"./VDataTable-B7G1_Tc3.js";import{V as b}from"./VChip-Dk9LcUUU.js";import{V as R}from"./VDialog-B8fNwsjc.js";import{V as ie}from"./VAlert-BAeOn0Ot.js";import{V as O}from"./VSpacer-DUGk-Oji.js";import"./VForm-0rQalx3P.js";import"./VInput-CRx9gst-.js";import"./transition-_UBNvAVp.js";import"./forwardRefs-DWGaNmQL.js";import"./VAutocomplete-BrNdOcD1.js";import"./filter-DhrMZfUc.js";import"./VList-CestEiTa.js";import"./VAvatar-CfPmM5Ot.js";import"./VImg-DEZOfq6Q.js";import"./VMenu-BknqRJcB.js";import"./VOverlay-Dw8rT7j1.js";import"./VCheckboxBtn-Dc5VQrYU.js";import"./VSelectionControl-C9MxSs2p.js";import"./VSwitch-By68xJK5.js";/* empty css              */const se={class:"d-flex gap-2"},ne={class:"font-weight-medium"},de={key:0},ce={class:"text-caption"},ue={class:"text-caption text-grey mt-1"},pe={key:1,class:"text-grey"},me={class:"font-weight-medium"},ve={class:"font-weight-bold text-success"},fe={class:"text-caption"},ge={class:"d-flex gap-1"},Ve={class:"text-center pa-4"},xe={class:"font-weight-bold mt-2"},be={__name:"index",setup(ye){const y=s([]),_=s(!1),C=s(!1),k=s(!1),f=s(""),g=s(null),V=s(!1),p=s(!1),m=s(!1),w=s(!1),E=s(null),P=s(null),$=s(45),F=[{title:"Producto",key:"producto",sortable:!0},{title:"Color / Proveedor",key:"color_proveedor",sortable:!1},{title:"Precio Costo",key:"precio_costo",sortable:!0,align:"end"},{title:"Margen",key:"margen",sortable:!0,align:"center"},{title:"Precio Venta",key:"precio_venta",sortable:!0,align:"end"},{title:"Estado",key:"activo",sortable:!0,align:"center"},{title:"Vigencia",key:"vigencia",sortable:!1},{title:"Acciones",key:"acciones",sortable:!1,align:"center"}],u=async()=>{_.value=!0;try{const r={};g.value!==null&&(r.activo=g.value),f.value&&(r.search=f.value);const e=await x.get("/api/lista-precios",{params:r});y.value=e.data,console.log("📦 Datos cargados:",e.data),e.data.length>0&&console.log("📦 Primer item:",e.data[0])}catch(r){console.error("Error al cargar precios:",r),alert("Error al cargar los precios")}finally{_.value=!1}},q=()=>{u()},G=()=>{w.value=!1,E.value=null,V.value=!0},h=r=>{w.value=!0,E.value=r,V.value=!0},H=r=>{P.value=r,m.value=!0},J=async()=>{k.value=!0;try{await x.delete(`/api/lista-precios/${P.value.id}`),alert("Precio eliminado correctamente"),await u(),m.value=!1}catch(r){console.error("Error al eliminar precio:",r),alert("Error al eliminar el precio")}finally{k.value=!1}},K=async()=>{C.value=!0;try{const r=await x.post("/api/lista-precios/importar",{margen:$.value});alert(`Importación completada:
- Creados: ${r.data.creados}
- Actualizados: ${r.data.actualizados}
- Total: ${r.data.total}`),await u(),p.value=!1}catch(r){console.error("Error al importar precios:",r),alert("Error al importar los precios")}finally{C.value=!1}},Q=async()=>{try{const r=await x.get("/api/lista-precios/exportar");if(r.data.length===0){alert("No hay datos para exportar");return}const e=Object.keys(r.data[0]),o=[e.join(","),...r.data.map(W=>e.map(X=>W[X]).join(","))].join(`
`),n=new Blob([o],{type:"text/csv"}),v=window.URL.createObjectURL(n),I=document.createElement("a");I.href=v,I.download=`lista-precios-${new Date().toISOString().split("T")[0]}.csv`,I.click(),window.URL.revokeObjectURL(v)}catch(r){console.error("Error al exportar precios:",r),alert("Error al exportar los precios")}},A=r=>new Intl.NumberFormat("es-CL").format(r||0),L=r=>r?new Date(r).toLocaleDateString("es-CL"):"-";return Y(()=>{u()}),(r,e)=>(D(),Z(te,{fluid:""},{default:a(()=>[t(U,null,{default:a(()=>[t(S,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[12]||(e[12]=l("div",null,[l("h2",{class:"text-h5"},"Lista de Precios"),l("p",{class:"text-subtitle-2 text-grey mt-1"}," Gestiona los precios de tus productos ")],-1)),l("div",se,[t(c,{color:"info","prepend-icon":"mdi-upload",onClick:e[0]||(e[0]=o=>p.value=!0)},{default:a(()=>e[9]||(e[9]=[i(" Importar desde PCP ")])),_:1}),t(c,{color:"success","prepend-icon":"mdi-download",onClick:Q},{default:a(()=>e[10]||(e[10]=[i(" Exportar Excel ")])),_:1}),t(c,{color:"primary","prepend-icon":"mdi-plus",onClick:G},{default:a(()=>e[11]||(e[11]=[i(" Nuevo Precio ")])),_:1})])]),_:1}),t(T),t(z,null,{default:a(()=>[t(ae,null,{default:a(()=>[t(B,{cols:"12",md:"6"},{default:a(()=>[t(M,{modelValue:f.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>f.value=o),q],label:"Buscar por nombre o código","prepend-inner-icon":"mdi-magnify",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(B,{cols:"12",md:"3"},{default:a(()=>[t(re,{modelValue:g.value,"onUpdate:modelValue":[e[2]||(e[2]=o=>g.value=o),u],items:[{title:"Todos",value:null},{title:"Activos",value:"1"},{title:"Inactivos",value:"0"}],label:"Estado",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(le,{headers:F,items:y.value,loading:_.value,"items-per-page":15,"items-per-page-options":[10,15,25,50,100],class:"elevation-1"},{"item.producto":a(({item:o})=>{var n;return[l("div",null,[l("div",ne,d((n=o.producto)==null?void 0:n.nombre),1)])]}),"item.color_proveedor":a(({item:o})=>{var n;return[o.producto_color_proveedor?(D(),N("div",de,[l("div",ce,[t(b,{size:"x-small",color:"primary",class:"mr-1"},{default:a(()=>{var v;return[i(d(((v=o.producto_color_proveedor.color)==null?void 0:v.nombre)||"Sin color"),1)]}),_:2},1024)]),l("div",ue,d(((n=o.producto_color_proveedor.proveedor)==null?void 0:n.nombre)||"Sin proveedor"),1)])):(D(),N("span",pe,"-"))]}),"item.precio_costo":a(({item:o})=>[l("span",me,"$"+d(A(o.precio_costo)),1)]),"item.margen":a(({item:o})=>[t(b,{size:"small",color:"info"},{default:a(()=>[i(d(o.margen)+"% ",1)]),_:2},1024)]),"item.precio_venta":a(({item:o})=>[l("span",ve," $"+d(A(o.precio_venta)),1)]),"item.activo":a(({item:o})=>[t(b,{color:o.activo?"success":"error",size:"small"},{default:a(()=>[i(d(o.activo?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.vigencia":a(({item:o})=>[l("div",fe,[l("div",null,"Desde: "+d(L(o.vigencia_desde)),1),l("div",null,"Hasta: "+d(L(o.vigencia_hasta)),1)])]),"item.acciones":a(({item:o})=>[l("div",ge,[t(c,{icon:"mdi-pencil",size:"small",color:"primary",variant:"text",onClick:n=>h(o)},null,8,["onClick"]),t(c,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:n=>H(o)},null,8,["onClick"])])]),bottom:a(()=>[l("div",Ve,[t(b,{color:"primary",class:"mr-2"},{default:a(()=>[i(" Total: "+d(y.value.length)+" precios ",1)]),_:1})])]),_:1},8,["items","loading"])]),_:1}),t(ee,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=o=>V.value=o),precio:E.value,"modo-edicion":w.value,onGuardado:u},null,8,["modelValue","precio","modo-edicion"]),t(R,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),"max-width":"500px"},{default:a(()=>[t(U,null,{default:a(()=>[t(S,{class:"text-h6 bg-info"},{default:a(()=>e[13]||(e[13]=[i(" Importar desde Producto-Color-Proveedor ")])),_:1}),t(z,{class:"pt-4"},{default:a(()=>[t(ie,{type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>e[14]||(e[14]=[i(" Esta acción importará todos los productos con color y proveedor definidos, creando o actualizando los precios en la lista. ")])),_:1}),t(M,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=o=>$.value=o),modelModifiers:{number:!0},label:"Margen por defecto (%)",type:"number",suffix:"%",variant:"outlined",hint:"Se aplicará este margen a todos los productos importados","persistent-hint":""},null,8,["modelValue"])]),_:1}),t(T),t(j,null,{default:a(()=>[t(O),t(c,{color:"grey",variant:"text",onClick:e[5]||(e[5]=o=>p.value=!1)},{default:a(()=>e[15]||(e[15]=[i(" Cancelar ")])),_:1}),t(c,{color:"info",variant:"elevated",loading:C.value,onClick:K},{default:a(()=>e[16]||(e[16]=[i(" Importar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value=o),"max-width":"400px"},{default:a(()=>[t(U,null,{default:a(()=>[t(S,{class:"text-h6 bg-error"},{default:a(()=>e[17]||(e[17]=[i(" Confirmar Eliminación ")])),_:1}),t(z,{class:"pt-4"},{default:a(()=>{var o,n;return[e[18]||(e[18]=l("p",null,"¿Estás seguro de que deseas eliminar este precio?",-1)),l("p",xe,d((n=(o=P.value)==null?void 0:o.producto)==null?void 0:n.nombre),1)]}),_:1}),t(T),t(j,null,{default:a(()=>[t(O),t(c,{color:"grey",variant:"text",onClick:e[7]||(e[7]=o=>m.value=!1)},{default:a(()=>e[19]||(e[19]=[i(" Cancelar ")])),_:1}),t(c,{color:"error",variant:"elevated",loading:k.value,onClick:J},{default:a(()=>e[20]||(e[20]=[i(" Eliminar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Xe=oe(be,[["__scopeId","data-v-10a4610c"]]);export{Xe as default};
