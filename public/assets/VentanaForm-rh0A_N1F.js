import{d as j}from"./debounce-mFUTGwKc.js";import{at as _,w as C,f as b,e as i,o as s,b as n,c as w,l as g,F as U,d as v,s as c,t as p}from"./index-BPBDal4F.js";import{V as A}from"./VCard-CCHl2WvF.js";import{V as N,a as d}from"./VRow-CDDN_Ar3.js";import{V as m}from"./VSelect-C6Eec5DA.js";import{V}from"./VTextField-9hUdxydA.js";import{V as x}from"./VAlert-DdB47Oza.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VAvatar-DKVkcuTj.js";import"./VImg-MOU2ApLw.js";import"./index-BaI8x-9x.js";import"./VCardText-BFpdlGZF.js";/* empty css              */import"./forwardRefs-DWGaNmQL.js";import"./VList-B143KMxe.js";import"./VDivider-BaXl7Onm.js";import"./VOverlay-kiyfNzH_.js";import"./VMenu-qYjXcrBY.js";import"./VCheckboxBtn-DQN9tI0P.js";import"./VChip-CLniyfS_.js";const L=.45,W={__name:"VentanaForm",props:{ventana:Object,tiposVentana:Array,colores:Array,tiposVidrio:Array,productosVidrio:Array},setup(o){const l=r=>{var t;return((t=e.ventana.original)==null?void 0:t[r])!==e.ventana[r]},e=o,y=j(async()=>{const r=e.productosVidrio.find(a=>a.id===e.ventana.producto_vidrio_proveedor_id),t={tipo:e.ventana.tipo_ventana_id,ancho:e.ventana.ancho,alto:e.ventana.alto,cantidad:e.ventana.cantidad,material:2,color:e.ventana.color_id,tipoVidrio:e.ventana.tipo_vidrio_id,productoVidrioProveedor:r.id,productoVidrio:r.producto_id,proveedorVidrio:r.proveedor_id,hojas_totales:e.ventana.hojas_totales,hojas_moviles:e.ventana.tipo_ventana_id===3||e.ventana.tipo_ventana_id===46?e.ventana.hojas_moviles:void 0};try{console.log(t);const{data:a}=await _.post("/api/cotizador/calcular-materiales",t),u=Number(e.ventana.cantidad)||1;e.ventana.costo_unitario=a.costo_unitario,e.ventana.costo_total=a.costo_total,e.ventana.precio=Math.ceil(a.costo_unitario/(1-L))*u,e.ventana.materiales=a.materiales}catch(a){console.error("❌ Error al calcular materiales",a)}},800);return C(()=>[e.ventana.tipo_ventana_id,e.ventana.ancho,e.ventana.alto,e.ventana.cantidad,e.ventana.color_id,e.ventana.tipo_vidrio_id,e.ventana.producto_vidrio_proveedor_id,e.ventana.hojas_totales,e.ventana.hojas_moviles],()=>{e.ventana.tipo_ventana_id&&e.ventana.ancho&&e.ventana.alto&&e.ventana.producto_vidrio_proveedor_id&&Number(e.ventana.cantidad)>0&&y()},{deep:!0}),(r,t)=>(s(),b(A,{class:"pa-4 mb-4",outlined:""},{default:i(()=>[n(N,{dense:""},{default:i(()=>[n(d,{cols:"12",sm:"6"},{default:i(()=>[n(m,{modelValue:o.ventana.tipo_ventana_id,"onUpdate:modelValue":t[0]||(t[0]=a=>o.ventana.tipo_ventana_id=a),items:o.tiposVentana,"item-title":"nombre","item-value":"id",label:"Tipo de ventana"},null,8,["modelValue","items"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.ancho,"onUpdate:modelValue":t[1]||(t[1]=a=>o.ventana.ancho=a),label:"Ancho (mm)",type:"number",color:l("ancho")?"warning":void 0,"append-inner-icon":l("ancho")?"mdi-pencil":""},null,8,["modelValue","color","append-inner-icon"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.alto,"onUpdate:modelValue":t[2]||(t[2]=a=>o.ventana.alto=a),label:"Alto (mm)",type:"number",outlined:"",color:l("alto")?"warning":void 0,"append-inner-icon":l("alto")?"mdi-pencil":""},null,8,["modelValue","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(V,{modelValue:o.ventana.cantidad,"onUpdate:modelValue":t[3]||(t[3]=a=>o.ventana.cantidad=a),label:"Cantidad",type:"number",min:"1",rules:[a=>a>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.color_id,"onUpdate:modelValue":t[4]||(t[4]=a=>o.ventana.color_id=a),items:o.colores,"item-title":"nombre","item-value":"id",label:"Color",color:l("color_id")?"warning":void 0,"append-inner-icon":l("color_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.tipo_vidrio_id,"onUpdate:modelValue":t[5]||(t[5]=a=>o.ventana.tipo_vidrio_id=a),items:o.tiposVidrio,"item-title":"nombre","item-value":"id",label:"Tipo de vidrio",color:l("tipo_vidrio_id")?"warning":void 0,"append-inner-icon":l("tipo_vidrio_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),n(d,{cols:"12",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.producto_vidrio_proveedor_id,"onUpdate:modelValue":t[6]||(t[6]=a=>o.ventana.producto_vidrio_proveedor_id=a),items:o.productosVidrio,"item-title":"nombre","item-value":"id",label:"Producto de vidrio",color:l("producto_vidrio_proveedor_id")?"warning":void 0,"append-inner-icon":l("producto_vidrio_proveedor_id")?"mdi-pencil":""},null,8,["modelValue","items","color","append-inner-icon"])]),_:1}),o.ventana.tipo_ventana_id===3||o.ventana.tipo_ventana_id===46?(s(),w(U,{key:0},[n(d,{cols:"6",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.hojas_totales,"onUpdate:modelValue":t[7]||(t[7]=a=>o.ventana.hojas_totales=a),items:[2,3,4,6],label:"Hojas totales",outlined:"",color:"primary"},null,8,["modelValue"])]),_:1}),n(d,{cols:"6",sm:"3"},{default:i(()=>[n(m,{modelValue:o.ventana.hojas_moviles,"onUpdate:modelValue":t[8]||(t[8]=a=>o.ventana.hojas_moviles=a),items:[1,2,3,4],label:"Hojas móviles",disabled:!o.ventana.hojas_totales,rules:[a=>!a||a<=o.ventana.hojas_totales||"No puede exceder total"],outlined:"",color:"primary"},null,8,["modelValue","disabled","rules"])]),_:1})],64)):g("",!0),o.ventana.costo_total?(s(),b(d,{key:1,cols:"12"},{default:i(()=>[n(x,{type:"info",variant:"outlined"},{default:i(()=>{var a,u,f;return[t[9]||(t[9]=v("strong",null,"Costo unitario:",-1)),c(" "+p((a=o.ventana.costo_unitario)==null?void 0:a.toLocaleString("es-CL"))+" — ",1),t[10]||(t[10]=v("strong",null,"Costo total:",-1)),c(" "+p((u=o.ventana.costo_total)==null?void 0:u.toLocaleString("es-CL"))+" — ",1),t[11]||(t[11]=v("strong",null,"Precio:",-1)),c(" "+p((f=o.ventana.precio)==null?void 0:f.toLocaleString("es-CL")),1)]}),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}))}};export{W as default};
